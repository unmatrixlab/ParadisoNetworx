<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anne Hathaway | Aprende Inglés con Diálogo Interactivo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKx33oW+rLFGVjA5+d2jA+d4g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;
    --gray-100: #f8fafc;
    --gray-200: #e2e8f0;
    --gray-600: #475569;
    --gray-800: #1e293b;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
    --radius: 16px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #eef2ff 0%, #ddd6fe 100%);
    color: var(--gray-800);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* ====== LA CLAVE: CONTENEDOR QUE LIMITA EL ANCHO EN DESKTOP ====== */
  .page-max-width {
    max-width: 600px;           /* Ligeramente más ancho para mejor lectura */
    margin: 0 auto;
    width: 100%;
  }
  @media (max-width: 768px) {
    .page-max-width {
      max-width: 100%;
    }
  }

  /* ====================== VIDEO FIJO ====================== */
  .video-wrapper {
    position: sticky;
    top: 0;
    width: 100%;
    background: var(--gray-800);
    z-index: 20;
    box-shadow: var(--shadow-lg);
    max-height: 65vh;
    min-height: 280px;
    border-bottom: 5px solid var(--primary); /* Borde más grueso */
  }
  .video-inner {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* Ratio 16:9 */
    overflow: hidden;
  }
  .video-inner iframe {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
  .spacer { height: 12vh; }
  @media (max-width: 640px) { .spacer { height: 6vh; } }

  /* ====================== CONTENEDOR DE TARJETAS ====================== */
  .dialogue-container {
    padding: 30px 24px; /* Más padding para que respire */
  }

  /* ====================== TARJETAS ====================== */
  .line {
    background: white;
    padding: 24px;
    margin-bottom: 20px;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    transition: var(--transition);
    border-left: 5px solid transparent;
  }
  .line:hover {
    transform: translateY(-3px); /* Menos desplazamiento para que se sienta más sutil */
    box-shadow: var(--shadow-lg);
  }
  .line.active {
    border-left-color: var(--primary);
    background: #f8faff;
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2); /* Sombra más intensa */
    transition: background-color 0.5s ease, border-left-color 0.15s ease, box-shadow var(--transition); /* Transición suave */
  }
  .line-content {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .text-block {
    flex: 1;
    cursor: pointer;
    user-select: none;
  }
  .english {
    font-size: 19px; /* Fuente ligeramente más grande */
    font-weight: 700; /* Más énfasis en el inglés */
    color: var(--gray-800);
    line-height: 1.6;
    margin-bottom: 0;
  }
  .spanish {
    font-size: 16px;
    color: var(--gray-600);
    font-weight: 500;
    line-height: 1.6;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: var(--transition);
    margin-top: 0;
  }
  .spanish.visible {
    opacity: 1;
    max-height: 200px;
    margin-top: 10px; /* Separación sutil */
  }
  .controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-width: 100px;
  }
  .btn {
    padding: 10px 14px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .playBtn {
    background: var(--primary);
    color: white;
  }
  .playBtn:hover { background: var(--primary-dark); transform: translateY(-1px); }
  .playBtn[data-playing="true"] { background: #dc2626; } /* Color rojo de pausa */

  .speakBtn {
    background: var(--gray-200);
    color: var(--gray-800);
  }
  .speakBtn:hover { background: #cbd5e1; transform: translateY(-1px); }
  .speakBtn[data-speaking="true"] { background: #dc2626; color: white; } /* Color rojo de parada */

  /* ====================== RESPONSIVE ====================== */
  @media (max-width: 640px) {
    .dialogue-container { padding: 20px 16px; }
    .line { padding: 20px; }
    .line-content {
      flex-direction: column;
      text-align: center;
      gap: 16px;
    }
    .controls {
      flex-direction: row;
      width: 100%;
      justify-content: stretch;
    }
    .btn { flex: 1; padding: 12px; }
    .english { font-size: 17px; }
  }
</style>
</head>
<body>

    <div class="page-max-width">

    <div class="video-wrapper">
      <div class="video-inner">
        <div id="player"></div>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="dialogue-container">

       <div class="line" data-time="10">
  <div class="line-content">
    <div class="text-block">
      <div class="english">Thank you very much. Well, I would like to start with testicles. Men who sleep five hours</div>
      <div class="spanish">Muchas gracias. Bueno, me gustaría empezar con los testículos. Los hombres que duermen cinco horas</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="23">
  <div class="line-content">
    <div class="text-block">
      <div class="english">a night have significantly smaller testicles than those who sleep seven hours or more.</div>
      <div class="spanish">por noche tienen testículos significativamente más pequeños que los que duermen siete horas o más.</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
    </div>
</div>
<div class="line" data-time="29">
  <div class="line-content">
    <div class="text-block">
      <div class="english">In addition, men who routinely sleep just four to five hours a night will have a level of testosterone,</div>
      <div class="spanish">Además, los hombres que rutinariamente duermen solo de cuatro a cinco horas por noche tendrán un nivel de testosterona</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="39">
  <div class="line-content">
    <div class="text-block">
      <div class="english">which is that of someone ten years their senior. So a lack of sleep will age a man by a decade</div>
      <div class="spanish">que es el de alguien diez años mayor que él. Así que la falta de sueño envejecerá a un hombre una década</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="48">
  <div class="line-content">
    <div class="text-block">
      <div class="english">in terms of that critical aspect of wellness. And we see equivalent impermanence in female</div>
      <div class="spanish">en términos de ese aspecto crítico del bienestar. Y vemos un equivalente deterioro en la</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="56">
  <div class="line-content">
    <div class="text-block">
      <div class="english">reproductive health caused by a lack of sleep. This is the best news that I have for you today.</div>
      <div class="spanish">salud reproductiva femenina causada por la falta de sueño. Esta es la mejor noticia que tengo para ustedes hoy.</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="68">
  <div class="line-content">
    <div class="text-block">
      <div class="english">From this point, it may only get worse. Not only will I tell you about the wonderfully good things</div>
      <div class="spanish">A partir de este punto, puede que solo empeore. No solo les voy a contar las maravillosamente buenas cosas</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="73">
  <div class="line-content">
    <div class="text-block">
      <div class="english">that happen when you get sleep, but the alarmingly bad things that happen when you don't get enough.</div>
      <div class="spanish">que pasan cuando duermes, sino las alarmantemente malas cosas que pasan cuando no duermes lo suficiente.</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="79">
  <div class="line-content">
    <div class="text-block">
      <div class="english">Both for your brain and for your body. Let me start with the brain and the functions of learning</div>
      <div class="spanish">Tanto para tu cerebro como para tu cuerpo. Déjame empezar con el cerebro y las funciones del aprendizaje</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
<div class="line" data-time="87">
  <div class="line-content">
    <div class="text-block">
      <div class="english">in memory. Because what we've discovered over the past ten or so years is that you need sleep</div>
      <div class="spanish">y la memoria. Porque lo que hemos descubierto en los últimos diez años aproximadamente es que necesitas dormir</div>
    </div>
    <div class="controls">
      <button class="btn playBtn" data-action="play"><i class="fas fa-play"></i> Play</button>
      <button class="btn speakBtn" data-action="speak"><i class="fas fa-volume-up"></i> Speak</button>
    </div>
  </div>
</div>
    </div>   </div> <script>
let player;
let timeChecker = null;
let scrollEnabled = false;
let currentUtterance = null;
let currentTimeout = null;

// Estado para evitar solapamiento entre reproducción de video y síntesis de voz
const state = {
  isPlayingVideo: false,
  isSpeaking: false,
};

// ====== AJUSTES DE CALIBRACIÓN ======
const START_OFFSET = -1; // Desplazamiento de inicio para YouTube (en segundos)
const END_PADDING = 2.5; // Tiempo extra para asegurar que la línea completa se reproduzca

// ====== YouTube API ======
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: '5MuIMqhT8DM',
    playerVars: { 
      playsinline: 1, 
      rel: 0, 
      modestbranding: 1,
      enablejsapi: 1
    },
    events: { 
      onStateChange: onPlayerStateChange,
      onReady: onPlayerReady
    }
  });
}

function onPlayerReady() {
  // Pequeño "truco" para inicializar el video sin autoplay
  player.mute();
  player.playVideo();
  setTimeout(() => {
    player.pauseVideo();
    player.unMute();
    updateButtonIcons(null); // Asegura que los íconos de los botones estén en "Play"
  }, 300);
}

// Cargar API
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.head.appendChild(tag);


// ====== RESET Y GESTIÓN DE ESTADO ======
function resetAll() {
  // Cancelar síntesis de voz
  if (state.isSpeaking) {
    speechSynthesis.cancel();
    currentUtterance = null;
    state.isSpeaking = false;
  }

  // Limpiar timeout de reproducción de línea
  if (currentTimeout) {
    clearTimeout(currentTimeout);
    currentTimeout = null;
  }

  // Limpiar clase activa y botones
  document.querySelectorAll(".line.active").forEach(l => l.classList.remove("active"));
  updateButtonIcons(null);
}

function updateButtonIcons(activeBtn) {
  document.querySelectorAll(".playBtn").forEach(b => {
    if (b !== activeBtn) {
      b.innerHTML = '<i class="fas fa-play"></i> Play';
      delete b.dataset.playing;
    }
  });

  document.querySelectorAll(".speakBtn").forEach(b => {
    if (b !== activeBtn) {
      b.innerHTML = '<i class="fas fa-volume-up"></i> Speak';
      delete b.dataset.speaking;
    }
  });
}


// ====== SCROLL Y SINCRONIZACIÓN ======
function scrollLineToCenter(element) {
  const rect = element.getBoundingClientRect();
  const elementCenter = rect.top + rect.height / 2;
  const screenCenter = window.innerHeight / 2;
  const offset = elementCenter - screenCenter - 40; 

  window.scrollBy({ top: offset, behavior: 'smooth' });
}

function updateActiveLine(currentTime) {
  const lines = Array.from(document.querySelectorAll(".line"));
  let active = null;

  // Buscar la línea activa
  for (let i = 0; i < lines.length; i++) {
    const t = parseFloat(lines[i].dataset.time);
    const next = i < lines.length - 1 ? parseFloat(lines[i+1].dataset.time) : 99999;
    
    // Usa un pequeño offset para asegurar que la línea se activa antes de que el audio comience
    if (currentTime >= (t + START_OFFSET) && currentTime < next) {
      active = lines[i];
      break;
    }
  }

  // Aplicar o quitar la clase activa
  lines.forEach(l => {
    if (l === active && !l.classList.contains("active")) {
      l.classList.add("active");
      if (scrollEnabled) scrollLineToCenter(l);
    } else if (l !== active && l.classList.contains("active")) {
      l.classList.remove("active");
    }
  });
}

function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    state.isPlayingVideo = true;
    if (timeChecker) clearInterval(timeChecker);
    timeChecker = setInterval(() => updateActiveLine(player.getCurrentTime()), 200);
  } else {
    state.isPlayingVideo = false;
    if (timeChecker) clearInterval(timeChecker);
    if (event.data === YT.PlayerState.ENDED) {
      resetAll();
      scrollEnabled = false;
    }
  }
}


// ====== MANEJADORES DE EVENTOS CLICK (DELEGACIÓN) ======
document.addEventListener("click", e => {
  const btn = e.target.closest(".playBtn, .speakBtn");
  
  if (btn) {
    e.preventDefault();
    const action = btn.dataset.action;
    const line = btn.closest(".line");
    const rawStartTime = parseFloat(line.dataset.time);
    const startTime = Math.max(0, rawStartTime + START_OFFSET);

    if (action === 'play') {
      handlePlayClick(btn, line, startTime);
    } else if (action === 'speak') {
      handleSpeakClick(btn, line, startTime);
    }
  } else {
    // Manejar clic para mostrar/ocultar traducción
    const tb = e.target.closest(".text-block, .line");
    if (tb && !e.target.closest(".controls")) {
      toggleTranslation(tb);
    }
  }
});

function toggleTranslation(element) {
  const span = element.querySelector(".spanish");
  if (span) span.classList.toggle("visible");
}

// ====== LÓGICA DE REPRODUCCIÓN (YouTube) ======
function handlePlayClick(btn, line, startTime) {
  // Si ya está reproduciendo esa línea (por botón), pausar
  if (btn.dataset.playing === "true") {
    player.pauseVideo();
    btn.innerHTML = '<i class="fas fa-redo"></i> Replay'; // Opcional: Replay
    delete btn.dataset.playing;
    resetAll();
    line.classList.add("active"); // Mantener activa para contexto
    scrollEnabled = false;
    return;
  }

  // Resetear todo y preparar para la nueva reproducción
  resetAll();

  // Calcular duración
  const allLines = Array.from(document.querySelectorAll(".line"));
  const idx = allLines.indexOf(line);
  const rawEndTime = idx < allLines.length - 1 ? parseFloat(allLines[idx + 1].dataset.time) : rawStartTime + 25;
  const endTime = rawEndTime + END_PADDING;
  const duration = (endTime - startTime) * 1000;

  // Iniciar reproducción
  player.seekTo(startTime, true);
  player.playVideo();

  // Actualizar estado de los botones
  btn.innerHTML = '<i class="fas fa-pause"></i> Pause';
  btn.dataset.playing = "true";
  line.classList.add("active");
  scrollEnabled = false; // No scroll automático, es una acción manual

  // Timeout para detener la reproducción
  currentTimeout = setTimeout(() => {
    player.pauseVideo();
    state.isPlayingVideo = false;
    
    btn.innerHTML = '<i class="fas fa-redo"></i> Replay';
    delete btn.dataset.playing;
    resetAll();
    line.classList.add("active");
  }, duration);
}

// ====== LÓGICA DE SÍNTESIS DE VOZ (SpeechSynthesis) ======
function handleSpeakClick(btn, line, startTime) {
  const text = line.querySelector(".english").innerText;

  // Si ya está hablando, detener (funciona como Pause/Stop)
  if (state.isSpeaking) {
    speechSynthesis.cancel();
    return; // onend se encargará del resto
  }

  // Resetear todo y preparar para la nueva síntesis
  resetAll();

  // Preparar el video para el contexto (opcional)
  if (player) {
    player.seekTo(startTime, true);
    player.pauseVideo();
  }

  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  utter.rate = 0.95; // Ligeramente más lento para mejor pronunciación

  utter.onstart = () => {
    state.isSpeaking = true;
    btn.innerHTML = '<i class="fas fa-stop"></i> Stop';
    btn.dataset.speaking = "true";
    line.classList.add("active");
    scrollEnabled = false;
  };

  utter.onend = () => {
    state.isSpeaking = false;
    btn.innerHTML = '<i class="fas fa-volume-up"></i> Speak';
    delete btn.dataset.speaking;
    resetAll();
    line.classList.add("active");
    currentUtterance = null;
  };

  utter.onerror = (event) => {
    console.error('SpeechSynthesis Error: ', event);
    // Forzar el reset en caso de error
    state.isSpeaking = false;
    btn.innerHTML = '<i class="fas fa-volume-up"></i> Speak';
    delete btn.dataset.speaking;
    resetAll();
    line.classList.add("active");
    currentUtterance = null;
  };

  currentUtterance = utter;
  speechSynthesis.speak(utter);
}
</script>
</body>
</html>
