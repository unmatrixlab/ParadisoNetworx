<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LINGUA NEXUS | v6.0 Hybrid</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           1. THEME VARIABLES (Dynamic)
           ========================================================================== */
        :root {
            /* DARK MODE (Default) */
            --bg-deep: #050507;
            --bg-card: #121216;
            --bg-input: #1a1a20;
            --txt-main: #f8fafc;
            --txt-sec: #94a3b8;
            --border-color: rgba(255,255,255,0.08);
            
            /* Accents */
            --c-noun: #22d3ee; --c-adj: #e879f9; --c-reg: #4ade80; --c-irreg:#fbbf24; --c-func: #818cf8;
            --primary: #3b82f6; --success: #10b981; --danger: #ef4444; --warn: #f59e0b;
            
            --font-head: 'Bebas Neue', sans-serif; --font-ui: 'Inter', sans-serif; --font-code: 'JetBrains Mono', monospace;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* LIGHT MODE OVERRIDES */
        body.light-mode {
            --bg-deep: #f1f5f9;
            --bg-card: #ffffff;
            --bg-input: #e2e8f0;
            --txt-main: #0f172a;
            --txt-sec: #64748b;
            --border-color: rgba(0,0,0,0.08);
            /* Darker accents for light bg readability */
            --c-noun: #0891b2; --c-adj: #c026d3; --c-reg: #16a34a; --c-irreg:#d97706; --c-func: #4f46e5;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            background-color: var(--bg-deep); color: var(--txt-main); 
            font-family: var(--font-ui); margin: 0; height: 100vh; 
            display: flex; flex-direction: column; overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ==========================================================================
           2. HEADER & CONTROLS
           ========================================================================== */
        header { 
            height: 60px; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; background: var(--bg-card); 
            border-bottom: 1px solid var(--border-color); z-index: 50;
            transition: background 0.3s;
        }
        .brand { font-family: var(--font-head); font-size: 24px; letter-spacing: 1px; }
        
        .header-actions { display: flex; gap: 15px; }
        .icon-btn { 
            background: none; border: none; color: var(--txt-sec); cursor: pointer; 
            transition: 0.2s; display: flex; align-items: center; justify-content: center; 
        }
        .icon-btn:hover { color: var(--primary); transform: scale(1.1); }

        /* ==========================================================================
           3. LAYOUT & VIEWS
           ========================================================================== */
        main { 
            flex: 1; position: relative; overflow-y: auto; overflow-x: hidden; 
            padding-bottom: calc(140px + var(--safe-bottom)); scroll-behavior: smooth; 
        }

        .view-screen { 
            display: none; flex-direction: column; align-items: center; padding: 20px; 
            max-width: 600px; margin: 0 auto; animation: fadeIn 0.3s ease; 
        }
        .view-screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ==========================================================================
           4. SETTINGS UI (NEW INPUTS)
           ========================================================================== */
        .config-box {
            width: 100%; background: var(--bg-card); border-radius: 16px;
            border: 1px solid var(--border-color); padding: 20px; margin-bottom: 20px;
        }
        .config-title { font-family: var(--font-head); font-size: 20px; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .control-label { font-size: 14px; font-weight: 600; color: var(--txt-sec); }
        
        /* Custom Number Input Styling */
        .num-stepper {
            background: var(--bg-input); color: var(--txt-main);
            border: 1px solid var(--border-color); border-radius: 8px;
            padding: 8px 12px; font-family: var(--font-code); font-size: 16px;
            width: 80px; text-align: center;
        }
        /* Hide arrows in some browsers to style custom if needed, but keeping standard for functionality */

        /* ==========================================================================
           5. GAME & LIBRARY
           ========================================================================== */
        .word-display { margin: 20px 0 40px 0; text-align: center; width: 100%; }
        .ctx-pill { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; background: var(--bg-input); color: var(--txt-sec); margin-bottom: 15px; }
        .big-word { font-size: clamp(32px, 8vw, 56px); font-weight: 800; line-height: 1.1; color: var(--txt-main); text-shadow: 0 0 30px rgba(0,0,0,0.05); }
        
        .input-grid { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .input-row { position: relative; width: 100%; }
        .input-label { position: absolute; top: 12px; left: 15px; font-size: 9px; font-weight: bold; color: var(--txt-sec); letter-spacing: 1px; pointer-events: none; }
        
        .game-input { 
            width: 100%; background: var(--bg-card); border: 1px solid var(--border-color); 
            border-radius: 12px; padding: 28px 15px 12px 15px; 
            font-family: var(--font-code); font-size: 18px; color: var(--txt-main); 
            text-transform: uppercase; transition: 0.2s; 
        }
        .game-input:focus { border-color: var(--primary); background: var(--bg-input); }
        
        .input-row.correct .game-input { border-color: var(--success); color: var(--success); background: rgba(16, 185, 129, 0.05); }
        .input-row.error .game-input { border-color: var(--danger); color: var(--danger); }

        .btn-check { width: 100%; padding: 18px; border-radius: 14px; border: none; background: var(--bg-input); color: var(--txt-sec); font-family: var(--font-head); font-size: 24px; margin-top: 30px; letter-spacing: 1px; cursor: not-allowed; transition: 0.3s; }
        .btn-check.ready { background: var(--primary); color: #fff; cursor: pointer; box-shadow: 0 10px 30px -5px rgba(59, 130, 246, 0.4); }

        /* LIBRARY */
        .lib-search { width: 100%; background: var(--bg-card); border: 1px solid var(--border-color); padding: 12px; border-radius: 8px; color: var(--txt-main); margin-bottom: 15px; }
        .lib-item { padding: 12px; background: var(--bg-card); border-radius: 8px; border: 1px solid transparent; margin-bottom: 8px; }
        .prog-track { height: 4px; background: var(--bg-input); border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .prog-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        
        .lvl-1 .prog-fill { background: var(--danger); }
        .lvl-2 .prog-fill { background: var(--warn); }
        .lvl-3 .prog-fill { background: var(--primary); }
        .lvl-4 .prog-fill { background: var(--success); }

        /* DOCK */
        .dock-container { 
            position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; 
            background: var(--bg-card); 
            /* Subtle glass effect compatible with themes */
            background: rgba(var(--bg-card), 0.9);
            border-top: 1px solid var(--border-color); padding-bottom: var(--safe-bottom); 
            height: calc(110px + var(--safe-bottom)); display: flex; align-items: center; 
        }
        .dock-scroll { display: flex; align-items: center; gap: 15px; padding: 0 25px; width: 100%; overflow-x: auto; scrollbar-width: none; }
        .dock-item { flex-shrink: 0; height: 70px; min-width: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0.5; transition: 0.3s; color: var(--txt-sec); }
        .dock-item span { font-family: var(--font-head); font-size: 26px; line-height: 1; letter-spacing: 0.5px; }
        .dock-bar { margin-top: 6px; width: 4px; height: 4px; border-radius: 50%; background: transparent; transition: 0.3s; }
        
        .dock-item.active { opacity: 1; transform: translateY(-5px); color: var(--txt-main); }
        .dock-item.active .dock-bar { width: 20px; background: currentColor; }
        
        /* Colored Dock Items */
        .dock-item[data-c="nouns"].active { color: var(--c-noun); } 
        .dock-item[data-c="adj"].active { color: var(--c-adj); }
        .dock-item[data-c="reg"].active { color: var(--c-reg); } 
        .dock-item[data-c="irreg"].active { color: var(--c-irreg); }
        .dock-item[data-c="func"].active { color: var(--c-func); }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .card { background: var(--bg-card); padding: 20px; border-radius: 16px; border: 1px solid var(--border-color); text-align: center; }
        .card h3 { margin: 0; font-family: var(--font-head); font-size: 24px; color: var(--txt-main); }
        .card small { color: var(--txt-sec); font-size: 10px; display: block; margin-top: 5px; }

        .dash-stat-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; width: 100%; }
        .stat-card { background: var(--bg-card); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color); }
        .stat-num { font-size: 28px; font-weight: 800; font-family: var(--font-code); color: var(--txt-main); }
    </style>
</head>
<body>

    <script src="https://paradisonetworx.com/database.js"></script>

    <header>
        <div class="brand">LINGUA NEXUS</div>
        <div class="header-actions">
            <button class="icon-btn" onclick="Profile.toggleTheme()" title="Toggle Dark/Light Mode">
                <svg id="icon-theme" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button class="icon-btn" onclick="App.nav('settings')">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"></path><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"></path></svg>
            </button>
        </div>
    </header>

    <main>
        <div id="view-home" class="view-screen active">
            <h1 style="font-family:var(--font-head); font-size:42px; margin-bottom:10px;">TRAINING HUB</h1>
            
            <div class="dash-stat-box">
                <div class="stat-card">
                    <div class="stat-num" style="color:var(--success)" id="stat-mastered">0</div>
                    <div style="font-size:10px; color:var(--txt-sec);">MASTERED (LVL 4)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-num" style="color:var(--warn)" id="stat-learning">0</div>
                    <div style="font-size:10px; color:var(--txt-sec);">IN PROGRESS</div>
                </div>
            </div>

            <div class="grid">
                <div class="card" onclick="App.start('nouns')"><h3 style="color:var(--c-noun)">NOUNS</h3><small>Objects</small></div>
                <div class="card" onclick="App.start('adjectives')"><h3 style="color:var(--c-adj)">ADJECTIVES</h3><small>Descriptors</small></div>
                <div class="card" onclick="App.start('verbs_irreg')"><h3 style="color:var(--c-irreg)">IRREGULAR</h3><small>Verbs Matrix</small></div>
                <div class="card" onclick="App.start('functionals')"><h3 style="color:var(--c-func)">SYNTAX</h3><small>Logic</small></div>
            </div>
        </div>

        <div id="view-settings" class="view-screen">
            <h1 style="font-family:var(--font-head); font-size:32px; margin-bottom:20px;">SYSTEM CONFIG</h1>
            
            <div class="config-box">
                <div class="config-title">SESSION LIMITS</div>
                <div style="font-size:11px; color:var(--txt-sec); margin-bottom:15px;">
                    Session ends when whichever limit is reached first. Set 0 for infinite.
                </div>
                
                <div class="control-row">
                    <span class="control-label">Max Word Count</span>
                    <input type="number" id="inp-limit-count" class="num-stepper" min="1" max="100" value="10" onchange="Profile.updateConfig()">
                </div>
                
                <div class="control-row">
                    <span class="control-label">Time Limit (Minutes)</span>
                    <input type="number" id="inp-limit-time" class="num-stepper" min="0" max="60" value="0" onchange="Profile.updateConfig()">
                </div>
            </div>

            <div class="config-box">
                <div class="config-title">DATA MANAGEMENT</div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span class="control-label" style="color:var(--danger)">Reset Progress</span>
                    <button onclick="Profile.reset()" class="btn-check" style="margin:0; padding:10px; font-size:12px; width:auto; background:var(--danger); color:#fff;">WIPE ALL</button>
                </div>
            </div>

            <input type="text" class="lib-search" placeholder="Search dictionary..." onkeyup="App.renderLibrary(this.value)">
            <div id="lib-container" style="width:100%;"></div>
        </div>

        <div id="view-game" class="view-screen">
            <div class="word-display">
                <div class="ctx-pill" id="lbl-ctx">LOADING</div>
                <div class="big-word" id="lbl-word">...</div>
            </div>
            <div class="input-grid" id="input-area"></div>
            <button id="btn-submit" class="btn-check" onclick="App.validate()">CONFIRM ANSWER</button>
        </div>
    </main>

    <div class="dock-container">
        <div class="dock-scroll">
            <div class="dock-item active" data-c="dash" onclick="App.nav('home')"><span>HOME</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="nouns" onclick="App.start('nouns')"><span>NOUNS</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="adj" onclick="App.start('adjectives')"><span>ADJ</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="reg" onclick="App.start('verbs_reg')"><span>REGULAR</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="irreg" onclick="App.start('verbs_irreg')"><span>IRREGULAR</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="func" onclick="App.start('functionals')"><span>LOGIC</span><div class="dock-bar"></div></div>
        </div>
    </div>

<script>
/**
 * LINGUA NEXUS | v6.0 Hybrid
 * Features: Dark/Light Mode, Hybrid Session Limits (Time/Count), Mastery Levels
 */

const Profile = {
    key: 'LN_v6_Config',
    data: {
        limitCount: 10,  // Number of words
        limitTime: 0,    // Minutes (0 = infinite)
        theme: 'dark',   // 'dark' or 'light'
        progress: {}     // {word: level}
    },

    init() {
        const saved = localStorage.getItem(this.key);
        if(saved) this.data = JSON.parse(saved);
        
        // Apply Settings
        this.applyTheme();
        document.getElementById('inp-limit-count').value = this.data.limitCount || 10;
        document.getElementById('inp-limit-time').value = this.data.limitTime || 0;
        
        this.updateStats();
    },

    save() {
        localStorage.setItem(this.key, JSON.stringify(this.data));
        this.updateStats();
    },

    // --- THEME LOGIC ---
    toggleTheme() {
        this.data.theme = this.data.theme === 'dark' ? 'light' : 'dark';
        this.applyTheme();
        this.save();
    },

    applyTheme() {
        const body = document.body;
        const icon = document.getElementById('icon-theme');
        
        if(this.data.theme === 'light') {
            body.classList.add('light-mode');
            // Sun Icon
            icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
        } else {
            body.classList.remove('light-mode');
            // Moon Icon
            icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
        }
    },

    // --- CONFIG LOGIC ---
    updateConfig() {
        const c = parseInt(document.getElementById('inp-limit-count').value) || 5;
        const t = parseInt(document.getElementById('inp-limit-time').value) || 0;
        this.data.limitCount = c;
        this.data.limitTime = t;
        this.save();
    },

    // --- MASTERY LOGIC ---
    getLevel(word) { return this.data.progress[word] || 0; },
    
    updateWord(word, isSuccess) {
        let current = this.getLevel(word);
        if(isSuccess) { if(current < 4) current++; }
        else { current = (current === 4) ? 2 : 0; }
        this.data.progress[word] = current;
        this.save();
    },

    reset() {
        if(confirm("WIPE ALL DATA? This cannot be undone.")) {
            this.data.progress = {};
            this.save();
            App.renderLibrary();
        }
    },

    updateStats() {
        let m=0, l=0;
        Object.values(this.data.progress).forEach(lvl => {
            if(lvl===4) m++; else if(lvl>0) l++;
        });
        const mEl = document.getElementById('stat-mastered');
        const lEl = document.getElementById('stat-learning');
        if(mEl) mEl.innerText = m;
        if(lEl) lEl.innerText = l;
    }
};

const DB = {
    source: {},
    async load() {
        return new Promise(resolve => {
            const i = setInterval(() => {
                if(typeof INTERNAL_VOCAB !== 'undefined') {
                    this.source = INTERNAL_VOCAB;
                    clearInterval(i);
                    Profile.init();
                    resolve();
                }
            }, 100);
        });
    },
    fetch(cat) {
        let key = '';
        if(cat === 'nouns') key = 'NOUNS';
        if(cat === 'adjectives') key = 'ADJECTIVES';
        if(cat === 'verbs_reg') key = 'REGULAR_VERBS';
        if(cat === 'verbs_irreg') key = 'IRREGULAR_VERBS';
        if(cat === 'functionals') key = 'FUNCTION WORDS';
        
        const list = this.source[key] || [];
        // We fetch enough words to cover a large session, limits handled in App
        return list
            .map(i => ({...i, lvl: Profile.getLevel(i.en)}))
            .sort((a,b) => {
                if(a.lvl < 4 && b.lvl === 4) return -1;
                if(a.lvl === 4 && b.lvl < 4) return 1;
                return 0.5 - Math.random();
            })
            .slice(0, 50) // Buffer fetch
            .map(i => ({...i, isTriad: (cat.includes('verbs'))}));
    },
    getAll() {
        let all=[];
        Object.keys(this.source).forEach(k=>this.source[k].forEach(i=>all.push({...i, type:k})));
        return all;
    }
};

const App = {
    queue: [],
    curr: 0,
    startTime: 0,
    hasFailedCurrent: false,

    async init() { await DB.load(); this.nav('home'); },

    nav(view) {
        document.querySelectorAll('.view-screen').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${view}`).classList.add('active');
        
        if(view === 'settings') this.renderLibrary();

        // Dock
        document.querySelectorAll('.dock-item').forEach(el => el.classList.remove('active'));
        if(view === 'home' || view === 'settings') document.querySelector('[data-c="dash"]').classList.add('active');
        else {
            const m = document.querySelector(`.dock-item[onclick*="${view}"]`);
            if(m) m.classList.add('active');
        }
    },

    start(cat) {
        this.queue = DB.fetch(cat);
        this.curr = 0;
        this.startTime = Date.now(); // Start Timer
        this.nav('game');
        
        const color = getComputedStyle(document.querySelector(`.dock-item[onclick*="${cat}"]`)).color;
        document.getElementById('lbl-ctx').style.color = color;
        document.getElementById('lbl-ctx').innerText = cat.toUpperCase();
        this.render();
    },

    render() {
        // --- HYBRID LIMIT CHECKER ---
        const limitCount = Profile.data.limitCount;
        const limitTime = Profile.data.limitTime; // minutes
        
        // 1. Count Check
        if(this.curr >= limitCount) {
            alert("SESSION GOAL REACHED!");
            this.nav('home');
            return;
        }

        // 2. Time Check (Calculated at render time, could also be an interval)
        if(limitTime > 0) {
            const elapsedMin = (Date.now() - this.startTime) / 60000;
            if(elapsedMin >= limitTime) {
                alert("TIME'S UP!");
                this.nav('home');
                return;
            }
        }
        
        // Safety check for empty queue
        if(this.curr >= this.queue.length) { this.nav('home'); return; }

        const item = this.queue[this.curr];
        this.hasFailedCurrent = false;

        const area = document.getElementById('input-area');
        area.innerHTML = '';
        const btn = document.getElementById('btn-submit');
        btn.classList.remove('ready'); btn.disabled = true;

        const display = Array.isArray(item.es) ? item.es.join(" / ") : item.es;
        document.getElementById('lbl-word').innerText = display;

        if(item.isTriad) {
            this.addInput(area, 'BASE', item.en);
            this.addInput(area, 'PAST', item.past);
            this.addInput(area, 'PARTICIPLE', item.part);
        } else {
            this.addInput(area, 'ENGLISH', item.en);
        }
        setTimeout(() => area.querySelector('input').focus(), 100);
    },

    addInput(parent, label, ans) {
        const d = document.createElement('div');
        d.className = 'input-row';
        d.innerHTML = `<span class="input-label">${label}</span><input type="text" class="game-input" data-ans="${ans}" autocomplete="off">`;
        const i = d.querySelector('input');
        i.addEventListener('input', () => this.check());
        i.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const all = document.querySelectorAll('.game-input');
                const idx = Array.from(all).indexOf(e.target);
                if(idx < all.length-1) all[idx+1].focus(); else this.validate();
            }
        });
        parent.appendChild(d);
    },

    check() {
        const filled = Array.from(document.querySelectorAll('.game-input')).every(i => i.value.trim().length > 0);
        const btn = document.getElementById('btn-submit');
        if(filled) { btn.classList.add('ready'); btn.disabled = false; }
        else { btn.classList.remove('ready'); btn.disabled = true; }
    },

    validate() {
        const btn = document.getElementById('btn-submit');
        if(!btn.classList.contains('ready')) return;

        // Double check time limit before validating
        if(Profile.data.limitTime > 0) {
            const elapsed = (Date.now() - this.startTime) / 60000;
            if(elapsed >= Profile.data.limitTime) {
                alert("TIME'S UP!");
                this.nav('home');
                return;
            }
        }

        const item = this.queue[this.curr];
        const inputs = document.querySelectorAll('.game-input');
        let allOk = true;

        inputs.forEach(inp => {
            const val = inp.value.trim().toLowerCase();
            const cor = inp.dataset.ans.toLowerCase();
            const row = inp.parentElement;
            row.classList.remove('error', 'correct');
            if(val === cor) { row.classList.add('correct'); }
            else { allOk = false; row.classList.add('error'); inp.value = ''; inp.placeholder = cor.toUpperCase(); }
        });

        if(!allOk) {
            this.hasFailedCurrent = true;
            btn.classList.remove('ready'); btn.disabled = true;
            Profile.updateWord(item.en, false);
        } else {
            if(!this.hasFailedCurrent) Profile.updateWord(item.en, true);
            
            let txt = item.en;
            if(item.isTriad) txt = `${item.en}, ${item.past}, ${item.part}`;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(txt);
            u.lang = 'en-US';
            window.speechSynthesis.speak(u);

            setTimeout(() => { this.curr++; this.render(); }, 1200);
        }
    },

    renderLibrary(filter='') {
        const c = document.getElementById('lib-container');
        c.innerHTML = '';
        const words = DB.getAll();
        const search = filter.toLowerCase();

        words.forEach(w => {
            if(filter && !w.en.toLowerCase().includes(search)) return;
            const lvl = Profile.getLevel(w.en);
            const pct = lvl * 25;
            
            const div = document.createElement('div');
            div.className = `lib-item lvl-${lvl}`;
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; color:var(--txt-main); font-weight:bold;">
                    <span>${w.en}</span>
                    <span style="font-family:var(--font-code); font-size:10px; opacity:0.6;">LVL ${lvl}</span>
                </div>
                <div style="font-size:12px; color:var(--txt-sec); margin-top:2px;">${Array.isArray(w.es)?w.es[0]:w.es}</div>
                <div class="prog-track"><div class="prog-fill" style="width:${pct}%"></div></div>
            `;
            c.appendChild(div);
        });
    }
};

window.onload = () => App.init();
</script>
</body>
</html>
