<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LINGUA NEXUS | Deep Learning v5.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           1. STYLES (Optimized for v5)
           ========================================================================== */
        :root {
            --bg-deep: #050507; --bg-card: #121216;
            --c-noun: #22d3ee; --c-adj: #e879f9; --c-reg: #4ade80; --c-irreg:#fbbf24; --c-func: #818cf8;
            --primary: #3b82f6; --success: #10b981; --danger: #ef4444; --warn: #f59e0b;
            --font-head: 'Bebas Neue', sans-serif; --font-ui: 'Inter', sans-serif; --font-code: 'JetBrains Mono', monospace;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background-color: var(--bg-deep); color: #f8fafc; font-family: var(--font-ui); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        header { height: 60px; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; background: rgba(5, 5, 7, 0.9); border-bottom: 1px solid rgba(255,255,255,0.05); z-index: 50; }
        .brand { font-family: var(--font-head); font-size: 24px; color: #fff; letter-spacing: 1px; }
        .icon-btn { background: none; border: none; color: #94a3b8; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }

        main { flex: 1; position: relative; overflow-y: auto; overflow-x: hidden; padding-bottom: calc(140px + var(--safe-bottom)); scroll-behavior: smooth; }
        .view-screen { display: none; flex-direction: column; align-items: center; padding: 20px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .view-screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* LIBRARY & PROGRESS BARS */
        .lib-search { width: 100%; background: #000; border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; color: #fff; font-family: var(--font-ui); margin-bottom: 15px; }
        .lib-list { width: 100%; display: flex; flex-direction: column; gap: 8px; }
        .lib-item { padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid transparent; }
        
        .prog-track { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 8px; overflow: hidden; position: relative; }
        .prog-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        
        /* Level Colors */
        .lvl-1 .prog-fill { background: var(--danger); } /* Novice */
        .lvl-2 .prog-fill { background: var(--warn); }   /* Apprentice */
        .lvl-3 .prog-fill { background: var(--primary); }/* Pro */
        .lvl-4 .prog-fill { background: var(--success); }/* Master */
        
        .lib-meta { display: flex; justify-content: space-between; font-size: 10px; color: #666; margin-top: 4px; font-family: var(--font-code); }

        /* GAME UI */
        .word-display { margin: 20px 0 40px 0; text-align: center; width: 100%; }
        .ctx-pill { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; background: rgba(255,255,255,0.05); color: #94a3b8; margin-bottom: 15px; }
        .big-word { font-size: clamp(32px, 8vw, 56px); font-weight: 800; line-height: 1.1; text-shadow: 0 0 30px rgba(255,255,255,0.1); }
        .input-grid { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .input-row { position: relative; width: 100%; }
        .input-label { position: absolute; top: 12px; left: 15px; font-size: 9px; font-weight: bold; color: rgba(255,255,255,0.3); letter-spacing: 1px; pointer-events: none; }
        .game-input { width: 100%; background: var(--bg-card); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 28px 15px 12px 15px; font-family: var(--font-code); font-size: 18px; color: #fff; text-transform: uppercase; transition: 0.2s; }
        .game-input:focus { border-color: var(--primary); background: #1a1a20; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15); }
        .input-row.correct .game-input { border-color: var(--success); color: var(--success); background: rgba(16, 185, 129, 0.05); }
        .input-row.error .game-input { border-color: var(--danger); color: var(--danger); }
        .btn-check { width: 100%; padding: 18px; border-radius: 14px; border: none; background: #2a2a30; color: #666; font-family: var(--font-head); font-size: 24px; margin-top: 30px; letter-spacing: 1px; cursor: not-allowed; transition: 0.3s; }
        .btn-check.ready { background: var(--primary); color: #fff; cursor: pointer; box-shadow: 0 10px 30px -5px rgba(59, 130, 246, 0.4); }

        /* DOCK */
        .dock-container { position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; background: rgba(5, 5, 7, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.08); padding-bottom: var(--safe-bottom); height: calc(110px + var(--safe-bottom)); display: flex; align-items: center; }
        .dock-scroll { display: flex; align-items: center; gap: 15px; padding: 0 25px; width: 100%; overflow-x: auto; scrollbar-width: none; }
        .dock-item { flex-shrink: 0; height: 70px; min-width: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0.5; transition: 0.3s; }
        .dock-item span { font-family: var(--font-head); font-size: 26px; line-height: 1; color: #fff; letter-spacing: 0.5px; }
        .dock-bar { margin-top: 6px; width: 4px; height: 4px; border-radius: 50%; background: transparent; transition: 0.3s; }
        .dock-item.active { opacity: 1; transform: translateY(-5px); }
        .dock-item.active .dock-bar { width: 20px; background: currentColor; box-shadow: 0 0 10px currentColor; }
        .dock-item[data-c="nouns"] { color: var(--c-noun); } .dock-item[data-c="adj"] { color: var(--c-adj); }
        .dock-item[data-c="reg"] { color: var(--c-reg); } .dock-item[data-c="irreg"] { color: var(--c-irreg); }
        .dock-item[data-c="func"] { color: var(--c-func); } .dock-item[data-c="dash"] { color: #fff; }

        .dash-stat-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; width: 100%; }
        .stat-card { background: var(--bg-card); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-num { font-size: 28px; font-weight: 800; font-family: var(--font-code); }
        .stat-lbl { font-size: 10px; color: #666; margin-top: 4px; letter-spacing: 1px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .card { background: var(--bg-card); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); text-align: center; }
        .card h3 { margin: 0; font-family: var(--font-head); font-size: 24px; color: #fff; }
        .card small { color: #666; font-size: 10px; display: block; margin-top: 5px; }
    </style>
</head>
<body>

    <script src="https://paradisonetworx.com/database.js"></script>

    <header>
        <div class="brand">LINGUA NEXUS</div>
        <button class="icon-btn" onclick="App.nav('settings')">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"></path><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"></path></svg>
        </button>
    </header>

    <main>
        <div id="view-home" class="view-screen active">
            <h1 style="font-family:var(--font-head); font-size:42px; margin-bottom:10px;">TRAINING HUB</h1>
            
            <div class="dash-stat-box">
                <div class="stat-card">
                    <div class="stat-num" style="color:var(--success)" id="stat-mastered">0</div>
                    <div class="stat-lbl">MASTERED (LVL 4)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-num" style="color:var(--warn)" id="stat-learning">0</div>
                    <div class="stat-lbl">IN PROGRESS</div>
                </div>
            </div>

            <div class="grid">
                <div class="card" onclick="App.start('nouns')"><h3 style="color:var(--c-noun)">NOUNS</h3><small>Objects</small></div>
                <div class="card" onclick="App.start('adjectives')"><h3 style="color:var(--c-adj)">ADJECTIVES</h3><small>Descriptors</small></div>
                <div class="card" onclick="App.start('verbs_irreg')"><h3 style="color:var(--c-irreg)">IRREGULAR</h3><small>Verbs Matrix</small></div>
                <div class="card" onclick="App.start('functionals')"><h3 style="color:var(--c-func)">SYNTAX</h3><small>Logic</small></div>
            </div>
        </div>

        <div id="view-settings" class="view-screen">
            <h1 style="font-family:var(--font-head); font-size:32px; margin-bottom:20px;">DATABASE & PROGRESS</h1>
            
            <div style="width:100%; margin-bottom:20px; display:flex; gap:10px;">
                <button onclick="Profile.setBatch(10)" class="btn-check" style="margin:0; padding:10px; font-size:14px; background:#333;">BATCH: 10</button>
                <button onclick="Profile.reset()" class="btn-check" style="margin:0; padding:10px; font-size:14px; background:#300; color:#f55;">RESET ALL</button>
            </div>

            <input type="text" class="lib-search" placeholder="Search dictionary..." onkeyup="App.renderLibrary(this.value)">
            <div class="lib-list" id="lib-container"></div>
        </div>

        <div id="view-game" class="view-screen">
            <div class="word-display">
                <div class="ctx-pill" id="lbl-ctx">LOADING</div>
                <div class="big-word" id="lbl-word">...</div>
            </div>
            <div class="input-grid" id="input-area"></div>
            <button id="btn-submit" class="btn-check" onclick="App.validate()">CONFIRM ANSWER</button>
        </div>
    </main>

    <div class="dock-container">
        <div class="dock-scroll">
            <div class="dock-item active" data-c="dash" onclick="App.nav('home')"><span>HOME</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="nouns" onclick="App.start('nouns')"><span>NOUNS</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="adj" onclick="App.start('adjectives')"><span>ADJ</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="reg" onclick="App.start('verbs_reg')"><span>REGULAR</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="irreg" onclick="App.start('verbs_irreg')"><span>IRREGULAR</span><div class="dock-bar"></div></div>
            <div class="dock-item" data-c="func" onclick="App.start('functionals')"><span>LOGIC</span><div class="dock-bar"></div></div>
        </div>
    </div>

<script>
/**
 * LINGUA NEXUS | v5.0 Deep Learning Core
 * Implements Weighted Mastery System (0-4 Levels)
 */

const Profile = {
    key: 'LN_v5_Core',
    data: {
        batchSize: 10,
        // Map: { "word_en": integer_level }
        // Levels: 0=New, 1=Novice, 2=Apprentice, 3=Pro, 4=Mastered
        progress: {} 
    },

    init() {
        const saved = localStorage.getItem(this.key);
        if(saved) this.data = JSON.parse(saved);
        this.updateStats();
    },

    save() {
        localStorage.setItem(this.key, JSON.stringify(this.data));
        this.updateStats();
    },

    setBatch(n) {
        this.data.batchSize = n;
        this.save();
        alert(`Batch size set to ${n}`);
    },

    reset() {
        if(confirm("DELETE ALL LEARNING DATA?")) {
            this.data.progress = {};
            this.save();
            App.renderLibrary();
        }
    },

    getLevel(word) {
        return this.data.progress[word] || 0;
    },

    // THE ALGORITHM: Reinforcement Logic
    updateWord(word, isSuccess) {
        let current = this.getLevel(word);

        if(isSuccess) {
            // Success increases level. Capped at 4.
            if(current < 4) current++;
        } else {
            // Failure is punishing. 
            // If Master (4) -> Drop to 2 (Warning)
            // If < 4 -> Reset to 0 (Start Over)
            if(current === 4) current = 2;
            else current = 0;
        }

        this.data.progress[word] = current;
        this.save();
        return current;
    },

    updateStats() {
        let mastered = 0;
        let learning = 0;
        Object.values(this.data.progress).forEach(lvl => {
            if(lvl === 4) mastered++;
            if(lvl > 0 && lvl < 4) learning++;
        });
        const mEl = document.getElementById('stat-mastered');
        const lEl = document.getElementById('stat-learning');
        if(mEl) mEl.innerText = mastered;
        if(lEl) lEl.innerText = learning;
    }
};

const DB = {
    source: {},
    async load() {
        return new Promise(resolve => {
            const i = setInterval(() => {
                if(typeof INTERNAL_VOCAB !== 'undefined') {
                    this.source = INTERNAL_VOCAB;
                    clearInterval(i);
                    Profile.init();
                    resolve();
                }
            }, 100);
        });
    },
    fetch(cat) {
        let key = '';
        if(cat === 'nouns') key = 'NOUNS';
        if(cat === 'adjectives') key = 'ADJECTIVES';
        if(cat === 'verbs_reg') key = 'REGULAR_VERBS';
        if(cat === 'verbs_irreg') key = 'IRREGULAR_VERBS';
        if(cat === 'functionals') key = 'FUNCTION WORDS';
        
        const list = this.source[key] || [];
        const limit = Profile.data.batchSize;
        
        // Intelligent Sort: Prioritize low levels (0-3) over Mastered (4)
        return list
            .map(i => ({...i, lvl: Profile.getLevel(i.en)}))
            .sort((a,b) => {
                // Prioritize unlearned words randomly
                if(a.lvl < 4 && b.lvl === 4) return -1;
                if(a.lvl === 4 && b.lvl < 4) return 1;
                return 0.5 - Math.random();
            })
            .slice(0, limit)
            .map(i => ({
                ...i,
                isTriad: (cat.includes('verbs'))
            }));
    },
    getAll() {
        let all = [];
        Object.keys(this.source).forEach(k => {
            this.source[k].forEach(i => all.push({...i, type: k}));
        });
        return all;
    }
};

const App = {
    queue: [],
    curr: 0,
    hasFailedCurrent: false, // Tracks if user failed THIS card in THIS session

    async init() {
        await DB.load();
        this.nav('home');
    },

    nav(view) {
        document.querySelectorAll('.view-screen').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${view}`).classList.add('active');
        
        document.querySelectorAll('.dock-item').forEach(el => el.classList.remove('active'));
        if(view === 'home' || view === 'settings') {
            document.querySelector('[data-c="dash"]').classList.add('active');
            if(view === 'settings') this.renderLibrary();
        } else {
            const match = document.querySelector(`.dock-item[onclick*="${view}"]`);
            if(match) match.classList.add('active');
        }
    },

    start(cat) {
        this.queue = DB.fetch(cat);
        this.curr = 0;
        this.nav('game');
        
        const color = getComputedStyle(document.querySelector(`.dock-item[onclick*="${cat}"]`)).color;
        document.getElementById('lbl-ctx').style.color = color;
        document.getElementById('lbl-ctx').innerText = cat.toUpperCase();
        this.render();
    },

    render() {
        if(this.curr >= this.queue.length) { this.nav('home'); return; }
        
        const item = this.queue[this.curr];
        this.hasFailedCurrent = false; // Reset session fail flag

        const area = document.getElementById('input-area');
        area.innerHTML = '';
        const btn = document.getElementById('btn-submit');
        btn.classList.remove('ready'); btn.disabled = true;

        const display = Array.isArray(item.es) ? item.es.join(" / ") : item.es;
        document.getElementById('lbl-word').innerText = display;

        if(item.isTriad) {
            this.addInput(area, 'BASE', item.en);
            this.addInput(area, 'PAST', item.past);
            this.addInput(area, 'PARTICIPLE', item.part);
        } else {
            this.addInput(area, 'ENGLISH', item.en);
        }
        setTimeout(() => area.querySelector('input').focus(), 100);
    },

    addInput(parent, label, ans) {
        const d = document.createElement('div');
        d.className = 'input-row';
        d.innerHTML = `<span class="input-label">${label}</span><input type="text" class="game-input" data-ans="${ans}" autocomplete="off">`;
        const i = d.querySelector('input');
        i.addEventListener('input', () => this.check());
        i.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const all = document.querySelectorAll('.game-input');
                const idx = Array.from(all).indexOf(e.target);
                if(idx < all.length-1) all[idx+1].focus(); else this.validate();
            }
        });
        parent.appendChild(d);
    },

    check() {
        const filled = Array.from(document.querySelectorAll('.game-input')).every(i => i.value.trim().length > 0);
        const btn = document.getElementById('btn-submit');
        if(filled) { btn.classList.add('ready'); btn.disabled = false; }
        else { btn.classList.remove('ready'); btn.disabled = true; }
    },

    validate() {
        const btn = document.getElementById('btn-submit');
        if(!btn.classList.contains('ready')) return;

        const item = this.queue[this.curr];
        const inputs = document.querySelectorAll('.game-input');
        let allOk = true;

        inputs.forEach(inp => {
            const val = inp.value.trim().toLowerCase();
            const cor = inp.dataset.ans.toLowerCase();
            const row = inp.parentElement;
            row.classList.remove('error', 'correct');
            
            if(val === cor) {
                row.classList.add('correct');
            } else {
                allOk = false;
                row.classList.add('error');
                inp.value = '';
                inp.placeholder = cor.toUpperCase();
            }
        });

        if(!allOk) {
            // If failed, mark flag so even if they fix it now, it counts as failed logic
            this.hasFailedCurrent = true;
            btn.classList.remove('ready'); btn.disabled = true;
            
            // IMMEDIATE PUNISHMENT: Reset level immediately in DB
            Profile.updateWord(item.en, false);
        } else {
            // Success Logic
            // Only increase level if they didn't fail in this very session attempt
            if(!this.hasFailedCurrent) {
                Profile.updateWord(item.en, true);
            }

            let txt = item.en;
            if(item.isTriad) txt = `${item.en}, ${item.past}, ${item.part}`;
            
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(txt);
            u.lang = 'en-US';
            window.speechSynthesis.speak(u);

            setTimeout(() => { this.curr++; this.render(); }, 1200);
        }
    },

    renderLibrary(filter='') {
        const c = document.getElementById('lib-container');
        c.innerHTML = '';
        const words = DB.getAll();
        const search = filter.toLowerCase();

        words.forEach(w => {
            if(filter && !w.en.toLowerCase().includes(search)) return;
            
            const lvl = Profile.getLevel(w.en);
            const pct = lvl * 25; // 0, 25, 50, 75, 100%
            
            const div = document.createElement('div');
            div.className = `lib-item lvl-${lvl}`;
            div.innerHTML = `
                <div style="font-weight:bold; font-size:15px; color:#fff;">${w.en}</div>
                <div class="lib-meta">
                    <span>${Array.isArray(w.es)?w.es[0]:w.es}</span>
                    <span>LVL ${lvl}/4</span>
                </div>
                <div class="prog-track">
                    <div class="prog-fill" style="width:${pct}%"></div>
                </div>
            `;
            c.appendChild(div);
        });
    }
};

window.onload = () => App.init();
</script>
</body>
</html>
