<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verb Tenses Exercises — Select the correct form</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#222;
      --muted:#666;
      --accent:#2b7cff;
      --success:#4CAF50;
      --danger:#E53935;
      --select-bg:#fff;
      --shadow: 0 6px 18px rgba(20,20,40,0.08);
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
      box-sizing:border-box;
    }
    .container{
      max-width:900px;
      margin:0 auto;
    }
    header{
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:20px;
    }
    header h1{
      margin:0;
      font-size:20px;
      line-height:1.1;
    }
    header p{margin:0;color:var(--muted);font-size:13px}

    .card{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
      margin-bottom:18px;
    }

    .exercise{
      margin-bottom:14px;
      padding:12px;
      border-radius:8px;
      background:linear-gradient(180deg, rgba(43,124,255,0.02), rgba(0,0,0,0.00));
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    .num{
      min-width:26px;
      height:26px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#eef5ff;
      color:var(--accent);
      font-weight:600;
    }
    .sentence{
      flex:1;
      font-size:15px;
      line-height:1.4;
    }

    select.blank {
      font-size:15px;
      padding:6px 10px;
      border-radius:6px;
      border:1px solid #cfd8e6;
      background:var(--select-bg);
      appearance:none;
      -webkit-appearance:none;
      transition:box-shadow .18s, border-color .18s, background-color .18s;
      margin:0 4px;
    }
    select.blank.correct{
      border-color: rgba(0,0,0,0.06);
      background: linear-gradient(90deg, rgba(76,175,80,0.12), rgba(76,175,80,0.06));
      box-shadow: 0 3px 8px rgba(76,175,80,0.12);
    }
    select.blank.incorrect{
      border-color: rgba(229,57,53,0.9);
      background: linear-gradient(90deg, rgba(229,57,53,0.09), rgba(229,57,53,0.04));
      box-shadow: 0 3px 8px rgba(229,57,53,0.12);
    }

    .hint {
      margin-top:8px;
      color:var(--muted);
      font-size:13px;
    }

    .controls{
      display:flex;
      gap:10px;
      margin-top:12px;
      justify-content:flex-end;
    }
    .btn{
      padding:8px 12px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-weight:600;
      background:var(--accent);
      color:white;
    }
    .btn.secondary{
      background:#fff;
      color:var(--accent);
      border:1px solid rgba(43,124,255,0.12);
    }

    /* Modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(10,12,20,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1200;
    }
    .overlay.show{display:flex;}
    .modal{
      width:clamp(320px, 60%, 720px);
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow: 0 18px 50px rgba(10,15,40,0.3);
    }
    .modal h2{margin:0 0 8px 0;font-size:17px}
    .modal p{margin:0 0 12px 0;color:var(--muted)}
    .modal pre{
      background:#f4f6ff;
      padding:10px;
      border-radius:8px;
      overflow:auto;
      font-size:13px;
      color:#123;
    }
    .modal footer{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:12px;
    }

    /* small screens */
    @media (max-width:560px){
      body{padding:16px;}
      header h1{font-size:16px}
      .modal{width:92%}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Verb Tenses Practice — Select the correct word</h1>
        <p>Choose the correct option for each blank. Correct = green. Wrong = red + explanation popup.</p>
      </div>
    </header>

    <div class="card" id="exercisesCard">
      <!-- Exercises will be injected here -->
    </div>

    <div class="card">
      <strong>How to add exercises</strong>
      <p class="hint">
        Open the source (the JavaScript `exercises` array) and add an object. See the <code>exercises</code> array in the script: each item has <code>text</code>, <code>options</code>, <code>answers</code>, and <code>rules</code>. Use placeholders: <code>{0}</code>, <code>{1}</code>.
      </p>
      <pre style="font-size:13px;">
// Example object:
{
  text: "John {0} every morning and then {1} coffee.",
  options: [
    ["work","works","worked"],   // options for {0}
    ["drink","drinks","drank"]   // options for {1}
  ],
  answers: ["works","drinks"],
  rules: [
    "Present Simple: third person singular (he/she/it) adds -s or -es. Example: 'he works'.",
    "Present Simple: third person singular uses 'drinks'."
  ]
}
      </pre>
    </div>

    <div style="height:22px;"></div>
  </div>

  <!-- Modal / popup for explanations -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h2 id="modalTitle">Explanation</h2>
      <p id="modalSubtitle" style="margin-bottom:10px;color:var(--muted)"></p>
      <pre id="modalRule"></pre>
      <footer>
        <button id="closeModal" class="btn">Close</button>
      </footer>
    </div>
  </div>

  <script>
    /******************************************************************
     * EXERCISES ARRAY
     * - text: use placeholders {0}, {1}, ... for blanks
     * - options: array of arrays; one sub-array per placeholder
     * - answers: array of correct strings (must exactly match one of the options)
     * - rules: array of explanation strings corresponding to each blank
     *
     * To add a new exercise: append another object to this array.
     ******************************************************************/
    const exercises = [
      // Simple Present example (regular/irregular)
      {
        text: "John {0} every morning and {1} a quick shower.",
        options: [
          ["work","works","worked"],
          ["take","takes","took"]
        ],
        answers: ["works","takes"],
        rules: [
          "Present Simple — third person singular: add -s or -es for 'he/she/it'. Example: 'John works.'",
          "Present Simple — third person singular: 'take' → 'takes' for he/she/it."
        ]
      },

      // Present Continuous example
      {
        text: "Mary {0} her teeth while she {1} a podcast.",
        options: [
          ["is brush","is brushing","are brushing"],
          ["listen","is listening","listens"]
        ],
        answers: ["is brushing","is listening"],
        rules: [
          "Present Continuous: use 'am/is/are + verb-ing'. For third person singular: 'is brushing'.",
          "Present Continuous: 'is listening' (he/she + is + verb-ing)."
        ]
      },

      // Present perfect vs past simple mixed
      {
        text: "They {0} to Paris many times, but yesterday they {1} the train.",
        options: [
          ["have gone","went","goes"],
          ["miss","missed","will miss"]
        ],
        answers: ["have gone","missed"],
        rules: [
          "Present Perfect: 'have/has + past participle' for experiences without specific time. 'have gone' or 'have visited'.",
          "Past Simple: finished action in the past — 'miss' in past becomes 'missed'."
        ]
      },

      // Future, continuous and perfect continuous
      {
        text: "By Friday John {0} the report, and tomorrow at noon he {1} on it for three hours.",
        options: [
          ["will have finished","will finish","finishes"],
          ["will be working","will work","is working"]
        ],
        answers: ["will have finished","will be working"],
        rules: [
          "Future Perfect: 'will have + past participle' to show completion by a future time.",
          "Future Continuous: 'will be + verb-ing' to show an action in progress at a future time."
        ]
      },

      // Past perfect continuous
      {
        text: "She {0} for 20 minutes before the bus arrived.",
        options: [
          ["had been waiting","was waiting","had waited"]
        ],
        answers: ["had been waiting"],
        rules: [
          "Past Perfect Continuous: 'had been + verb-ing' to show an action continuing up to a past moment."
        ]
      }
    ];

    /******************************************************************
     * RENDERING LOGIC
     ******************************************************************/
    const container = document.getElementById('exercisesCard');

    function createSelect(id, options, placeholderIndex){
      const select = document.createElement('select');
      select.className = 'blank';
      select.setAttribute('data-blank-id', id);
      select.setAttribute('aria-label', 'Choose the correct word');
      // default option
      const defaultOpt = document.createElement('option');
      defaultOpt.value = "";
      defaultOpt.textContent = "— choose —";
      defaultOpt.disabled = true;
      defaultOpt.selected = true;
      select.appendChild(defaultOpt);

      options.forEach(optText => {
        const opt = document.createElement('option');
        opt.value = optText;
        opt.textContent = optText;
        select.appendChild(opt);
      });

      return select;
    }

    function renderExercises(){
      container.innerHTML = ''; // clear
      exercises.forEach((ex, exIndex) => {
        const exWrap = document.createElement('div');
        exWrap.className = 'exercise';

        const num = document.createElement('div');
        num.className = 'num';
        num.textContent = exIndex + 1;

        const sentence = document.createElement('div');
        sentence.className = 'sentence';

        // Build sentence by splitting on placeholders {0}, {1}, ...
        // We'll replace each placeholder with a select element.
        let text = ex.text;
        // find highest placeholder index in string
        const placeholderMatches = [...text.matchAll(/\{(\d+)\}/g)];
        // If no placeholders, show plain text
        if (placeholderMatches.length === 0){
          sentence.textContent = text;
        } else {
          // We'll construct nodes in order
          const frag = document.createDocumentFragment();
          let lastIndex = 0;
          placeholderMatches.forEach((m, idx) => {
            const placeholder = m[0]; // e.g. "{0}"
            const pIndex = Number(m[1]); // 0
            const start = m.index;
            // text before
            const before = text.slice(lastIndex, start);
            if (before) frag.appendChild(document.createTextNode(before));
            // create select for this placeholder (id: exIndex_pIndex)
            const selectId = exIndex + '_' + pIndex;
            const select = createSelect(selectId, ex.options[pIndex], pIndex);
            // attach event
            select.addEventListener('change', onSelectChange);
            // store meta attributes
            select.dataset.exercise = exIndex;
            select.dataset.blank = pIndex;
            frag.appendChild(select);
            lastIndex = start + placeholder.length;
          });
          // leftover text
          const tail = text.slice(lastIndex);
          if (tail) frag.appendChild(document.createTextNode(tail));
          sentence.appendChild(frag);
        }

        exWrap.appendChild(num);
        exWrap.appendChild(sentence);
        container.appendChild(exWrap);
      });
    }

    /******************************************************************
     * SELECT CHANGE HANDLER
     * - marks correct/incorrect
     * - opens modal with the corresponding rule if incorrect
     ******************************************************************/
    const overlay = document.getElementById('overlay');
    const modalRule = document.getElementById('modalRule');
    const modalSubtitle = document.getElementById('modalSubtitle');
    const modalTitle = document.getElementById('modalTitle');
    const closeModalBtn = document.getElementById('closeModal');

    function onSelectChange(e){
      const sel = e.target;
      const exIndex = parseInt(sel.dataset.exercise,10);
      const blankIndex = parseInt(sel.dataset.blank,10);
      const chosen = sel.value;
      const exercise = exercises[exIndex];
      const correct = exercise.answers[blankIndex];

      // Reset classes
      sel.classList.remove('correct','incorrect');

      if (chosen === correct){
        sel.classList.add('correct');
        // Optional small success feedback: a brief title update
        modalTitle.textContent = "Correct ✓";
        modalSubtitle.textContent = "Good job — your selection is correct.";
        modalRule.textContent = "";
        // Do not open modal on correct — only color change
      } else {
        sel.classList.add('incorrect');
        // Open modal with rule for this blank
        const ruleText = exercise.rules[blankIndex] || "Rule not provided.";
        modalTitle.textContent = "Why this is incorrect";
        modalSubtitle.textContent = `Incorrect selection for sentence ${exIndex + 1}, blank ${blankIndex + 1}.`;
        // Provide helpful examples: show the correct answer in context
        let exampleLine = '';
        try {
          // try to build a small example using the sentence with the correct word inserted
          exampleLine = buildExampleSentence(exercise.text, blankIndex, correct);
        } catch(err){
          exampleLine = '';
        }
        modalRule.textContent = ruleText + (exampleLine ? ("\n\nExample: " + exampleLine) : "");
        showModal();
      }
    }

    function buildExampleSentence(template, blankIndex, correctWord){
      // Replace only the specific {blankIndex} with correctWord for example
      // and leave other placeholders as blanks.
      return template.replace(/\{(\d+)\}/g, (m, n) => {
        return (Number(n) === blankIndex) ? correctWord : "____";
      });
    }

    // Modal controls
    function showModal(){
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
    }
    closeModalBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', (ev) => {
      if (ev.target === overlay) closeModal(); // click on backdrop closes
    });
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && overlay.classList.contains('show')) closeModal();
    });

    // Initial render
    renderExercises();

    // Expose helper to console for quick additions/testing
    window._exercises = exercises;
    window._rerender = renderExercises;

    /******************************************************************
     * Notes:
     * - To add an exercise: push a new object into `exercises` and call _rerender()
     * - Each exercise needs:
     *     text: with placeholders {0}, {1}...
     *     options: array of arrays (one sub-array per placeholder)
     *     answers: array of correct option values (strings)
     *     rules: array of explanation strings for each blank
     *
     * Example usage in console:
     * exercises.push({
     *   text: "They {0} early and {1} breakfast.",
     *   options: [["wake","wake up","wake up's"], ["eat","eats","ate"]],
     *   answers: ["wake up","eat"],
     *   rules: ["Present simple: ...", "Present simple: ..."]
     * });
     * _rerender();
     ******************************************************************/
  </script>
</body>
</html>
