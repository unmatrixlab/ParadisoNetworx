<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verb Tenses Practice | English Grammar App</title>
  <meta name="description" content="Interactive verb tense practice with instant feedback and grammar explanations." />

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #eef2ff;
      --card: #ffffff;
      --text: #1a1a2e;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --success: #10b981;
      --success-bg: rgba(16, 185, 129, 0.15);
      --danger: #ef4444;
      --danger-bg: rgba(239, 68, 68, 0.15);
      --border: #e5e7eb;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow: 0 6px 18px rgba(20, 20, 40, 0.08);
      --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.25);
      --radius-sm: 6px;
      --radius: 12px;
      --transition: all 0.2s ease;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 1.5rem;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin: 0 0 1.5rem;
      color: var(--text);
      text-align: center;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* Card */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
    }

    /* Exercise Item */
    .exercise {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .exercise:hover {
      box-shadow: var(--shadow);
    }

    .exercise__left {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      flex: 1;
    }

    .exercise__num {
      background: #dbeafe;
      color: var(--accent);
      width: 2rem;
      height: 2rem;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .exercise__sentence {
      font-size: 1rem;
      line-height: 1.5;
      flex: 1;
    }

    .blank {
      font: inherit;
      padding: 0.375rem 0.625rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: white;
      min-width: 120px;
      transition: var(--transition);
      cursor: pointer;
    }

    .blank:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
      border-color: var(--accent);
    }

    .blank.correct {
      background: var(--success-bg);
      border-color: var(--success);
      color: var(--success);
      font-weight: 500;
    }

    .blank.incorrect {
      background: var(--danger-bg);
      border-color: var(--danger);
      color: var(--danger);
      font-weight: 500;
    }

    /* Speak Button */
    .speak-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.6;
      transition: var(--transition);
      color: var(--muted);
    }

    .speak-btn:hover,
    .speak-btn:focus {
      opacity: 1;
      background: #f3f4f6;
      color: var(--text);
    }

    .speak-btn svg {
      width: 1.5rem;
      height: 1.5rem;
    }

    /* Modal */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
      animation: fadeIn 0.2s ease-out;
    }

    .overlay.show {
      display: flex;
    }

    .modal {
      background: white;
      width: 100%;
      max-width: 500px;
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s ease-out;
    }

    .modal__header {
      margin-bottom: 1rem;
    }

    .modal__title {
      margin: 0 0 0.25rem;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal__subtitle {
      color: var(--muted);
      font-size: 0.925rem;
      margin: 0;
    }

    .modal__rule {
      background: #f8fafc;
      padding: 0.875rem;
      border-radius: var(--radius-sm);
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text);
      border: 1px solid var(--border);
      margin: 1rem 0;
      white-space: pre-wrap;
    }

    .modal__close {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.625rem 1rem;
      border-radius: var(--radius-sm);
      font-weight: 600;
      cursor: pointer;
      float: right;
      transition: var(--transition);
    }

    .modal__close:hover {
      background: var(--accent-hover);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 640px) {
      body {
        padding: 1rem;
      }
      .exercise {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }
      .exercise__left {
        width: 100%;
      }
      .speak-btn {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Verb Tenses Practice</h1>
  </header>

  <main class="card" id="exercisesCard" role="region" aria-label="Grammar exercises">
    <!-- Exercises will be injected here -->
  </main>
</div>

<!-- Modal -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal">
    <div class="modal__header">
      <h2 id="modalTitle" class="modal__title">Explanation</h2>
      <p id="modalSubtitle" class="modal__subtitle"></p>
    </div>
    <pre id="modalRule" class="modal__rule"></pre>
    <button id="closeModal" class="modal__close" aria-label="Close explanation">Close</button>
  </div>
</div>

<script>
  // ========================================
  // DATA: Exercises
  // ========================================
  const exercises = [
    {
      text: "John {0} every morning and {1} a quick shower.",
      options: [
        ["work", "works", "worked"],
        ["take", "takes", "took"]
      ],
      answers: ["works", "takes"],
      rules: [
        "Present Simple: Use verb + 's' for he/she/it → works",
        "Present Simple: Use verb + 's' for he/she/it → takes"
      ]
    },
    {
      text: "Mary {0} her teeth while she {1} a podcast.",
      options: [
        ["is brush", "is brushing", "are brushing"],
        ["listen", "is listening", "listens"]
      ],
      answers: ["is brushing", "is listening"],
      rules: [
        "Present Continuous: is/are + verb-ing",
        "Present Continuous: is/are + verb-ing"
      ]
    },
    {
      text: "They {0} to Paris many times, but yesterday they {1} the train.",
      options: [
        ["have gone", "went", "goes"],
        ["miss", "missed", "will miss"]
      ],
      answers: ["have gone", "missed"],
      rules: [
        "Present Perfect: have/has + past participle",
        "Past Simple: regular verbs → add -ed"
      ]
    }
  ];

  // ========================================
  // DOM Elements
  // ========================================
  const $ = (selector) => document.querySelector(selector);
  const $$ = (selector) => document.querySelectorAll(selector);

  const exercisesContainer = $('#exercisesCard');
  const overlay = $('#overlay');
  const modalTitle = $('#modalTitle');
  const modalSubtitle = $('#modalSubtitle');
  const modalRule = $('#modalRule');
  const closeModalBtn = $('#closeModal');

  // ========================================
  // Utility Functions
  // ========================================
  const createSelect = (exIndex, blankIndex, options) => {
    const select = document.createElement('select');
    select.className = 'blank';
    select.dataset.exercise = exIndex;
    select.dataset.blank = blankIndex;
    select.setAttribute('aria-label', `Blank ${blankIndex + 1}`);

    const defaultOption = new Option('— choose —', '', true, true);
    defaultOption.disabled = true;
    select.appendChild(defaultOption);

    options.forEach(option => {
      select.appendChild(new Option(option, option));
    });

    select.addEventListener('change', handleSelectChange);
    return select;
  };

  const buildFullSentence = (template, exercise) => {
    return template.replace(/\{(\d+)\}/g, (_, i) => exercise.answers[i]);
  };

  const speak = (text) => {
    if (!('speechSynthesis' in window)) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.9;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utterance);
  };

  // ========================================
  // Event Handlers
  // ========================================
  const handleSelectChange = (e) => {
    const select = e.target;
    const exIndex = select.dataset.exercise;
    const blankIndex = select.dataset.blank;
    const exercise = exercises[exIndex];
    const chosen = select.value.trim();
    const correct = exercise.answers[blankIndex];

    // Reset classes
    select.classList.remove('correct', 'incorrect');

    if (chosen === correct) {
      select.classList.add('correct');
    } else if (chosen) {
      select.classList.add('incorrect');
      showExplanation(exercise, blankIndex);
    }
  };

  const showExplanation = (exercise, blankIndex) => {
    modalTitle.textContent = 'Incorrect — Here’s Why';
    modalSubtitle.textContent = `Blank ${+blankIndex + 1}: "${exercise.answers[blankIndex]}" is correct.`;
    modalRule.textContent = exercise.rules[blankIndex];
    overlay.classList.add('show');
  };

  const handleSpeak = (template, exercise) => {
    const fullSentence = buildFullSentence(template, exercise);
    speak(fullSentence);
  };

  closeModalBtn.addEventListener('click', () => {
    overlay.classList.remove('show');
  });

  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      overlay.classList.remove('show');
    }
  });

  // Close with Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && overlay.classList.contains('show')) {
      overlay.classList.remove('show');
    }
  });

  // ========================================
  // Render Exercises
  // ========================================
  const renderExercises = () => {
    exercisesContainer.innerHTML = '';

    exercises.forEach((ex, exIndex) => {
      const exerciseEl = document.createElement('div');
      exerciseEl.className = 'exercise';
      exerciseEl.setAttribute('role', 'group');
      exerciseEl.setAttribute('aria-label', `Exercise ${exIndex + 1}`);

      const left = document.createElement('div');
      left.className = 'exercise__left';

      const num = document.createElement('div');
      num.className = 'exercise__num';
      num.textContent = exIndex + 1;

      const sentence = document.createElement('div');
      sentence.className = 'exercise__sentence';

      // Parse template and insert selects
      let html = ex.text;
      const placeholderRegex = /\{(\d+)\}/g;
      let match;
      let lastIndex = 0;
      const fragment = document.createDocumentFragment();

      while ((match = placeholderRegex.exec(ex.text)) !== null) {
        const textBefore = ex.text.slice(lastIndex, match.index);
        if (textBefore) fragment.appendChild(document.createTextNode(textBefore));

        const blankIndex = match[1];
        const select = createSelect(exIndex, blankIndex, ex.options[blankIndex]);
        fragment.appendChild(select);

        lastIndex = placeholderRegex.lastIndex;
      }

      if (lastIndex < ex.text.length) {
        fragment.appendChild(document.createTextNode(ex.text.slice(lastIndex)));
      }

      sentence.appendChild(fragment);

      const speakBtn = document.createElement('button');
      speakBtn.className = 'speak-btn';
      speakBtn.setAttribute('aria-label', 'Listen to correct sentence');
      speakBtn.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 5L6 9H2v6h4l5 4V5z"/>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
        </svg>
      `;
      speakBtn.addEventListener('click', () => handleSpeak(ex.text, ex));

      left.append(num, sentence);
      exerciseEl.append(left, speakBtn);
      exercisesContainer.appendChild(exerciseEl);
    });
  };

  // ========================================
  // Initialize
  // ========================================
  document.addEventListener('DOMContentLoaded', () => {
    renderExercises();
  });
</script>

</body>
</html>
