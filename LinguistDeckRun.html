<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live HTML Editor Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-editor: #1e1e1e;
            --bg-ui: #252526;
            --accent: #4f46e5;
            --accent-hover: #4338ca;
            --text-main: #e5e7eb;
            --text-sec: #9ca3af;
            --border: #3f3f46;
        }

        body {
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: white;
        }

        /* --- EDITOR PANEL (Deslizable) --- */
        .editor-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background-color: var(--bg-editor);
            display: flex; flex-direction: column;
            border-bottom: 4px solid var(--accent);
            z-index: 10;
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .editor-wrapper.collapsed {
            transform: translateY(-100%);
        }

        /* HEADER DEL EDITOR */
        .editor-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: var(--bg-ui); border-bottom: 1px solid var(--border);
        }
        .app-title { font-size: 14px; font-weight: 700; color: var(--text-sec); letter-spacing: 1px; }
        .app-title span { color: var(--accent); }

        /* AREA DE TEXTO */
        #htmlInput {
            flex-grow: 1;
            background-color: var(--bg-editor);
            color: #d4d4d4;
            border: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            line-height: 1.5;
        }

        /* BARRA DE ACCIONES (Botones + Historial) */
        .action-bar {
            padding: 10px 15px;
            background: var(--bg-ui);
            display: flex; gap: 10px; align-items: center;
            border-top: 1px solid var(--border);
        }

        .btn {
            border: none; border-radius: 6px; padding: 10px 20px;
            font-size: 13px; font-weight: 700; cursor: pointer;
            transition: 0.2s; font-family: 'Inter', sans-serif;
        }
        .btn-run { background-color: var(--accent); color: white; flex-grow: 1; max-width: 200px; display: flex; justify-content: space-between; align-items: center; }
        .btn-run:hover { background-color: var(--accent-hover); }
        .btn-secondary { background: #3f3f46; color: white; }
        .btn-secondary:hover { background: #52525b; }

        /* MENU DE HISTORIAL */
        .history-container {
            flex-grow: 1;
            display: flex; gap: 5px;
            overflow-x: auto;
            padding-bottom: 2px;
        }
        /* Scrollbar fina para el historial */
        .history-container::-webkit-scrollbar { height: 4px; }
        .history-container::-webkit-scrollbar-thumb { background: #52525b; border-radius: 4px; }

        .hist-chip {
            background: #2d2d30; color: var(--text-sec);
            padding: 5px 10px; border-radius: 4px;
            font-size: 11px; white-space: nowrap; cursor: pointer;
            border: 1px solid transparent; transition: 0.2s;
            max-width: 100px; overflow: hidden; text-overflow: ellipsis;
        }
        .hist-chip:hover { border-color: var(--accent); color: white; background: #3f3f46; }

        /* --- VISUALIZADOR (IFRAME) --- */
        #preview {
            width: 100%; height: 100%; border: none;
            background-color: white; /* Lienzo blanco por defecto */
            display: block;
        }

        /* --- BOT√ìN FLOTANTE (Para volver a editar) --- */
        #floating-edit {
            position: fixed; top: 15px; right: 15px;
            background: var(--bg-ui); color: white;
            padding: 10px 15px; border-radius: 30px;
            font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            z-index: 5;
            transform: translateY(-150%);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; align-items: center; gap: 8px; font-size: 13px;
        }
        #floating-edit.visible { transform: translateY(0); }
        #floating-edit:hover { background: var(--accent); border-color: var(--accent); }

    </style>
</head>
<body>

    <div class="editor-wrapper" id="editorPanel">
        <div class="editor-header">
            <div class="app-title">HTML <span>LIVE</span> RUNNER</div>
            <div style="font-size: 11px; color: #666;">Ctrl + Enter to Run</div>
        </div>
        
        <textarea id="htmlInput" placeholder="<h1>Hola Mundo</h1>
<style>
  body { font-family: sans-serif; padding: 20px; }
  h1 { color: #4f46e5; }
</style>" spellcheck="false"></textarea>

        <div class="action-bar">
            <div class="history-container" id="historyList">
                </div>
            <button class="btn btn-secondary" onclick="clearEditor()" title="Limpiar">üóëÔ∏è</button>
            <button class="btn btn-run" id="runBtn">
                EJECUTAR <span>‚ñ∂</span>
            </button>
        </div>
    </div>

    <button id="floating-edit" onclick="toggleEditor(true)">
        ‚úèÔ∏è Editar C√≥digo
    </button>

    <iframe id="preview" sandbox="allow-scripts allow-modals"></iframe>

    <script>
        // CONFIGURACI√ìN
        const MAX_HISTORY = 10;
        const STORAGE_KEY = 'mdc_html_history';

        // REFERENCIAS DOM
        const editorPanel = document.getElementById('editorPanel');
        const floatingBtn = document.getElementById('floating-edit');
        const input = document.getElementById('htmlInput');
        const iframe = document.getElementById('preview');
        const runBtn = document.getElementById('runBtn');
        const historyList = document.getElementById('historyList');

        // --- FUNCIONES PRINCIPALES ---

        // 1. Ejecutar C√≥digo
        function runCode() {
            const code = input.value;
            
            // Inyectar en Iframe
            const doc = iframe.contentWindow.document;
            doc.open();
            doc.write(code);
            doc.close();

            // Guardar en historial si no est√° vac√≠o
            if(code.trim().length > 0) {
                saveToHistory(code);
            }

            // Ocultar editor (Modo Inmersivo)
            toggleEditor(false);
        }

        // 2. Controlar la Visibilidad del Editor
        function toggleEditor(show) {
            if(show) {
                editorPanel.classList.remove('collapsed');
                floatingBtn.classList.remove('visible');
                input.focus(); // Enfocar al abrir
            } else {
                editorPanel.classList.add('collapsed');
                floatingBtn.classList.add('visible');
            }
        }

        // 3. Sistema de Persistencia (Historial)
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            renderHistoryUI(history);
            // Cargar el √∫ltimo c√≥digo autom√°ticamente si existe
            if(history.length > 0 && input.value === '') {
                input.value = history[0];
            }
        }

        function saveToHistory(code) {
            let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            
            // Evitar duplicados consecutivos y mover al principio si ya existe
            history = history.filter(item => item !== code);
            history.unshift(code);
            
            // Limitar a 10
            if(history.length > MAX_HISTORY) {
                history = history.slice(0, MAX_HISTORY);
            }

            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
            renderHistoryUI(history);
        }

        function renderHistoryUI(history) {
            historyList.innerHTML = '';
            
            if(history.length === 0) {
                historyList.innerHTML = '<span style="font-size:11px; color:#555; padding:5px;">Sin historial reciente</span>';
                return;
            }

            history.forEach((snippet, index) => {
                // Crear un "t√≠tulo" para el chip basado en el contenido
                let previewText = snippet.substring(0, 15).replace(/\n/g, ' ').trim() || "C√≥digo vac√≠o";
                
                const chip = document.createElement('div');
                chip.className = 'hist-chip';
                chip.textContent = `${index + 1}. ${previewText}...`;
                chip.title = "Cargar este c√≥digo";
                
                chip.addEventListener('click', () => {
                    input.value = snippet;
                    // Efecto visual de carga
                    input.style.opacity = '0.5';
                    setTimeout(() => input.style.opacity = '1', 150);
                });

                historyList.appendChild(chip);
            });
        }

        function clearEditor() {
            if(confirm("¬øBorrar editor?")) input.value = '';
        }

        // --- EVENT LISTENERS ---

        runBtn.addEventListener('click', runCode);

        // Atajo de teclado: Ctrl + Enter para ejecutar
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault(); // Evitar salto de l√≠nea si est√° en textarea
                runCode();
            }
            // Escape para volver a abrir el editor si est√° cerrado
            if (e.key === 'Escape' && editorPanel.classList.contains('collapsed')) {
                toggleEditor(true);
            }
        });

        // Inicializar
        loadHistory();

    </script>
</body>
</html>
