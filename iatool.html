<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Generator & Manager</title>
    <style>
        :root {
            --bg: #121212;
            --surface: #1e1e1e;
            --primary: #bb86fc;
            --text: #e0e0e0;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', monospace, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Contenedor Principal (El Generador) */
        #generator-container {
            width: 100%;
            max-width: 800px;
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        /* Clase para ocultar el generador */
        .hidden {
            display: none !important;
        }

        h2 { margin-top: 0; color: var(--primary); }

        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .full-width { grid-column: span 2; }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #aaa;
        }

        input, select, textarea {
            width: 100%;
            background: #2d2d2d;
            border: 1px solid var(--border);
            color: white;
            padding: 10px;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Botones */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            transition: background 0.2s;
        }

        #btn-generate { background-color: var(--primary); color: #000; }
        #btn-generate:hover { background-color: #a370db; }

        #btn-paste { background-color: #03dac6; color: #000; }
        #btn-paste:hover { background-color: #01b4a4; }

        #btn-show-gen { 
            background-color: #333; 
            color: #fff; 
            margin-bottom: 20px;
            display: none; /* Oculto por defecto */
            width: 100%;
            max-width: 800px;
        }

        /* √Årea de Salida del Prompt */
        #prompt-output {
            margin-top: 20px;
            background: #000;
            padding: 15px;
            border: 1px solid var(--primary);
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }

        /* Estilos del Acorde√≥n (Resultados) */
        #results-container {
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }

        .accordion-item {
            background: var(--surface);
            border: 1px solid var(--border);
            margin-bottom: 10px;
            border-radius: 4px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 15px;
            background: #252525;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .accordion-header:hover { background: #303030; }

        .accordion-content {
            padding: 15px;
            display: none;
            border-top: 1px solid var(--border);
            font-size: 0.95em;
            line-height: 1.5;
        }

        .accordion-content.active { display: block; }

        .meta-tag {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 5px;
        }

        .copy-prompt-btn {
            background: var(--primary);
            color: black;
            border: none;
            padding: 5px 10px;
            font-size: 0.8em;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
            display: inline-block;
        }

    </style>
</head>
<body>

    <button id="btn-show-gen" onclick="toggleGenerator(true)">‚ûï Nueva Generaci√≥n</button>

    <div id="generator-container">
        <h2>Nexus Prompt Engineer</h2>
        
        <div class="grid-container">
            <div>
                <label>Contexto</label>
                <input type="text" id="contextInput" list="context-history" placeholder="Ej: React, Finanzas...">
                <datalist id="context-history"></datalist>
            </div>
            <div>
                <label>Tema Espec√≠fico</label>
                <input type="text" id="topicInput" list="topic-history" placeholder="Ej: Hooks, ROI...">
                <datalist id="topic-history"></datalist>
            </div>

            <div><label>Modo</label><select id="modeSelect"></select></div>
            <div><label>Formato</label><select id="formatSelect"></select></div>
            <div><label>Tipo de Tarea</label><select id="taskSelect"></select></div>
            <div><label>Voz/Tono</label><select id="voiceSelect"></select></div>
            <div><label>Longitud</label><select id="lengthSelect"></select></div>
            <div><label>Nivel de Profundidad</label><select id="levelSelect"></select></div>
        </div>

        <div class="btn-group">
            <button id="btn-generate" onclick="generatePrompt()">‚ö° Generar Prompt</button>
            <button id="btn-paste" onclick="handlePasteResponse()">üìã Pegar Respuesta y Ocultar</button>
        </div>

        <div id="prompt-output"></div>
    </div>

    <div id="results-container"></div>

<script>
/* =========================================
   1. DATOS DE CONFIGURACI√ìN
   ========================================= */
const MODES = [
    { id: 'tech', label: 'TECHNICAL', role: 'Act as a Senior Engineer.', style: 'Cyberpunk/Terminal style.', goal: 'Technical accuracy and implementation detail.' },
    { id: 'art', label: 'ART', role: 'Act as a Creative Director.', style: 'Minimalist Gallery / Editorial style.', goal: 'Aesthetic refinement and originality.' },
    { id: 'school', label: 'SCHOOL', role: 'Act as a Professor.', style: 'Clean Textbook / Academic style.', goal: 'Structured education and conceptual clarity.' },
    { id: 'story', label: 'STORYTELLING', role: 'Act as a Master Novelist.', style: 'Cinematic, immersive narrative tone.', goal: 'Engaging storytelling and world-building.' },
    { id: 'marketing', label: 'MARKETING', role: 'Act as a Senior Copywriter.', style: 'Persuasive, high-conversion writing.', goal: 'Brand voice alignment & audience engagement.' },
    { id: 'business', label: 'BUSINESS', role: 'Act as a Strategy Consultant.', style: 'Executive brief style.', goal: 'Clarity, precision, and actionable insights.' },
    { id: 'research', label: 'RESEARCH', role: 'Act as a Research Scientist.', style: 'Peer-reviewed academic tone.', goal: 'Evidence-based rigor with citations when relevant.' },
    { id: 'casual', label: 'CASUAL', role: 'Act as a friendly assistant.', style: 'Conversational, natural tone.', goal: 'Clarity, simplicity, and a human-sounding delivery.' }
];

const FORMATS = [
    { id: 'html', label: 'HTML APP', instruction: 'Return a single HTML5 file with inline CSS/JS. No external files. Use overflow-y:auto.' },
    { id: 'text', label: 'TEXT GUIDE', instruction: 'Return Markdown text with clear headings and structure.' },
    { id: 'code', label: 'CODE SNIPPET', instruction: 'Return raw code only with comments.' },
    { id: 'essay', label: 'ESSAY', instruction: 'Return a polished formal essay.' },
    { id: 'dialogue', label: 'DIALOGUE', instruction: 'Return a scripted scene or conversation.' },
    { id: 'template', label: 'TEMPLATE', instruction: 'Return a reusable structured template with fillable fields.' },
    { id: 'checklist', label: 'CHECKLIST', instruction: 'Return a concise actionable checklist or SOP.' }
];

const TASK_TYPES = [
    { id: 'explain', label: 'EXPLANATION', instruction: 'Explain the topic clearly and step-by-step.' },
    { id: 'analysis', label: 'ANALYSIS', instruction: 'Break the topic down into components with pros, cons, variables.' },
    { id: 'create', label: 'CREATIVE GENERATION', instruction: 'Generate original content in the selected style.' },
    { id: 'teach', label: 'TEACHING', instruction: 'Introduce, teach, give examples, and add a practice checkpoint.' },
    { id: 'improve', label: 'IMPROVEMENT', instruction: 'Rewrite and enhance the user‚Äôs content with better clarity and style.' },
    { id: 'compare', label: 'COMPARISON', instruction: 'Compare items using structure, criteria, and reasoning.' },
    { id: 'build', label: 'CONSTRUCTION', instruction: 'Produce a structured artifact: plan, blueprint, script, architecture, or framework.' }
];

const VOICES = [
    { id: 'neutral', label: 'Neutral', instruction: 'Use a balanced, neutral tone.' },
    { id: 'friendly', label: 'Friendly', instruction: 'Use a warm, approachable tone.' },
    { id: 'authoritative', label: 'Authoritative', instruction: 'Use a confident, expert tone.' },
    { id: 'poetic', label: 'Poetic', instruction: 'Use metaphors, rhythm, and evocative language.' },
    { id: 'concise', label: 'Concise', instruction: 'Use highly efficient, compact phrasing.' }
];

const LENGTH = [
    { id: 'short', label: 'SHORT', instruction: 'Maximum 2 short paragraphs.' },
    { id: 'medium', label: 'MEDIUM', instruction: 'Up to 6 paragraphs with examples.' },
    { id: 'long', label: 'LONG', instruction: 'Extensive, detailed long-form content.' }
];

const FADER_LEVELS = [
    "- Level 1: Basic Summary or Definition.",
    "- Level 2: Add Context, History, or Motivation.",
    "- Level 3: Add Structure, Examples, or Interactions.",
    "- Level 4: Add Advanced Analysis, Troubleshooting, or Exercises.",
    "- Level 5: Full Interactive App / Deep-Dive Artifact."
];

const RESTRICTIONS = [
    "Do not include filler text.",
    "Do not split the output into multiple messages.",
    "No disclaimers unless strictly necessary.",
    "Avoid repetition.",
    "Respect the selected format exactly."
];

/* =========================================
   2. ESTADO GLOBAL
   ========================================= */
let lastGeneratedPrompt = ""; // Guardamos el √∫ltimo prompt generado para el bot√≥n de copiar

/* =========================================
   3. INICIALIZACI√ìN
   ========================================= */
document.addEventListener('DOMContentLoaded', () => {
    populateSelect('modeSelect', MODES);
    populateSelect('formatSelect', FORMATS);
    populateSelect('taskSelect', TASK_TYPES);
    populateSelect('voiceSelect', VOICES);
    populateSelect('lengthSelect', LENGTH);
    
    // Fader Levels es un array de strings, tratamiento especial o simple
    const levelSel = document.getElementById('levelSelect');
    FADER_LEVELS.forEach((level, index) => {
        let opt = document.createElement('option');
        opt.value = level;
        opt.textContent = level.split(':')[0]; // Mostrar solo "Level X"
        levelSel.appendChild(opt);
    });

    // Cargar Memoria Hist√≥rica
    loadHistory('contextInput', 'context-history');
    loadHistory('topicInput', 'topic-history');
});

function populateSelect(id, dataArray) {
    const select = document.getElementById(id);
    dataArray.forEach(item => {
        let opt = document.createElement('option');
        opt.value = item.id;
        opt.textContent = item.label;
        select.appendChild(opt);
    });
}

/* =========================================
   4. GESTI√ìN DE MEMORIA (Los √∫ltimos 5)
   ========================================= */
function loadHistory(inputId, listId) {
    const history = JSON.parse(localStorage.getItem(inputId + '_mem')) || [];
    const dataList = document.getElementById(listId);
    if(dataList) {
        dataList.innerHTML = '';
        history.forEach(item => {
            let option = document.createElement('option');
            option.value = item;
            dataList.appendChild(option);
        });
    }
}

function saveToHistory(inputId) {
    const input = document.getElementById(inputId);
    const value = input.value.trim();
    if (!value) return;

    let history = JSON.parse(localStorage.getItem(inputId + '_mem')) || [];
    // Evitar duplicados consecutivos y mover al inicio
    history = history.filter(item => item !== value);
    history.unshift(value);
    
    // Limitar a 5
    if (history.length > 5) history.pop();
    
    localStorage.setItem(inputId + '_mem', JSON.stringify(history));
    loadHistory(inputId, input.getAttribute('list'));
}

/* =========================================
   5. GENERAR PROMPT
   ========================================= */
function generatePrompt() {
    // 1. Obtener valores
    const context = document.getElementById('contextInput').value;
    const topic = document.getElementById('topicInput').value;
    
    // Objetos seleccionados
    const mode = MODES.find(m => m.id === document.getElementById('modeSelect').value);
    const format = FORMATS.find(f => f.id === document.getElementById('formatSelect').value);
    const task = TASK_TYPES.find(t => t.id === document.getElementById('taskSelect').value);
    const voice = VOICES.find(v => v.id === document.getElementById('voiceSelect').value);
    const len = LENGTH.find(l => l.id === document.getElementById('lengthSelect').value);
    const level = document.getElementById('levelSelect').value;

    // 2. Construir Prompt
    const prompt = `
### ROLE & STYLE
${mode.role} ${mode.style}
Goal: ${mode.goal}

### TASK
Context: ${context}
Topic: ${topic}
Type: ${task.label} - ${task.instruction}

### FORMAT & OUTPUT
Format: ${format.label}
Instruction: ${format.instruction}
Tone: ${voice.instruction}
Length: ${len.instruction}
Depth: ${level}

### RESTRICTIONS
${RESTRICTIONS.join('\n')}
    `.trim();

    // 3. Mostrar y Guardar
    const outputDiv = document.getElementById('prompt-output');
    outputDiv.style.display = 'block';
    outputDiv.textContent = prompt;
    
    // Copiar al portapapeles autom√°ticamente (opcional, buena UX)
    navigator.clipboard.writeText(prompt);
    
    // Guardar estado global para el bot√≥n de "Copiar Prompt" posterior
    lastGeneratedPrompt = prompt;

    // Guardar en memoria de inputs
    saveToHistory('contextInput');
    saveToHistory('topicInput');
}

/* =========================================
   6. PEGAR RESPUESTA Y OCULTAR
   ========================================= */
async function handlePasteResponse() {
    try {
        // Leer portapapeles
        const text = await navigator.clipboard.readText();
        if(!text) return alert("El portapapeles est√° vac√≠o.");

        // Crear elemento de acorde√≥n
        createAccordionItem(text);

        // Ocultar Generador
        toggleGenerator(false);

    } catch (err) {
        console.error("Error al pegar:", err);
        alert("Permite el acceso al portapapeles.");
    }
}

function toggleGenerator(show) {
    const gen = document.getElementById('generator-container');
    const btnShow = document.getElementById('btn-show-gen');
    
    if (show) {
        gen.classList.remove('hidden');
        btnShow.style.display = 'none';
    } else {
        gen.classList.add('hidden');
        btnShow.style.display = 'block';
    }
}

function createAccordionItem(contentText) {
    const container = document.getElementById('results-container');
    const id = Date.now();
    
    // Obtener datos para el t√≠tulo (si existen en los inputs actuales)
    const mode = document.getElementById('modeSelect').options[document.getElementById('modeSelect').selectedIndex].text;
    const topic = document.getElementById('topicInput').value || "Resultado sin t√≠tulo";

    // Guardamos el prompt que gener√≥ este resultado en una variable local al cierre
    const promptForThisItem = lastGeneratedPrompt;

    const item = document.createElement('div');
    item.className = 'accordion-item';
    
    item.innerHTML = `
        <div class="accordion-header" onclick="toggleAccordion(${id})">
            <div>
                <span class="meta-tag">${mode}</span>
                <strong>${topic}</strong>
            </div>
            <span>‚ñº</span>
        </div>
        <div class="accordion-content" id="content-${id}">
            <button class="copy-prompt-btn" onclick="copyTextToClipboard(this)">
                üìú Copiar Prompt Original
            </button>
            <div style="display:none;" class="prompt-source">${promptForThisItem}</div>
            
            <hr style="border:0; border-top:1px solid #444; margin:10px 0;">
            
            <div style="white-space: pre-wrap;">${escapeHtml(contentText)}</div>
        </div>
    `;

    // Insertar al principio
    container.insertBefore(item, container.firstChild);
}

function toggleAccordion(id) {
    const content = document.getElementById(`content-${id}`);
    const isVisible = content.classList.contains('active');
    
    // Cerrar todos (opcional, estilo acorde√≥n estricto)
    document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));

    if (!isVisible) {
        content.classList.add('active');
    }
}

// Funci√≥n auxiliar para copiar el prompt oculto
function copyTextToClipboard(btnElement) {
    // El texto est√° en el div hermano siguiente con clase .prompt-source
    const promptText = btnElement.nextElementSibling.textContent;
    navigator.clipboard.writeText(promptText).then(() => {
        const originalText = btnElement.innerText;
        btnElement.innerText = "¬°Copiado!";
        setTimeout(() => btnElement.innerText = originalText, 1500);
    });
}

function escapeHtml(text) {
    if (!text) return text;
    return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}
</script>

</body>
</html>
