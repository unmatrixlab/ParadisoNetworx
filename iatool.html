<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NEXUS | Modular Creator</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* =========================================
           ESTILOS (Visuales)
           ========================================= */
        :root {
            --bg-body: #050505;
            --glass-border: rgba(255, 255, 255, 0.08);
            --neon-gen: #00f2ea;
            --neon-del: #ff4444;
            --neon-edit: #ffd700;
            --ease-snap: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background-color: var(--bg-body); color: #fff; font-family: 'Inter', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        body.locked .scroll-container { overflow: hidden; pointer-events: none; }

        .scroll-container { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 20px 0 350px 0; width: 100%; max-width: 600px; margin: 0 auto; position: relative; }
        #deck-list { display: flex; flex-direction: column; gap: 12px; min-height: 50px; }

        /* CARDS */
        .card { background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0) 100%); border: 1px solid var(--glass-border); border-left: 3px solid var(--neon-gen); border-radius: 8px; margin: 0 16px; position: relative; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .card-header { padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; gap: 15px; cursor: pointer; transition: background 0.3s; }
        .title-group { display: flex; align-items: center; gap: 15px; overflow: hidden; flex: 1; }
        .card-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 1.5px; color: #ccc; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-tag { font-family: 'Inter', sans-serif; font-size: 9px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; padding: 3px 8px; border-radius: 2px; background: rgba(0, 242, 234, 0.1); color: var(--neon-gen); border: 1px solid rgba(0, 242, 234, 0.2); flex-shrink: 0; }
        .card-actions { display: flex; gap: 10px; }
        .action-btn { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #aaa; cursor: pointer; }
        .action-btn:hover { color: #fff; background: var(--neon-gen); border-color: var(--neon-gen); color: #000; }
        .btn-delete-card:hover { background: var(--neon-del); border-color: var(--neon-del); color: #fff; }
        
        .card.active { position: fixed; top: 0; left: 0; width: 100%; height: 100dvh; z-index: 9999; margin: 0; border: none; background: #000; display: flex; flex-direction: column; }
        .card-content { display: none; background: #000; flex: 1; }
        .card.active .card-content { display: flex; animation: fadeIn 0.5s forwards; }
        iframe { width: 100%; height: 100%; border: none; background: #fff; }
        @keyframes fadeIn { to { opacity: 1; } }

        /* GENERATOR PANEL */
        .generator-panel { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: 1px solid var(--glass-border); padding: 15px; z-index: 5000; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); }
        .gen-container { max-width: 600px; margin: 0 auto; width: 100%; display: flex; flex-direction: column; gap: 12px; }

        /* PREVIEW WINDOW */
        .prompt-preview-window { position: absolute; bottom: 100%; left: 0; width: 100%; max-height: 0; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(20px); border: 1px solid var(--neon-gen); border-bottom: none; border-radius: 8px 8px 0 0; color: #ccc; font-family: monospace; font-size: 11px; transition: all 0.4s var(--ease-snap); opacity: 0; pointer-events: none; overflow: hidden; }
        .prompt-preview-window.visible { max-height: 200px; opacity: 1; padding: 15px; margin-bottom: 15px; pointer-events: auto; overflow-y: auto; }
        .preview-header { color: var(--neon-gen); font-size: 9px; font-weight: bold; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; margin-bottom: 5px; display: flex; justify-content: space-between; }

        /* DYNAMIC CATEGORIES */
        .category-row { display: flex; justify-content: space-between; padding: 0 5px; flex-wrap: wrap; gap: 10px; }
        .cat-label { font-family: 'Bebas Neue', sans-serif; font-size: 18px; letter-spacing: 1px; color: #444; cursor: pointer; transition: 0.3s; user-select: none; }
        .cat-label:hover { color: #888; }
        .cat-label.active { color: var(--neon-gen); text-shadow: 0 0 10px rgba(0, 242, 234, 0.4); transform: scale(1.1); }

        /* FADER */
        .fader-container { width: 100%; padding: 10px 0; }
        .fader-info { display: flex; justify-content: space-between; font-size: 10px; color: #666; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        input[type=range].fader { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range].fader:focus { outline: none; }
        input[type=range].fader::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: rgba(255,255,255,0.1); border-radius: 2px; }
        input[type=range].fader::-webkit-slider-thumb { height: 16px; width: 16px; border-radius: 50%; background: #fff; border: 2px solid var(--neon-gen); cursor: pointer; -webkit-appearance: none; margin-top: -6px; box-shadow: 0 0 10px var(--neon-gen); transition: transform 0.1s; }
        input[type=range].fader:active::-webkit-slider-thumb { transform: scale(1.2); background: var(--neon-gen); }

        /* INPUTS & BTNS */
        .gen-input { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: #fff; padding: 12px; font-size: 14px; border-radius: 6px; width: 100%; }
        .gen-input:focus { border-color: var(--neon-gen); }
        .gen-controls { display: flex; gap: 8px; margin-top: 5px; }
        .gen-btn { flex: 1; padding: 12px; border: none; border-radius: 6px; font-weight: 600; text-transform: uppercase; font-size: 11px; cursor: pointer; }
        .btn-copy { background: #333; color: #fff; border: 1px solid #444; }
        .btn-paste { background: var(--neon-gen); color: #000; box-shadow: 0 0 10px rgba(0, 242, 234, 0.3); }
        .status-toast { position: absolute; top: -40px; left: 50%; transform: translateX(-50%); background: #000; border: 1px solid var(--neon-gen); color: var(--neon-gen); padding: 8px 16px; border-radius: 20px; font-size: 12px; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 6000; }
    </style>
</head>
<body>

    <div class="scroll-container">
        <div id="deck-list"></div>
    </div>

    <div class="generator-panel">
        <div class="status-toast" id="toast">Action Completed</div>
        <div class="gen-container">
            
            <div class="prompt-preview-window" id="previewWindow">
                <div class="preview-header">
                    <span>Live Prompt</span>
                    <span id="levelIndicator">Lvl 1</span>
                </div>
                <div id="previewText" style="white-space: pre-wrap;">Type to generate...</div>
            </div>

            <div class="category-row" id="categoryContainer">
                </div>

            <div class="fader-container">
                <div class="fader-info">
                    <span>Simple</span>
                    <span>Complex</span>
                </div>
                <input type="range" min="1" max="5" value="3" class="fader" id="detailFader" oninput="updatePrompt()">
            </div>

            <input type="text" id="topicInput" class="gen-input" placeholder="Topic..." oninput="updatePrompt()">
            <input type="text" id="extraInput" class="gen-input gen-input-extra" style="font-size: 12px; color: #aaa;" placeholder="Extra details..." oninput="updatePrompt()">
            
            <div class="gen-controls">
                <button class="gen-btn btn-copy" onclick="copyPrompt()">1. Copy Prompt</button>
                <button class="gen-btn btn-paste" onclick="pasteAndCreate()">2. Paste & Create</button>
            </div>
        </div>
    </div>

<script>
    // =================================================================
    // 1. ZONA DE CONFIGURACIÓN (EDITA AQUÍ)
    // =================================================================
    
    // LISTA DE CATEGORÍAS (Agrega, quita o edita)
    const CATEGORIES = [
        {
            id: 'technical',
            label: 'TECHNICAL',
            role: 'Act as a Senior Engineer and Documentation Expert.',
            style: 'Cyberpunk Terminal Style (Black bg, Monospace font, Neon Green/Cyan borders).',
            goal: 'Create a deep technical manual.'
        },
        {
            id: 'art',
            label: 'ART',
            role: 'Act as an Avant-Garde Curator and Designer.',
            style: 'Museum Gallery Style (Minimalist, Serif fonts, High Contrast, Elegant whitespace).',
            goal: 'Create an artistic visual exploration.'
        },
        {
            id: 'school',
            label: 'SCHOOL',
            role: 'Act as a University Professor and Pedagogue.',
            style: 'Clean Textbook Style (Dark grey bg, Clear Sans-Serif, Color-coded sections).',
            goal: 'Create an engaging educational lesson.'
        }
        // Puedes agregar más así: { id: 'marketing', label: 'MARKETING', ... }
    ];

    // LISTA DE NIVELES DEL FADER (El slider se ajustará al número de items aquí)
    // El código sumará todos los puntos desde el 0 hasta donde esté el slider.
    const FADER_LEVELS = [
        /* Nivel 1 */ "- Provide a clear, concise definition and overview.",
        /* Nivel 2 */ "- Add historical context or technical specifications relevant to the style.",
        /* Nivel 3 */ "- Include an Interactive Component (Accordions, Tabs, or Click-to-reveal).",
        /* Nivel 4 */ "- detailed Troubleshooting section, Analysis, or Conceptual Quiz (based on topic).",
        /* Nivel 5 */ "- Structure as a Full App: Sticky Nav, Footer resources, and polished CSS transitions."
        // Puedes agregar más líneas aquí para tener un fader de 6, 7 o 10 puntos.
    ];

    // =================================================================
    // 2. LÓGICA DEL SISTEMA
    // =================================================================

    let userDecks = JSON.parse(localStorage.getItem('nexus_ai_decks')) || [];
    let activeCategoryId = CATEGORIES[0].id; // Por defecto el primero
    let generatedPromptText = "";

    // INICIALIZACIÓN: Construye la interfaz basada en la configuración
    function initInterface() {
        // 1. Construir botones de categoría
        const catContainer = document.getElementById('categoryContainer');
        catContainer.innerHTML = '';
        
        CATEGORIES.forEach(cat => {
            const btn = document.createElement('div');
            btn.className = `cat-label ${cat.id === activeCategoryId ? 'active' : ''}`;
            btn.textContent = cat.label;
            btn.onclick = () => selectCategory(cat.id);
            catContainer.appendChild(btn);
        });

        // 2. Configurar el Fader dinámicamente
        const fader = document.getElementById('detailFader');
        fader.max = FADER_LEVELS.length; // El maximo es igual a la cantidad de reglas
        fader.value = Math.ceil(FADER_LEVELS.length / 2); // Ponerlo al medio por defecto
    }

    function selectCategory(id) {
        activeCategoryId = id;
        // Actualizar visualmente
        const labels = document.querySelectorAll('.cat-label');
        labels.forEach(lbl => lbl.classList.remove('active'));
        // Encontrar el indice que coincide con el ID en la configuración
        const index = CATEGORIES.findIndex(c => c.id === id);
        if (labels[index]) labels[index].classList.add('active');
        
        updatePrompt();
    }

    function updatePrompt() {
        const topic = document.getElementById('topicInput').value.trim();
        const extra = document.getElementById('extraInput').value.trim();
        const level = parseInt(document.getElementById('detailFader').value);
        
        const previewWindow = document.getElementById('previewWindow');
        const previewText = document.getElementById('previewText');
        const levelInd = document.getElementById('levelIndicator');

        // Mostrar solo si hay texto
        if (topic.length > 0 || extra.length > 0) {
            previewWindow.classList.add('visible');
        } else {
            previewWindow.classList.remove('visible');
            return;
        }

        // --- CONSTRUCCIÓN DEL PROMPT ---
        const catConfig = CATEGORIES.find(c => c.id === activeCategoryId);
        
        // Sumar instrucciones del fader (desde indice 0 hasta level-1)
        let featuresList = [];
        for (let i = 0; i < level; i++) {
            featuresList.push(FADER_LEVELS[i]);
        }
        
        // Formatear instrucciones
        const instructions = featuresList.join("\n");
        const extraText = extra ? `\nUSER EXTRA REQUEST: "${extra}"` : "";

        generatedPromptText = `${catConfig.role} Create a single HTML file about "${topic}".
OBJECTIVE: ${catConfig.goal}
DESIGN: ${catConfig.style}

INSTRUCTIONS (Density Level ${level}/${FADER_LEVELS.length}):
${instructions}
${extraText}

OUTPUT: Return ONLY valid raw HTML code in a single file (CSS/JS embedded).`;

        previewText.textContent = generatedPromptText;
        levelInd.textContent = `Lvl ${level}`;
    }

    // Funciones Helper
    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.style.opacity = '1';
        setTimeout(() => toast.style.opacity = '0', 2000);
    }

    function copyPrompt() {
        if (!generatedPromptText) updatePrompt();
        if (!document.getElementById('topicInput').value) { showToast('Type a topic first'); return; }
        
        navigator.clipboard.writeText(generatedPromptText)
            .then(() => showToast('Prompt Copied'))
            .catch(() => showToast('Copy failed'));
    }

    // =================================================================
    // 3. GESTIÓN DE TARJETAS (Deck Logic)
    // =================================================================
    const deckList = document.getElementById('deck-list');

    function saveDecks() { localStorage.setItem('nexus_ai_decks', JSON.stringify(userDecks)); }

    function renderDecks() {
        deckList.innerHTML = '';
        userDecks.forEach(deck => {
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('data-id', deck.id);
            
            // Buscar etiqueta bonita basada en ID
            let labelText = "NOTE";
            if (!deck.isTextPaste) {
                const catObj = CATEGORIES.find(c => c.id === deck.catId);
                labelText = catObj ? catObj.label : (deck.category || "AI");
            }

            card.innerHTML = `
                <div class="card-header" onclick="toggleCard('${deck.id}')">
                    <div class="title-group">
                        <h2 class="card-title">${deck.title}</h2>
                        <span class="card-tag">${labelText}</span>
                    </div>
                    <div class="card-actions">
                        <div class="action-btn btn-delete-card" onclick="deleteDeck(event, '${deck.id}')">&#10005;</div>
                        <svg class="card-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"></path></svg>
                    </div>
                </div>
                <div class="card-content" id="content-${deck.id}"></div>
            `;
            deckList.appendChild(card);
        });
    }

    new Sortable(deckList, { animation: 300, handle: '.card-header', ghostClass: 'sortable-ghost', onEnd: () => {
        const newOrder = Array.from(deckList.children).map(c => c.getAttribute('data-id'));
        userDecks.sort((a, b) => newOrder.indexOf(a.id) - newOrder.indexOf(b.id));
        saveDecks();
    }});

    async function pasteAndCreate() {
        const title = document.getElementById('topicInput').value.trim() || "Untitled";
        try {
            let code = await navigator.clipboard.readText();
            if (!code || code.trim().length < 1) { showToast('Clipboard Empty'); return; }
            
            let isText = false;
            if (!code.trim().startsWith('<') && !code.includes('<!DOCTYPE')) {
                isText = true;
                const html = marked.parse(code);
                code = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Note</title><style>body{background:#050505;color:#ddd;font-family:sans-serif;padding:20px;line-height:1.6}h1{color:#00f2ea;border-bottom:1px solid #333}code{background:#222;padding:2px 5px;color:#ff79c6}</style></head><body><h1>${title}</h1>${html}</body></html>`;
            }

            userDecks.push({ 
                id: 'd_' + Date.now(), 
                title: title, 
                code: code, 
                catId: activeCategoryId, // Guardamos el ID de la config actual
                isTextPaste: isText 
            });
            saveDecks();
            renderDecks();
            setTimeout(() => { document.querySelector('.scroll-container').scrollTo({top: 10000, behavior:'smooth'}); }, 100);
            showToast('Created!');
        } catch (e) { showToast('Error/Permiso Denegado'); }
    }

    function deleteDeck(e, id) {
        e.stopPropagation();
        if(confirm("Delete?")) {
            userDecks = userDecks.filter(d => d.id !== id);
            saveDecks(); renderDecks();
        }
    }

    function toggleCard(id) {
        const card = document.querySelector(`.card[data-id="${id}"]`);
        const content = document.getElementById(`content-${id}`);
        if(card.classList.contains('active')) {
            card.classList.remove('active'); document.body.classList.remove('locked');
            setTimeout(() => content.innerHTML = '', 300);
        } else {
            document.querySelectorAll('.active').forEach(c => { c.classList.remove('active'); c.querySelector('.card-content').innerHTML=''; });
            card.classList.add('active'); document.body.classList.add('locked');
            const deck = userDecks.find(d => d.id === id);
            if(deck) {
                const ifr = document.createElement('iframe');
                content.appendChild(ifr);
                ifr.contentWindow.document.open();
                ifr.contentWindow.document.write(deck.code);
                ifr.contentWindow.document.close();
            }
        }
    }

    // INICIAR
    initInterface();
    renderDecks();

</script>
</body>
</html>
