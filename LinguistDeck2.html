<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MDC - Polyglot Tutor V32 (Dual View)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.youtube.com/iframe_api"></script>
<style>
        :root {
            --primary: #007AFF;
            --bg-body: #F2F2F7;
            --header-height: 60px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            background: var(--bg-body);
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
            padding-top: var(--header-height);
            padding-bottom: 60px;
            color: #111;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: scroll;
        }

        /* ====== TOP HEADER ====== */
        #mdc-header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
            background: rgba(10, 20, 35, 0.95); backdrop-filter: blur(16px);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        #mdc-header a { text-decoration: none; font-weight: 900; font-size: 22px; color: white; }

        /* ====== CONTROL BAR ====== */
        .control-bar {
            width: 95%; max-width: 1200px; margin: 20px auto 15px auto;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px);
            border: 1px solid #d1d1d6; border-radius: 16px; padding: 12px 16px;
            display: flex; align-items: center; justify-content: space-between; gap: 15px; z-index: 900;
        }
        .control-left { display: flex; align-items: center; gap: 12px; flex-grow: 1; }
        .compact-search { position: relative; width: 100%; max-width: 400px; }
        .compact-search input {
            width: 100%; padding: 10px 12px 10px 36px; border-radius: 10px;
            border: 1px solid #ccc; outline: none;
        }
        .compact-search .icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.6; }

        .btn-new-session {
            background: #000; color: white; padding: 10px 20px; border-radius: 10px;
            border: none; font-weight: 700; cursor: pointer;
        }
        .btn-data-mini {
            width: 42px; height: 42px; border-radius: 10px; border: 1px solid #ccc;
            background: #fff; cursor: pointer; font-size: 1.3rem; display: flex; align-items: center; justify-content: center;
        }

        /* ====== DATA MENU ====== */
        .data-menu-popup {
            display: none; position: absolute; top: 75px; right: 5%; width: 240px;
            background: white; border: 1px solid #d1d1d6; border-radius: 14px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); padding: 8px; z-index: 2000;
        }
        .data-menu-popup.active { display: block; }
        .data-menu-item {
            display: flex; align-items: center; gap: 12px; width: 100%; padding: 12px;
            border: none; background: transparent; font-weight: 600; cursor: pointer; text-align: left;
        }
        .data-menu-item:hover { background: #f2f2f7; border-radius: 8px; }
        .data-menu-item.danger { color: #cc0000; }

        /* ====== GRID ====== */
        .section-header { width: 95%; max-width: 1200px; margin: 20px auto 5px auto; font-weight: 900; border-bottom: 2px solid #e5e5ea; }
        .grid-container { width: 95%; max-width: 1200px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; padding-bottom: 60px; margin: 20px auto; }
        
        .resource-card { background: white; border-radius: 16px; overflow: hidden; border: 1px solid #e5e5ea; height: 260px; display: flex; flex-direction: column; }
        .media-area { height: 150px; background: #000; position: relative; cursor: pointer; overflow: hidden; display: flex; align-items: center; justify-content: center;}
        .media-area img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }
        .play-icon { position: absolute; width: 50px; height: 50px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .card-info { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .card-title { font-weight: 800; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-actions { display: flex; gap: 8px; margin-top: auto; }
        .btn-action { flex: 1; background: #f9f9fb; border: 1px solid #e5e5ea; padding: 6px; border-radius: 6px; cursor: pointer; }

        /* ====== DUAL WINDOW POPUP (FORMERLY EDITOR) ====== */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-overlay.active { display: flex; }
        
        .editor-popup { 
            background: #111; 
            width: 98%; max-width: 1800px; height: 95vh; 
            display: flex; flex-direction: row; 
            border-radius: 16px; overflow: hidden; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); 
        }

        /* LEFT & RIGHT PANELS ARE NOW IDENTICAL IN STRUCTURE */
        .split-panel { 
            flex: 1; min-width: 300px; display: flex; flex-direction: column; 
            background: #e5e5ea; position: relative; 
        }

        /* RESIZER */
        .resizer-gutter { 
            width: 12px; background: #333; cursor: col-resize; flex-shrink: 0; 
            border-left: 1px solid #444; border-right: 1px solid #444; 
            display: flex; align-items: center; justify-content: center;
        }
        .resizer-gutter::after { content: "||"; color: #666; font-size: 10px; }

        /* WEB TABS & CONTENT */
        .media-iframe-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
        
        /* Nav Bars */
        .web-tab-nav { 
            display: flex; background: #f2f2f7; border-bottom: 1px solid #ccc; 
            height: 40px; flex-shrink: 0; 
        }
        .web-tab-btn { 
            flex: 1; border: none; background: #f2f2f7; color: #888; 
            font-size: 0.8rem; font-weight: 700; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 6px; 
            border-bottom: 3px solid transparent; transition: all 0.2s; 
            padding: 0 5px; white-space: nowrap; overflow: hidden;
        }
        .web-tab-btn:hover { background: #e5e5ea; color: #555; }
        
        /* Active States Colors */
        .web-tab-btn.active-1 { color: #007AFF; border-bottom-color: #007AFF; background: #fff; }
        .web-tab-btn.active-2 { color: #34C759; border-bottom-color: #34C759; background: #fff; }
        .web-tab-btn.active-3 { color: #AF52DE; border-bottom-color: #AF52DE; background: #fff; }
        .web-tab-btn.active-4 { color: #FF9500; border-bottom-color: #FF9500; background: #fff; }
        .web-tab-btn.active-5 { color: #FF3B30; border-bottom-color: #FF3B30; background: #fff; }

        .tab-gear { font-size: 0.8rem; opacity: 0.4; padding: 2px; border-radius: 50%; }
        .tab-gear:hover { opacity: 1; background: rgba(0,0,0,0.1); color: #000; }

        /* Content Areas */
        .web-content-area { flex: 1; position: relative; width: 100%; height: 100%; background: #fff; }
        .web-frame-container { width: 100%; height: 100%; display: none; position: relative; }
        .web-frame-container.active { display: block; }
        .web-frame-container iframe { width: 100%; height: 100%; border: none; background: #fff; }
        
        .web-error-bg { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            color: #aaa; background: #f9f9fb; font-weight: 600; 
        }

        /* Floating Close Button */
        .floating-close {
            position: absolute; top: 10px; right: 10px; z-index: 3000;
            width: 36px; height: 36px; background: #FF3B30; color: white;
            border-radius: 50%; border: 2px solid white; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .floating-close:hover { transform: scale(1.1); }

        /* ====== TAB SETTINGS POPUP ====== */
        .tab-settings-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .tab-settings-modal.active { display: flex; }
        .tab-popup-content { background: #fff; padding: 25px; border-radius: 16px; width: 600px; max-width: 95%; box-shadow: 0 25px 80px rgba(0,0,0,0.5); }
        .tab-input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-input-group input { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; }
        
    </style>
</head>
<body>

    <div id="mdc-header">
        <a href="#">MDC Polyglot - Dual View</a>
    </div>

    <div class="control-bar">
        <div class="control-left">
            <div class="compact-search">
                <span class="icon">üîç</span>
                <input type="text" id="searchInput" placeholder="Search resources..." oninput="applySearch()">
            </div>
        </div>
        <div class="control-right">
            <button class="btn-new-session" onclick="openDualView()">
                <span>+ Dual Browser</span>
            </button>
            <button class="btn-data-mini" onclick="document.getElementById('data-popup').classList.toggle('active')">‚öôÔ∏è</button>
            <div id="data-popup" class="data-menu-popup">
                <button class="data-menu-item danger" onclick="clearResources()">üóëÔ∏è Clear Data</button>
            </div>
        </div>
    </div>

    <div class="section-header"><span>üìö Library</span></div>
    <div class="grid-container" id="video-grid"></div>

    <div class="modal-overlay" id="dual-modal">
        <button class="floating-close" onclick="closeDualView()">√ó</button>
        
        <div class="editor-popup" id="popup-container">
            <div class="split-panel" id="panel-left"></div>
            
            <div class="resizer-gutter" id="drag-resizer"></div>
            
            <div class="split-panel" id="panel-right"></div>
        </div>
    </div>

    <div id="tab-settings-modal" class="tab-settings-modal" onclick="if(event.target===this) closeTabPopup()">
        <div class="tab-popup-content">
            <h3>Configure Tab URL</h3>
            <div class="tab-input-group">
                <input type="text" id="tab-url-input" placeholder="https://...">
                <button onclick="applyTabUrlFromInput()" style="background:#007AFF; color:white; border:none; padding:0 15px; border-radius:6px; cursor:pointer;">Go</button>
            </div>
        </div>
    </div>

<script>
    /* ====== CONFIG & STATE ====== */
    const STORAGE_KEY = 'mdc_saved_dual_v32';
    const FIXED_TAB_5_URL = "https://paradisonetworx.com/LinguistDeckVocabulary.html";

    let currentResourceId = null;
    let editingSide = null; // 'left' or 'right'
    let editingIndex = 0;
    
    // Default structure for Right Side (since it's new/stateless for old resources)
    const DEFAULT_RIGHT_TABS = ["", "", "", "", ""];

    document.addEventListener('DOMContentLoaded', () => {
        loadResources();
        initResizer();
    });

    /* ====== RESIZER LOGIC ====== */
    function initResizer() {
        const resizer = document.getElementById('drag-resizer');
        const leftSide = document.getElementById('panel-left');
        const container = document.getElementById('popup-container');
        let x = 0, leftWidth = 0;

        const mouseDownHandler = (e) => {
            x = e.clientX;
            leftWidth = leftSide.getBoundingClientRect().width;
            document.addEventListener('mousemove', mouseMoveHandler);
            document.addEventListener('mouseup', mouseUpHandler);
            container.style.userSelect = 'none';
            container.style.pointerEvents = 'none'; // prevent iframe stealing mouse
        };

        const mouseMoveHandler = (e) => {
            const dx = e.clientX - x;
            const newW = ((leftWidth + dx) / container.getBoundingClientRect().width) * 100;
            if(newW > 10 && newW < 90) leftSide.style.width = `${newW}%`;
        };

        const mouseUpHandler = () => {
            document.removeEventListener('mousemove', mouseMoveHandler);
            document.removeEventListener('mouseup', mouseUpHandler);
            container.style.pointerEvents = 'auto';
            container.style.userSelect = 'auto';
        };

        resizer.addEventListener('mousedown', mouseDownHandler);
    }

    /* ====== RESOURCE MANAGEMENT ====== */
    function openDualView(id = null) {
        let resource;
        
        if (id) {
            // Load Existing
            const resources = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            resource = resources.find(r => r.id === id);
            currentResourceId = id;
        } else {
            // Create New
            const newId = Date.now().toString();
            resource = {
                id: newId,
                title: "New Session " + new Date().toLocaleTimeString(),
                leftTabs: ["", "", "", "", FIXED_TAB_5_URL],
                rightTabs: ["", "", "", "", ""]
            };
            const resources = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            resources.unshift(resource);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(resources));
            currentResourceId = newId;
            loadResources();
        }

        // Render Panels
        renderPanel('left', resource.leftTabs);
        renderPanel('right', resource.rightTabs || DEFAULT_RIGHT_TABS);
        
        document.getElementById('dual-modal').classList.add('active');
    }

    function renderPanel(side, urls) {
        const container = document.getElementById(`panel-${side}`);
        
        // Generate Tabs HTML
        let navHtml = `<div class="web-tab-nav">`;
        urls.forEach((url, i) => {
            navHtml += `
                <button class="web-tab-btn channel-${i+1} ${i===0?'active-'+(i+1):''}" 
                        onclick="switchTab('${side}', ${i})" id="btn-${side}-${i}">
                    Tab ${i+1} 
                    <span class="tab-gear" onclick="openTabConfig('${side}', ${i}, event)">‚öôÔ∏è</span>
                </button>`;
        });
        navHtml += `</div>`;

        // Generate Content HTML
        let contentHtml = `<div class="web-content-area">`;
        urls.forEach((url, i) => {
            let inner = `<div class="web-error-bg"><span>Empty Tab<br><small>Click ‚öôÔ∏è</small></span></div>`;
            if(url) {
                // Check if YouTube
                const ytId = getYouTubeID(url);
                if(ytId) {
                    inner = `<iframe src="https://www.youtube.com/embed/${ytId}" allowfullscreen style="width:100%;height:100%;border:none;"></iframe>`;
                } else {
                    inner = `<iframe src="${url}" allowfullscreen style="width:100%;height:100%;border:none;"></iframe>`;
                }
            }
            contentHtml += `<div class="web-frame-container ${i===0?'active':''}" id="content-${side}-${i}">${inner}</div>`;
        });
        contentHtml += `</div>`;

        container.innerHTML = navHtml + contentHtml;
    }

    function switchTab(side, index) {
        // Update Buttons
        const btns = document.querySelectorAll(`#panel-${side} .web-tab-btn`);
        btns.forEach((b, i) => {
            if (i === index) b.classList.add(`active-${i+1}`);
            else b.className = `web-tab-btn channel-${i+1}`;
        });

        // Update Content
        const frames = document.querySelectorAll(`#panel-${side} .web-frame-container`);
        frames.forEach((f, i) => {
            if (i === index) f.classList.add('active');
            else f.classList.remove('active');
        });
    }

    /* ====== CONFIG POPUP ====== */
    function openTabConfig(side, index, event) {
        event.stopPropagation();
        editingSide = side;
        editingIndex = index;
        
        const resources = JSON.parse(localStorage.getItem(STORAGE_KEY));
        const res = resources.find(r => r.id === currentResourceId);
        const currentUrl = (side === 'left') ? res.leftTabs[index] : (res.rightTabs ? res.rightTabs[index] : "");
        
        document.getElementById('tab-url-input').value = currentUrl;
        document.getElementById('tab-settings-modal').classList.add('active');
    }

    function applyTabUrlFromInput() {
        const url = document.getElementById('tab-url-input').value;
        const resources = JSON.parse(localStorage.getItem(STORAGE_KEY));
        const resIndex = resources.findIndex(r => r.id === currentResourceId);
        
        if (resIndex > -1) {
            if(editingSide === 'left') {
                resources[resIndex].leftTabs[editingIndex] = url;
            } else {
                if(!resources[resIndex].rightTabs) resources[resIndex].rightTabs = [...DEFAULT_RIGHT_TABS];
                resources[resIndex].rightTabs[editingIndex] = url;
            }
            
            // Auto Update Title if Tab 1
            if(editingIndex === 0 && editingSide === 'left' && url) {
                resources[resIndex].title = getDomain(url) + " Session";
            }

            localStorage.setItem(STORAGE_KEY, JSON.stringify(resources));
            
            // Re-render only the affected panel
            renderPanel(editingSide, editingSide === 'left' ? resources[resIndex].leftTabs : resources[resIndex].rightTabs);
            // Switch to the edited tab
            switchTab(editingSide, editingIndex);
            loadResources(); // Update Grid
        }
        closeTabPopup();
    }

    function closeTabPopup() { document.getElementById('tab-settings-modal').classList.remove('active'); }
    function closeDualView() { 
        document.getElementById('dual-modal').classList.remove('active'); 
        document.getElementById('panel-left').innerHTML = "";
        document.getElementById('panel-right').innerHTML = "";
    }

    /* ====== GRID & HELPERS ====== */
    function loadResources() {
        const resources = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        const grid = document.getElementById('video-grid');
        const query = document.getElementById('searchInput').value.toLowerCase();
        
        grid.innerHTML = "";
        
        resources.forEach(r => {
            if(query && !r.title.toLowerCase().includes(query)) return;
            
            // Determine Preview Image
            let img = "";
            const mainUrl = r.leftTabs[0];
            const ytId = getYouTubeID(mainUrl);
            
            if(ytId) img = `https://img.youtube.com/vi/${ytId}/mqdefault.jpg`;
            else if(mainUrl) img = `https://www.google.com/s2/favicons?domain=${mainUrl}&sz=128`;
            
            const mediaContent = ytId 
                ? `<img src="${img}" style="width:100%;height:100%;object-fit:cover;">`
                : `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#eee;font-size:2rem;">üåê</div>`;

            grid.innerHTML += `
                <div class="resource-card">
                    <div class="media-area" onclick="openDualView('${r.id}')">
                        ${mediaContent}
                        ${ytId ? '<div class="play-icon">‚ñ∂</div>' : ''}
                    </div>
                    <div class="card-info">
                        <div class="card-title">${r.title}</div>
                        <div class="card-actions">
                            <button class="btn-action" onclick="openDualView('${r.id}')">Open</button>
                            <button class="btn-action" style="color:red;" onclick="deleteRes('${r.id}')">Delete</button>
                        </div>
                    </div>
                </div>`;
        });
    }

    function deleteRes(id) {
        if(confirm("Delete this session?")) {
            let res = JSON.parse(localStorage.getItem(STORAGE_KEY));
            res = res.filter(r => r.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(res));
            loadResources();
        }
    }
    
    function clearResources() {
        if(confirm("Delete ALL data?")) {
            localStorage.removeItem(STORAGE_KEY);
            loadResources();
        }
    }

    function getYouTubeID(url) { if (!url) return null; const match = (url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|live\/)([^#&?]*).*/) || [])[2]; return (match && match.length === 11) ? match : null; }
    function getDomain(url) { try { return new URL(url).hostname.replace('www.', ''); } catch(e) { return 'Session'; } }

</script>
</body>
</html>
