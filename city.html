<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON MOSAIC | Ultimate Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gap: 15px; /* Espacio ajustado para móviles */
            --cyan: #00f3ff;
            --pink: #ff00ff;
            --purple: #bc13fe;
            --dark: #050508;
            
            /* Paleta de colores neón para el reverso */
            --neon-1: #ff0055; --neon-2: #00ff99; --neon-3: #ffcc00; 
            --neon-4: #9900ff; --neon-5: #00ccff; --neon-6: #ff3300;
        }

        body {
            margin: 0; background-color: var(--dark);
            background-image: radial-gradient(circle at 50% 0%, #1a1a2e 0%, var(--dark) 80%);
            height: 100vh; overflow: hidden; font-family: 'Montserrat', sans-serif;
            color: white; display: flex; flex-direction: column; align-items: center;
        }

        /* === HUD SUPERIOR === */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 90px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; box-sizing: border-box; z-index: 100;
            pointer-events: none; /* Dejar pasar clicks al escenario */
        }
        .title { 
            font-weight: 900; letter-spacing: 1px; text-transform: uppercase; font-size: 16px;
            text-shadow: 0 0 20px var(--cyan); color: var(--cyan); pointer-events: auto;
        }
        .back-btn {
            background: rgba(0,0,0,0.8); border: 2px solid var(--pink);
            color: var(--pink); padding: 8px 20px; border-radius: 4px;
            cursor: pointer; font-weight: 900; text-transform: uppercase; font-size: 12px;
            transition: 0.3s; opacity: 0; pointer-events: auto; transform: translateY(-20px);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.2);
        }
        .back-btn.visible { opacity: 1; transform: translateY(0); }
        .back-btn:hover { background: var(--pink); color: #000; box-shadow: 0 0 30px var(--pink); }

        /* === ESCENARIO 3D (CON FADE) === */
        #scene {
            width: 100%; height: 100%; 
            perspective: 800px; /* Perspectiva agresiva para inmersión */
            display: flex; align-items: center; justify-content: center; 
            overflow: hidden;
            
            /* MÁSCARA DE DIFUMINADO SUPERIOR (Efecto Niebla) */
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, transparent 15%, black 40%, black 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, transparent 15%, black 40%, black 100%);
        }

        #floor {
            display: grid; 
            justify-content: center;
            
            /* LÓGICA DE 3 COLUMNAS */
            grid-template-columns: repeat(3, 1fr);
            gap: var(--gap); 
            
            /* Ancho > 100% para salirse de la pantalla */
            width: 115%; 
            
            /* Inclinación isométrica */
            transform: rotateX(45deg) rotateZ(0deg) translateY(0px);
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            
            /* Padding generoso arriba (zona fade) y abajo (zona scroll) */
            padding: 150px 20px 300px 20px; 
            max-height: 100vh; overflow-y: auto; 
            scrollbar-width: none; -ms-overflow-style: none;
        }
        #floor::-webkit-scrollbar { display: none; }

        /* === MOSAICOS SÓLIDOS (DISEÑO RECUPERADO) === */
        .tile {
            width: 100%; /* Llenar columna */
            height: 120px; /* Altura fija */
            position: relative; transform-style: preserve-3d; cursor: pointer;
            opacity: 0; animation: popUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popUp { 0% { opacity: 0; transform: translateZ(-200px); } 100% { opacity: 1; transform: translateZ(0); } }

        /* EL BLOQUE 3D FÍSICO */
        .tile-inner {
            position: absolute; width: 100%; height: 100%;
            transition: transform 0.6s cubic-bezier(0.3, 1.5, 0.5, 1), box-shadow 0.6s ease;
            transform-style: preserve-3d;
            background: #0a0a10;
            border: 2px solid rgba(0, 243, 255, 0.3); 
            /* Sombras complejas para volumen "vidrioso" */
            box-shadow: 
                0 6px 0 #000, 
                0 15px 25px rgba(0,0,0,0.6), 
                inset 0 0 20px rgba(0, 243, 255, 0.1);
        }

        .tile:hover .tile-inner {
            border-color: var(--cyan);
            box-shadow: 0 6px 0 #000, 0 15px 35px rgba(0, 243, 255, 0.2), inset 0 0 30px rgba(0, 243, 255, 0.2);
        }

        /* ESTADO GIRADO (FLIPPED - SIN LEVANTARSE) */
        .tile.flipped .tile-inner {
            transform: rotateY(180deg); 
            z-index: 10;
            border-color: var(--back-color);
            /* Resplandor del color específico */
            box-shadow: 0 6px 0 #000, 0 0 40px var(--back-color), inset 0 0 30px rgba(255,255,255,0.2);
        }

        /* CARAS */
        .face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 5px; text-align: center; 
            user-select: none; box-sizing: border-box; overflow: hidden;
        }

        .face.front {
            transform: rotateY(0deg) translateZ(1px); 
            background: linear-gradient(135deg, rgba(0,243,255,0.15), rgba(0,0,0,0.9));
            color: var(--cyan);
            text-shadow: 0 0 8px rgba(0,243,255,0.6);
        }
        .face.front::after {
            content:''; position: absolute; bottom: 8px; width: 30%; height: 2px;
            background: var(--cyan); box-shadow: 0 0 10px var(--cyan); opacity: 0.7;
        }

        .face.back {
            background: var(--back-color);
            transform: rotateY(180deg) translateZ(1px); 
            color: #000; text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            border: 4px solid rgba(0,0,0,0.3); /* Marco interno */
        }

        /* ESTILOS DE TEXTO */
        .icon-type { font-size: 28px; margin-bottom: 8px; filter: drop-shadow(0 0 5px var(--cyan)); }
        
        .word-text { 
            text-transform: uppercase; line-height: 1.1; font-weight: 900; 
            width: 100%; word-wrap: break-word; hyphens: auto; 
        }
        .sub-text { font-size: 9px; opacity: 0.8; margin-top: 5px; font-weight: 600; color:white; letter-spacing: 1px; }

        /* ESTILO VERBOS IRREGULARES */
        .verb-stack { display:flex; flex-direction:column; gap:2px; width:100%; height:100%; justify-content:center; }
        .verb-row { border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 2px; margin-bottom: 2px; }
        .verb-row:last-child { border-bottom: none; margin-bottom: 0; }
        .verb-tag { font-size: 7px; opacity: 0.6; text-transform: uppercase; font-weight: 700; display:block; letter-spacing: 1px;}
        .verb-word { font-size: 11px; font-weight: 900; text-transform: uppercase; display:block; line-height: 1;}
        .verb-trans { font-size: 10px; font-style: italic; margin-bottom: 4px; font-weight: 600; background:rgba(255,255,255,0.3); padding:2px; border-radius:4px; display:inline-block;}

        #loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:var(--cyan); font-weight:900; letter-spacing: 2px; animation:pulse 1s infinite; pointer-events:none;}
        @keyframes pulse { 0%{opacity:0.3} 50%{opacity:1} 100%{opacity:0.3} }
    </style>
</head>
<body>

    <script src="https://paradisonetworx.com/database.js"></script>

    <div id="hud">
        <div class="title" id="page-title">SYSTEM LOADING...</div>
        <button class="back-btn" onclick="renderFolders()">← MENU</button>
    </div>

    <div id="loading">INITIALIZING...</div>

    <div id="scene">
        <div id="floor"></div>
    </div>

    <script>
        // ==========================================
        // 1. GESTIÓN DE DATOS 
        // ==========================================
        let db = [];
        const neonColors = ['var(--neon-1)', 'var(--neon-2)', 'var(--neon-3)', 'var(--neon-4)', 'var(--neon-5)', 'var(--neon-6)'];

        function clean(txt) { if (!txt) return ""; return String(txt).split('/')[0].trim(); }

        // Tipografía dinámica agresiva para móviles
        function getSmartFontSize(text) {
            const len = text.length;
            if (len <= 5) return '18px';  
            if (len <= 10) return '14px'; 
            if (len <= 18) return '12px'; 
            return '10px';                 
        }

        async function initDB() {
            let customData = [];
            try { const raw = localStorage.getItem('mdc_vocab_list'); if(raw) customData = JSON.parse(raw); } catch(e) {}

            return new Promise(resolve => {
                const check = setInterval(() => {
                    if (typeof INTERNAL_VOCAB !== 'undefined') {
                        clearInterval(check);
                        
                        const officialFolders = Object.keys(INTERNAL_VOCAB).map(key => {
                            return {
                                id: key,
                                isFolder: true,
                                name: key.replace(/_/g, ' '),
                                type: 'official',
                                items: INTERNAL_VOCAB[key].map(item => ({
                                    eng: clean(item.en),
                                    esp: item.es,
                                    past: item.past ? clean(item.past) : null,
                                    part: item.part ? clean(item.part) : null
                                }))
                            };
                        });
                        db = [...officialFolders, ...customData];
                        resolve();
                    }
                }, 100);
            });
        }

        // ==========================================
        // 2. MOTOR RENDER
        // ==========================================
        const floor = document.getElementById('floor');
        const title = document.getElementById('page-title');
        const backBtn = document.querySelector('.back-btn');
        const loading = document.getElementById('loading');

        function renderFolders() {
            floor.innerHTML = ''; 
            title.innerText = "NEON DATABASE";
            title.style.color = "var(--cyan)";
            backBtn.classList.remove('visible');
            
            // Inclinación
            floor.style.transform = "rotateX(45deg) translateY(50px)";
            
            const folders = db.filter(i => i.isFolder);
            const loose = db.filter(i => !i.isFolder);

            if (loose.length > 0) createTile({ name: "MY SAVED", count: loose.length, id: 'root', type: 'hub' }, 0);
            
            folders.forEach((f, index) => {
                const isOfficial = f.type === 'official';
                createTile({ 
                    name: f.name, count: f.items.length, id: f.id, type: isOfficial ? 'official' : 'custom' 
                }, index + 1);
            });
        }

        function openFolder(id) {
            floor.innerHTML = ''; 
            backBtn.classList.add('visible');
            // Misma inclinación para consistencia
            floor.style.transform = "rotateX(45deg) translateY(50px)";

            let items = [], folderName = "";
            if (id === 'root') { items = db.filter(i => !i.isFolder); folderName = "MY SAVED"; } 
            else { const f = db.find(i => i.id === id); if (f) { items = f.items; folderName = f.name; }}

            title.innerText = folderName;
            title.style.color = "white";
            
            if(items.length === 0) floor.innerHTML = `<div style="grid-column:1/-1; text-align:center; opacity:0.5; margin-top:100px;">EMPTY SECTOR</div>`;

            items.forEach((item, index) => createWordTile(item, index));
        }

        // ==========================================
        // 3. GENERADORES DE MOSAICOS
        // ==========================================

        function createTile(data, index) {
            const tile = document.createElement('div');
            tile.className = 'tile';
            tile.style.animationDelay = `${index * 0.05}s`;
            
            let icon = '◆'; let color = 'var(--cyan)';
            if (data.type === 'official') { icon = '❖'; color = 'var(--purple)'; }
            if (data.type === 'hub') { icon = '★'; color = 'var(--pink)'; }
            
            tile.innerHTML = `
                <div class="tile-inner">
                    <div class="face front" style="color:${color}; border-bottom-color:${color};">
                        <div class="icon-type">${icon}</div>
                        <div class="word-text" style="font-size:12px;">${data.name}</div>
                        <div class="sub-text">${data.count} UNITS</div>
                    </div>
                    <div class="face back"></div>
                </div>
            `;
            tile.onclick = () => {
                const all = document.querySelectorAll('.tile');
                all.forEach(t => t.style.transform = "scale(0) translateZ(-100px)");
                setTimeout(() => openFolder(data.id), 400);
            };
            floor.appendChild(tile);
        }

        function createWordTile(item, index) {
            const tile = document.createElement('div');
            tile.className = 'tile';
            tile.style.animationDelay = `${index * 0.03}s`;

            const eng = item.eng || "?";
            const esp = item.esp || "...";
            const randomColor = neonColors[Math.floor(Math.random() * neonColors.length)];
            tile.style.setProperty('--back-color', randomColor);

            // Detectar Verbo Irregular
            const isIrregular = (item.past && item.part);
            const fontSizeEng = getSmartFontSize(eng);
            const fontSizeEsp = getSmartFontSize(esp);

            let backHTML = '';

            if (isIrregular) {
                // DISEÑO ESPECIAL PARA VERBOS (3 en 1)
                backHTML = `
                    <div class="verb-stack">
                        <div class="verb-trans">${esp.substring(0,15)}</div>
                        <div class="verb-row"><span class="verb-tag">BASE</span><span class="verb-word">${eng}</span></div>
                        <div class="verb-row"><span class="verb-tag">PAST</span><span class="verb-word">${item.past}</span></div>
                        <div class="verb-row"><span class="verb-tag">PART</span><span class="verb-word">${item.part}</span></div>
                    </div>
                `;
            } else {
                // DISEÑO NORMAL
                backHTML = `<div class="word-text" style="font-size:${fontSizeEsp}">${esp}</div>`;
            }

            tile.innerHTML = `
                <div class="tile-inner">
                    <div class="face front">
                        <div class="word-text" style="font-size:${fontSizeEng}">${eng}</div>
                    </div>
                    <div class="face back">
                        ${backHTML}
                    </div>
                </div>
            `;

            tile.onclick = () => {
                const isAlreadyFlipped = tile.classList.contains('flipped');
                
                if (isAlreadyFlipped) {
                    // Si ya está abierto, lo cerramos
                    tile.classList.remove('flipped');
                    return;
                }
                
                // Cerrar otros
                const currentOpen = document.querySelector('.tile.flipped');
                if (currentOpen) currentOpen.classList.remove('flipped');

                // Abrir nuevo
                tile.classList.add('flipped');

                // Audio Logic
                if (isIrregular) {
                    speakSequence([eng, item.past, item.part]);
                } else {
                    speak(eng, 'en-US');
                }
            };
            floor.appendChild(tile);
        }

        // ==========================================
        // 4. AUDIO
        // ==========================================
        function speak(text, lang) {
            window.speechSynthesis.cancel(); 
            const u = new SpeechSynthesisUtterance(text);
            u.lang = lang; u.rate = 1.0; 
            const voices = window.speechSynthesis.getVoices();
            if(lang === 'en-US') {
                const v = voices.find(voice => voice.name.includes('Google US English') || voice.lang === 'en-US');
                if(v) u.voice = v;
            }
            window.speechSynthesis.speak(u);
        }

        function speakSequence(words) {
            window.speechSynthesis.cancel();
            let i = 0;
            function next() {
                if (i >= words.length) return;
                const u = new SpeechSynthesisUtterance(words[i]);
                u.lang = 'en-US'; u.rate = 1.0;
                
                const voices = window.speechSynthesis.getVoices();
                const v = voices.find(voice => voice.name.includes('Google US English') || voice.lang === 'en-US');
                if(v) u.voice = v;
                
                u.onend = () => { i++; setTimeout(next, 300); };
                window.speechSynthesis.speak(u);
            }
            next();
        }

        // INICIO
        initDB().then(() => {
            loading.style.display = 'none';
            renderFolders();
        });

    </script>
</body>
</html>
