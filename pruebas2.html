<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MDC - Polyglot Tutor V26</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root {
            --primary: #007AFF;
            --bg-body: #F2F2F7;
            --text-main: #1C1C1E;
            --text-muted: #8E8E93;
            --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.06);
            --header-height: 60px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            background: var(--bg-body);
            font-family: 'Inter', sans-serif;
            padding-top: var(--header-height);
            padding-bottom: 60px;
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ====== HEADER ====== */
        #mdc-header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
            background: rgba(31, 41, 55, 0.9); backdrop-filter: blur(16px);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        #mdc-header a { text-decoration: none; font-weight: 800; font-size: 20px; color: white; }

        /* ====== DASHBOARD ====== */
        .dashboard-container {
            width: 95%; max-width: 1100px; margin-top: 30px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .dash-card {
            background: #fff; border-radius: 16px; padding: 24px; box-shadow: var(--shadow-soft);
            display: flex; flex-direction: column; gap: 15px;
        }

        .dash-title { font-size: 1.1rem; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 8px; }
        
        .btn-free-study {
            background: linear-gradient(135deg, #007AFF, #5856D6); color: white; border: none; padding: 16px; 
            border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; 
            align-items: center; justify-content: center; gap: 10px;
        }

        .input-group label { display: block; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-bottom: 5px; text-transform: uppercase; }
        input[type="text"] { width: 100%; padding: 10px 12px; border: 1px solid #e5e5ea; border-radius: 8px; background: #f9f9fb; }
        input[type="text"]:focus { border-color: var(--primary); outline: none; background: #fff; }
        
        .type-selector { display: flex; gap: 5px; background: #f2f2f7; padding: 4px; border-radius: 8px; }
        .type-btn { flex: 1; border: none; background: transparent; padding: 6px; font-size: 0.75rem; font-weight: 600; cursor: pointer; border-radius: 6px; color: #8e8e93; }
        .type-btn.active { background: white; color: var(--text-main); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .btn-add-res { width: 100%; padding: 12px; background: var(--text-main); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; }
        .manage-box { display: none; background: #fff5f5; padding: 10px; border-radius: 8px; margin-top: 10px; }
        .manage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .btn-clean { background: white; border: 1px solid #ffccc7; color: #FF3B30; font-size: 0.7rem; padding: 6px; border-radius: 6px; cursor: pointer; }
        
        /* ====== FILTER BAR ====== */
        .filter-section { width: 95%; max-width: 1100px; margin-top: 30px; display: flex; flex-direction: column; gap: 15px; }
        @media (min-width: 600px) { .filter-section { flex-direction: row; align-items: center; justify-content: space-between; } }
        .filter-pill-container { background: #e5e5ea; padding: 4px; border-radius: 12px; display: inline-flex; gap: 2px; }
        .filter-btn { padding: 8px 16px; border: none; background: transparent; font-size: 0.9rem; font-weight: 600; color: #666; cursor: pointer; border-radius: 10px; }
        .filter-btn.active { background: white; color: black; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .search-container { position: relative; flex-grow: 1; max-width: 300px; }
        .search-container input { padding-left: 34px; background: white; border: 1px solid #e5e5ea; width: 100%; border-radius: 10px; height: 36px;}
        .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity: 0.4; }

        /* ====== RESOURCE CARDS (THE NEW DESIGN) ====== */
        .grid-container { width: 95%; max-width: 1100px; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding-bottom: 40px; margin-top: 20px; }
        
        .res-card {
            border-radius: 20px; 
            padding: 20px; 
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 180px; 
            box-shadow: var(--shadow-soft);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            border: 1px solid rgba(0,0,0,0.03);
        }
        .res-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.08); }

        /* Header: Icon + Badge */
        .res-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .res-icon { 
            width: 48px; height: 48px; background: white; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            overflow: hidden;
        }
        .res-icon img { width: 32px; height: 32px; object-fit: contain; }
        .res-icon-txt { font-size: 1.5rem; }
        
        .res-badge { 
            background: rgba(255,255,255,0.6); backdrop-filter: blur(4px);
            padding: 4px 10px; border-radius: 20px; 
            font-size: 0.65rem; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase;
            color: rgba(0,0,0,0.6);
        }

        /* Body: Title + Domain */
        .res-body { flex-grow: 1; margin-bottom: 15px; cursor: pointer;}
        .res-title { font-size: 1.1rem; font-weight: 700; color: #1c1c1e; line-height: 1.3; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
        .res-domain { font-size: 0.8rem; color: rgba(0,0,0,0.5); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Footer: Date + Actions */
        .res-footer { display: flex; align-items: center; justify-content: space-between; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 12px; }
        .res-date { font-size: 0.75rem; color: rgba(0,0,0,0.4); font-weight: 500; }
        .res-actions { display: flex; gap: 6px; }
        
        .btn-card-icon { 
            width: 32px; height: 32px; border-radius: 8px; border: none; 
            background: rgba(255,255,255,0.5); cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            transition: background 0.2s; font-size: 1rem; color: #333;
        }
        .btn-card-icon:hover { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-dice:hover { color: var(--primary); transform: rotate(180deg); transition: transform 0.4s; }
        .btn-del:hover { color: #FF3B30; }

        /* Standard Editor Styles (Hidden here for brevity, same as V25) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .editor-popup { background: white; width: 95%; max-width: 1500px; height: 90vh; display: flex; border-radius: 14px; overflow: hidden; }
        @media (max-width: 900px) { .editor-popup { flex-direction: column; width: 100%; height: 100%; border-radius: 0; } }
        
        .desktop-video-container { flex: 1; background: #000; position: relative; display: flex; align-items: center; justify-content: center; min-width: 300px;}
        .editor-content-panel { flex: 1; background: white; display: flex; flex-direction: column; min-width: 300px; position: relative; }
        
        .editor-popup.free-mode .desktop-video-container { display: none !important; }
        
        .editor-toolbar { padding: 10px; border-bottom: 1px solid #eee; display: flex; gap: 10px; overflow-x: auto; background: #fff; }
        .editor-area { flex: 1; padding: 25px; overflow-y: auto; outline: none; font-size: 1.1rem; line-height: 1.6; }
        
        /* Helpers */
        .web-iframe { width: 100%; height: 100%; border: none; background: white; }
        .audio-player-box { color: white; text-align: center; }
    </style>
</head>
<body>

    <div id="mdc-header">
        <a href="#">MDC Polyglot</a>
    </div>

    <div class="dashboard-container">
        <div class="dash-card" style="border-top: 4px solid var(--primary);">
            <div class="dash-title"><span style="font-size:1.5rem">üìù</span> Pizarra de Estudio</div>
            <div style="font-size:0.85rem; color:#8e8e93;">Editor libre sin multimedia. Ideal para templates.</div>
            <button class="btn-free-study" onclick="openFreeEditor()"><span>Entrar al Editor</span><span>‚Üí</span></button>
        </div>

        <div class="dash-card">
            <div class="dash-title"><span style="font-size:1.5rem">‚ûï</span> Add Resource</div>
            <div class="type-selector">
                <button class="type-btn active" onclick="setResourceType('auto')">‚ú® Auto</button>
                <button class="type-btn" onclick="setResourceType('video')">üé• Video</button>
                <button class="type-btn" onclick="setResourceType('audio')">üéß Audio</button>
                <button class="type-btn" onclick="setResourceType('web')">üåê Web</button>
            </div>
            <div class="input-group">
                <label>URL</label>
                <input type="text" id="vidUrl" placeholder="https://...">
            </div>
            <div class="input-group">
                <label>Title (Optional)</label>
                <input type="text" id="vidTitle" placeholder="Auto-generated if empty">
            </div>
            <button class="btn-add-res" onclick="addResource()">Add to Library</button>
            <div style="text-align: right; margin-top:5px;">
                <button style="border:none; background:none; color:#999; cursor:pointer; font-size:0.75rem;" onclick="document.getElementById('manage-box').style.display = document.getElementById('manage-box').style.display==='block'?'none':'block'">‚öôÔ∏è Clean/Manage</button>
            </div>
            <div id="manage-box" class="manage-box">
                <div class="manage-grid">
                    <button class="btn-clean" onclick="deleteByType('video')">Del Videos</button>
                    <button class="btn-clean" onclick="deleteByType('audio')">Del Audios</button>
                    <button class="btn-clean" onclick="deleteByType('web')">Del Web</button>
                    <button class="btn-clean" style="color:white; background:var(--danger); border-color:var(--danger);" onclick="deleteByType('all')">Del All</button>
                </div>
            </div>
        </div>

        <div class="dash-card">
            <div class="dash-title"><span style="font-size:1.5rem">üíæ</span> Backup</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn-add-res" style="background:#f2f2f7; color:#333; border:1px solid #ddd;" onclick="downloadBackup()">‚¨áÔ∏è Save</button>
                <input type="file" id="imp" hidden onchange="importBackup(this)">
                <button class="btn-add-res" style="background:#f2f2f7; color:#333; border:1px solid #ddd;" onclick="document.getElementById('imp').click()">‚¨ÜÔ∏è Load</button>
            </div>
        </div>
    </div>

    <div class="filter-section">
        <div class="filter-pill-container">
            <button class="filter-btn active" onclick="filterGrid('all', this)">All</button>
            <button class="filter-btn" onclick="filterGrid('video', this)">Video</button>
            <button class="filter-btn" onclick="filterGrid('audio', this)">Audio</button>
            <button class="filter-btn" onclick="filterGrid('web', this)">Web</button>
        </div>
        <div class="search-container">
            <span class="search-icon">üîç</span>
            <input type="text" id="search-input" placeholder="Search..." oninput="searchGrid()">
        </div>
    </div>

    <div class="grid-container" id="video-grid"></div>

    <div class="modal-overlay" id="editor-modal">
        <div class="editor-popup" id="editor-popup">
            <div class="desktop-video-container" id="desktop-video-wrapper"></div>
            <div class="resizer-gutter" id="drag-resizer"></div>
            <div class="editor-content-panel">
                <div class="editor-header">
                    <span class="editor-title">Note Editor</span>
                    <button class="btn-header-icon" onclick="closeEditor()">√ó</button>
                </div>
                <div class="editor-toolbar">
                    <button class="btn-fmt" onclick="document.execCommand('bold')">B</button>
                    </div>
                <div id="editor-text" class="editor-area" contenteditable="true"></div>
                <div class="editor-footer"><span>‚úì Saved</span></div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'mdc_saved_v26';
        let currentFilter = 'all';
        let selectedResourceType = 'auto';
        
        // Pastel Colors Palette
        const COLORS = ['#FFF8E1', '#E3F2FD', '#F3E5F5', '#E0F2F1', '#FFEBEE', '#F1F8E9', '#E8EAF6', '#FFF3E0'];

        document.addEventListener('DOMContentLoaded', () => { loadVideos(); initResizer(); });

        /* DATA LOGIC */
        function addResource() {
            const url = document.getElementById('vidUrl').value.trim();
            let title = document.getElementById('vidTitle').value.trim();
            if(!url) return alert("URL required");

            let type = 'web';
            let id = url;
            let domain = 'general';

            // Auto Detect
            if(selectedResourceType !== 'auto') type = selectedResourceType;
            else {
                if(url.match(/(youtu\.be|youtube\.com)/)) type = 'video';
                else if(url.match(/\.(mp3|wav|ogg)$/i)) type = 'audio';
            }

            // Process Details
            try {
                const urlObj = new URL(url);
                domain = urlObj.hostname.replace('www.', '');
                if(!title) title = domain; // Default title is domain if empty
            } catch(e) { domain = 'Resource'; }

            if(type === 'video') {
                const m = (url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|live\/)([^#&?]*).*/) || [])[2];
                if(m && m.length===11) id = m;
            }

            const newItem = {
                id, url, title, type, note: "",
                date: new Date().toLocaleDateString(),
                domain: domain,
                color: COLORS[Math.floor(Math.random() * COLORS.length)] // Random Color
            };

            const list = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            list.unshift(newItem);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            
            document.getElementById('vidUrl').value = ''; 
            document.getElementById('vidTitle').value = '';
            loadVideos();
        }

        function loadVideos() {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            renderGrid(data);
        }

        /* RENDER LOGIC (THE NEW CARD) */
        function renderGrid(allData) {
            const grid = document.getElementById('video-grid');
            const query = document.getElementById('search-input').value.toLowerCase();
            
            // Filter
            const filtered = allData.filter(item => {
                const typeMatch = currentFilter === 'all' || item.type === currentFilter;
                const textMatch = (item.title + item.domain).toLowerCase().includes(query);
                return typeMatch && textMatch;
            });

            if(filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#999; margin-top:40px;">No resources found.</div>';
                return;
            }

            grid.innerHTML = filtered.map(item => {
                // Find original index for actions
                const idx = allData.indexOf(item);
                
                // Icon Logic
                let iconUrl = `https://www.google.com/s2/favicons?domain=${item.domain}&sz=64`;
                if(item.type === 'video') iconUrl = `https://img.youtube.com/vi/${item.id}/default.jpg`; // Use YT thumb if video
                
                // Badge Logic
                let typeBadge = item.type.toUpperCase();

                return `
                <div class="res-card" style="background-color: ${item.color || '#fff'};">
                    <div class="res-header">
                        <div class="res-icon">
                            <img src="${iconUrl}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTEyIDJDMi40NyAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMyMS41MyAyIDEyIDJ6IiBmaWxsPSIjY2NjIi8+PC9zdmc+'">
                        </div>
                        <div class="res-badge">${typeBadge}</div>
                    </div>
                    
                    <div class="res-body" onclick="openEditor(${idx})">
                        <div class="res-title">${item.title}</div>
                        <div class="res-domain">${item.domain}</div>
                    </div>

                    <div class="res-footer">
                        <div class="res-date">${item.date}</div>
                        <div class="res-actions">
                            <button class="btn-card-icon btn-dice" onclick="randomizeColor(${idx})" title="Change Color">üé≤</button>
                            <button class="btn-card-icon" onclick="openEditor(${idx})" title="Open">‚Üó</button>
                            <button class="btn-card-icon btn-del" onclick="deleteItem(${idx})" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        /* ACTIONS */
        function randomizeColor(idx) {
            const list = JSON.parse(localStorage.getItem(STORAGE_KEY));
            let newColor = COLORS[Math.floor(Math.random() * COLORS.length)];
            // Ensure change
            while(newColor === list[idx].color) {
                newColor = COLORS[Math.floor(Math.random() * COLORS.length)];
            }
            list[idx].color = newColor;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            loadVideos(); // Re-render to show change
        }

        function deleteItem(idx) {
            if(confirm("Delete this resource?")) {
                const list = JSON.parse(localStorage.getItem(STORAGE_KEY));
                list.splice(idx, 1);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
                loadVideos();
            }
        }

        function filterGrid(type, btn) {
            currentFilter = type;
            if(btn) {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            loadVideos();
        }
        function searchGrid() { loadVideos(); }
        function setResourceType(t) { 
            selectedResourceType = t; 
            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }
        function deleteByType(t) {
            if(!confirm("Sure?")) return;
            let list = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
            if(t==='all') list=[]; else list=list.filter(i=>i.type!==t);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            loadVideos();
        }

        /* EDITOR LOGIC (Simplified wrapper) */
        const modal = document.getElementById('editor-modal');
        let player = null;
        let currentEditIndex = -1;

        function openFreeEditor() {
            openCommon(-1);
            document.getElementById('editor-popup').classList.add('free-mode');
        }

        function openEditor(idx) {
            openCommon(idx);
            document.getElementById('editor-popup').classList.remove('free-mode');
            const item = JSON.parse(localStorage.getItem(STORAGE_KEY))[idx];
            const wrap = document.getElementById('desktop-video-wrapper');
            wrap.innerHTML = '';

            if(window.matchMedia("(min-width: 900px)").matches) {
                if(item.type === 'video') {
                    wrap.innerHTML = '<div id="yt-player" style="width:100%;height:100%"></div>';
                    player = new YT.Player('yt-player', { videoId: item.id });
                } else if(item.type === 'audio') {
                    wrap.innerHTML = `<div class="audio-player-box"><h1>üéß</h1><h3>${item.title}</h3><audio controls src="${item.url}"></audio></div>`;
                } else {
                    wrap.innerHTML = `<iframe class="web-iframe" src="${item.url}" sandbox="allow-same-origin allow-scripts"></iframe>`;
                }
            }
        }

        function openCommon(idx) {
            currentEditIndex = idx;
            const data = idx > -1 ? JSON.parse(localStorage.getItem(STORAGE_KEY))[idx] : {note:''};
            document.getElementById('editor-text').innerHTML = data.note || '';
            modal.classList.add('active');
        }

        function closeEditor() {
            modal.classList.remove('active');
            if(player && player.destroy) player.destroy();
            document.getElementById('desktop-video-wrapper').innerHTML = '';
            if(currentEditIndex > -1) {
                const list = JSON.parse(localStorage.getItem(STORAGE_KEY));
                list[currentEditIndex].note = document.getElementById('editor-text').innerHTML;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
                loadVideos(); // Update notes indicator if implemented
            }
        }

        function saveNote() { /* Autosave logic same as before */ }
        function downloadBackup() { /* ... */ }
        function importBackup(inp) { /* ... */ }
        function initResizer() { /* ... */ }
        function toggleEditorFullScreen() { document.getElementById('editor-popup').classList.toggle('is-fullscreen'); }
    </script>
</body>
</html>
