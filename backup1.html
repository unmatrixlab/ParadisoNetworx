<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud Dashboard v3.2 (Dark V16)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        /* =========================================
           THEME V16 (Dark Aesthetic)
           ========================================= */
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            
            --bg-body: #111827;       /* Fondo oscuro profundo */
            --bg-panel: #1f2937;      /* Tarjetas */
            --bg-input: #111827;      /* Inputs */
            
            --border: #374151;        /* Bordes sutiles */
            
            --text-main: #f3f4f6;     /* Texto principal claro */
            --text-sec: #9ca3af;      /* Texto secundario gris */
            
            --radius: 16px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-body); 
            color: var(--text-main); 
            margin: 0; padding: 20px; 
            min-height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
        }
        
        .container { max-width: 600px; width: 100%; }
        
        /* HEADER */
        .header { margin-bottom: 25px; text-align: center; }
        .header h1 { 
            margin: 0; font-size: 24px; font-weight: 800; 
            background: linear-gradient(135deg, #fff, #9ca3af); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        /* STATUS BADGES */
        .status-badge { 
            display: inline-block; padding: 4px 12px; border-radius: 20px; 
            font-size: 11px; font-weight: 700; margin-top: 8px; 
            background: var(--bg-input); border: 1px solid var(--border);
            color: var(--text-sec); transition: 0.3s; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .status-badge.online { background: rgba(16, 185, 129, 0.1); color: var(--success); border-color: rgba(16, 185, 129, 0.3); }
        .status-badge.sync-needed { background: rgba(239, 68, 68, 0.1); color: var(--danger); border-color: rgba(239, 68, 68, 0.3); }
        .status-badge.synced { background: rgba(16, 185, 129, 0.1); color: var(--success); border-color: rgba(16, 185, 129, 0.3); }
        
        /* CARDS */
        .card { 
            background: var(--bg-panel); 
            border-radius: var(--radius); 
            overflow: hidden; 
            box-shadow: var(--shadow); 
            margin-bottom: 20px; 
            border: 1px solid var(--border); 
        }
        .card-header { 
            padding: 15px 20px; 
            border-bottom: 1px solid var(--border); 
            font-size: 12px; font-weight: 800; 
            text-transform: uppercase; color: var(--text-sec); 
            background: rgba(0,0,0,0.2); 
            display: flex; justify-content: space-between; align-items: center; letter-spacing: 1px;
        }
        
        /* DATA ROWS (Stats) */
        .data-row { 
            padding: 16px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid var(--border); 
            transition: background 0.2s;
        }
        .data-row:last-child { border-bottom: none; }
        .data-row:hover { background: rgba(255,255,255,0.02); }
        
        .data-label { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 12px; color: var(--text-main); }
        .data-value { color: var(--text-sec); font-size: 13px; font-family: monospace; font-weight: 600; }
        
        .app-icon { 
            width: 32px; height: 32px; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            color: white; font-weight: 800; font-size: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* BUTTONS */
        .btn { 
            width: 100%; padding: 14px; border-radius: 10px; border: none; 
            font-size: 14px; font-weight: 700; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 8px; 
            transition: all 0.2s; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        
        .btn-cloud-save { 
            background: linear-gradient(135deg, var(--primary), #8b5cf6); 
            color: white; 
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); 
        }
        .btn-cloud-save:hover { box-shadow: 0 6px 15px rgba(99, 102, 241, 0.4); }

        .btn-cloud-load { 
            background: rgba(239, 68, 68, 0.1); 
            color: var(--danger); 
            border: 1px solid rgba(239, 68, 68, 0.3); 
        }
        .btn-cloud-load:hover { background: rgba(239, 68, 68, 0.2); }

        .btn-cloud-mix { 
            background: rgba(16, 185, 129, 0.1); 
            color: var(--success); 
            border: 1px solid rgba(16, 185, 129, 0.3); 
        }
        .btn-cloud-mix:hover { background: rgba(16, 185, 129, 0.2); }

        .btn-file { 
            background: var(--bg-input); 
            color: var(--text-sec); 
            border: 1px solid var(--border); 
            font-size: 13px; font-weight: 600; 
            padding: 12px; margin-bottom: 0; border-radius: 8px; 
        }
        .btn-file:hover { border-color: var(--primary); color: var(--text-main); background: var(--bg-panel); }

        .file-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        
        /* CONTROLS & INPUTS */
        .backup-controls { 
            padding: 0 0 15px 0; display: flex; flex-direction: column; gap: 12px; 
        }
        .backup-input, .backup-select { 
            width: 100%; padding: 12px; border-radius: 8px; 
            border: 1px solid var(--border); background: var(--bg-input); 
            color: var(--text-main); font-size: 14px; font-family: 'Inter', sans-serif; 
            outline: none; transition: 0.2s;
        }
        .backup-input:focus, .backup-select:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }
        .backup-input::placeholder { color: #4b5563; }
        
        .select-group { display: flex; gap: 10px; }
        
        .btn-delete { 
            background: rgba(239, 68, 68, 0.1); color: var(--danger); 
            border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; 
            padding: 0 15px; cursor: pointer; font-size: 16px; 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-delete:hover { background: var(--danger); color: white; }

        /* SYNC INFO */
        .sync-info { 
            text-align: center; font-size: 13px; color: var(--warning); 
            margin: 15px 0 0 0; padding: 12px; 
            background: rgba(245, 158, 11, 0.1); 
            border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.2); 
            font-family: monospace;
        }
        
        /* LOADING */
        #loading-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(17, 24, 39, 0.9); z-index: 100; 
            display: none; align-items: center; justify-content: center; 
            flex-direction: column; backdrop-filter: blur(5px); 
        }
        .spinner { 
            width: 40px; height: 40px; 
            border: 4px solid var(--border); border-top: 4px solid var(--primary); 
            border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        input[type="file"] { display: none; }
        hr { border-color: var(--border); opacity: 0.5; }
        
        label { text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px; color: var(--primary); margin-bottom: 4px; display: block; font-weight: 700; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-msg" style="font-weight:600; color: white;">Processing...</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Sync Center v3.2</h1>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:5px;">
                <span id="connection-status" class="status-badge">Connecting...</span>
                <span id="sync-health" class="status-badge" style="display:none;">Checking...</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span>‚òÅÔ∏è CLOUD ACTIONS</span>
                <span style="font-size:10px; opacity:0.7;">SAFE MODE</span>
            </div>
            <div style="padding: 20px;">
                
                <div class="backup-controls">
                    <label>Create New / Overwrite</label>
                    <input type="text" id="backup-name" class="backup-input" placeholder="Type backup name...">
                    
                    <button class="btn btn-cloud-save" onclick="saveToCloud()">
                        ‚¨ÜÔ∏è SAVE TO CLOUD
                    </button>

                    <hr style="width:100%; border:0; border-top:1px solid var(--border); margin: 15px 0;">

                    <label>Manage Cloud Backups</label>
                    
                    <div class="select-group">
                        <select id="backup-select" class="backup-select">
                            <option value="" disabled selected>Loading backups...</option>
                        </select>
                        <button class="btn-delete" onclick="deleteBackup()" title="Delete Selected Backup">üóëÔ∏è</button>
                    </div>

                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <button class="btn btn-cloud-mix" onclick="mixFromCloud()" style="margin-bottom:0;">
                        üîÑ MERGE<br><span style="font-size:10px; font-weight:600; opacity:0.8;">(Selected)</span>
                    </button>
                    <button class="btn btn-cloud-load" onclick="loadFromCloud()" style="margin-bottom:0;">
                        ‚ö†Ô∏è REPLACE<br><span style="font-size:10px; font-weight:600; opacity:0.8;">(Selected)</span>
                    </button>
                </div>
                <div class="sync-info">
                    <div id="cloud-date">‚òÅÔ∏è Cloud: Select a backup</div>
                    <div id="local-date">üì± Local: Verifying...</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Local Statistics</div>
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #6366f1;">DB</div>Vocabulary</div>
                <div class="data-value" id="stat-vocab">...</div>
            </div>
            
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #10b981; color: #fff;">ED</div>Smart Editor</div>
                <div class="data-value" id="stat-editor">...</div>
            </div>

            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #ef4444;">PL</div>Total Videos</div>
                <div class="data-value" id="stat-player">...</div>
            </div>
            
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #a855f7;">üß©</div>Study Fragments</div>
                <div class="data-value" id="stat-fragments">...</div>
            </div>

            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #3b82f6;">AI</div>AI Exercises</div>
                <div class="data-value" id="stat-ai">...</div>
            </div>
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #fbbf24; color: #000;">GM</div>Arcade Game</div>
                <div class="data-value" id="stat-game">...</div>
            </div>
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #06b6d4; color: #000;">GEN</div>Creator Studio</div>
                <div class="data-value" id="stat-generator">...</div>
            </div>
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #8b5cf6; color: #fff;">PE</div>Prompt Eng.</div>
                <div class="data-value" id="stat-prompt">...</div>
            </div>
            <div class="data-row">
                <div class="data-label"><div class="app-icon" style="background: #4b5563; color: #fff;">NT</div>Video Notes</div>
                <div class="data-value" id="stat-notes">...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Physical Backup (.JSON)</div>
            <div class="file-actions">
                <button class="btn btn-file" onclick="backupToFile()">üíæ Save File</button>
                <button class="btn btn-file" onclick="document.getElementById('restore-input').click()">üìÇ Load File</button>
            </div>
            <input type="file" id="restore-input" accept=".json" onchange="restoreFromFile(this)">
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" style="background:var(--danger); color:white; border:none; width:100%; padding:14px; font-size:14px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);" onclick="wipeSystem()">
                ‚ò¢Ô∏è NUCLEAR WIPE (Erase All)
            </button>
        </div>
    </div>

   <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAxXKLpXk4sa3TVN2pCustVkpxV_uMZjr8",
            authDomain: "nexushub-6bfc4.firebaseapp.com",
            databaseURL: "https://nexushub-6bfc4-default-rtdb.firebaseio.com",
            projectId: "nexushub-6bfc4",
            storageBucket: "nexushub-6bfc4.firebasestorage.app",
            messagingSenderId: "426532214270",
            appId: "1:426532214270:web:6816040ca1aba8e8655caf",
            measurementId: "G-NZZ1PLEH0V"
        };

        let db;
        const PREFIXES = ['mdc_', 'LN_', 'nexus_'];
        
        const KEYS = { 
            vocab: 'mdc_vocab_list', 
            historyStudio: 'mdc_studio_history', 
            historyLite: 'mdc_simple_history',    
            ai: 'mdc_ai_exercises', 
            game: 'LN_V8_HYBRID', 
            generator: 'nexus_ai_decks',
            prompt: 'nexus_prompt_history',
            editor: 'mdc_smart_editor_v8_doc' // ADDED EDITOR KEY
        };

        function sanitizeName(name) {
            return name.replace(/[^a-zA-Z0-9_-]/g, '_');
        }

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            const connectedRef = firebase.database().ref(".info/connected");
            connectedRef.on("value", (snap) => {
                const badge = document.getElementById('connection-status');
                if (snap.val() === true) {
                    badge.innerText = "üü¢ Online"; badge.className = "status-badge online";
                    loadBackupList(); 
                } else {
                    badge.innerText = "‚ö™ Offline"; badge.className = "status-badge";
                }
            });
        } catch (e) { alert("Firebase Error: " + e.message); }

        document.addEventListener('DOMContentLoaded', () => {
            refreshStats();
            updateDateDisplay();
            
            document.getElementById('backup-select').addEventListener('change', (e) => {
                const selectedName = e.target.value;
                checkSelectedBackupStatus(selectedName);
                if(selectedName) {
                    document.getElementById('backup-name').value = selectedName;
                }
            });
        });

        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'THEME_CHANGE') {
                if (event.data.theme === 'dark') document.body.classList.add('dark-mode');
                else document.body.classList.remove('dark-mode');
            }
        });

        function loadBackupList() {
            const select = document.getElementById('backup-select');
            db.ref('backups').on('value', (snap) => {
                const currentVal = select.value;
                
                select.innerHTML = '<option value="" disabled selected>Select a Backup...</option>';
                const backups = snap.val();
                if(backups) {
                    Object.keys(backups).forEach(key => {
                        const opt = document.createElement('option');
                        opt.value = key;
                        const date = backups[key].meta ? backups[key].meta.date_str.split(',')[0] : '';
                        opt.innerText = `${key} (${date})`;
                        select.appendChild(opt);
                    });
                    if(backups[currentVal]) select.value = currentVal;
                } else {
                    select.innerHTML = '<option value="" disabled>No backups found</option>';
                }
            });
        }

        async function checkSelectedBackupStatus(backupName) {
            if(!backupName) return;
            try {
                const snap = await db.ref(`backups/${backupName}/meta`).once('value');
                const cloudMeta = snap.val();
                if(cloudMeta && cloudMeta.date_str) {
                    document.getElementById('cloud-date').innerText = "‚òÅÔ∏è Cloud (" + backupName + "): " + cloudMeta.date_str;
                }
            } catch(e) { console.log("Check failed"); }
        }

        function updateDateDisplay() {
            const localStr = localStorage.getItem('mdc_last_sync_date');
            document.getElementById('local-date').innerText = "üíæ Local: " + (localStr || "Never");
        }

        async function mixFromCloud() {
            const backupName = document.getElementById('backup-select').value;
            if(!backupName) return alert("‚ö†Ô∏è Please select a backup from the list first.");

            if(!db) return alert("No connection.");
            showLoading("Merging from " + backupName + "...");
            try {
                const snapshot = await db.ref(`backups/${backupName}`).once('value');
                const val = snapshot.val();
                if (!val || !val.data) throw new Error("Cloud is empty.");
                const cloudData = val.data;
                let changesCount = 0;

                const mergeList = (key) => {
                    if(cloudData[key]) {
                        const localList = JSON.parse(localStorage.getItem(key) || '[]');
                        const cloudList = typeof cloudData[key] === 'string' ? JSON.parse(cloudData[key]) : cloudData[key];
                        const existingIds = new Set(localList.map(item => item.id));
                        cloudList.forEach(item => {
                            if(!existingIds.has(item.id)) { localList.unshift(item); existingIds.add(item.id); changesCount++; }
                        });
                        localStorage.setItem(key, JSON.stringify(localList));
                    }
                };

                mergeList(KEYS.vocab);
                mergeList(KEYS.historyStudio); 
                mergeList(KEYS.historyLite);    
                mergeList(KEYS.generator);
                mergeList(KEYS.prompt);
                // Editor data (blocks) is usually a single object, hard to "merge" list-wise without ID conflicts.
                // For safety in MIX mode, we usually skip simple objects or handle them delicately.
                // For now, we leave the editor OUT of Mix to avoid overwriting current work, 
                // unless we implement a complex block merger. REPLACE is safer for the Editor.

                Object.keys(cloudData).forEach(key => {
                    if (key.startsWith('mdc_fragments_') || key.startsWith('mdc_notes_')) {
                        mergeList(key);
                    }
                });

                hideLoading();
                alert(`‚úÖ Merge complete from '${backupName}'.\n\nAdded ${changesCount} new items.`);
                window.location.reload();
            } catch (error) { hideLoading(); alert("‚ùå Error: " + error.message); }
        }

        async function deleteBackup() {
            const backupName = document.getElementById('backup-select').value;
            if(!backupName) return alert("‚ö†Ô∏è Please select a backup to delete first.");

            if(confirm(`üö® DELETE WARNING üö®\n\nAre you sure you want to PERMANENTLY delete the backup: '${backupName}'?\n\nThis cannot be undone.`)) {
                showLoading("Deleting " + backupName + "...");
                try {
                    await db.ref(`backups/${backupName}`).remove();
                    hideLoading();
                    alert("üóëÔ∏è Backup deleted successfully.");
                    if(document.getElementById('backup-name').value === backupName) {
                        document.getElementById('backup-name').value = '';
                    }
                } catch (e) {
                    hideLoading();
                    alert("‚ùå Error deleting: " + e.message);
                }
            }
        }

        async function saveToCloud() {
            let rawName = document.getElementById('backup-name').value.trim();
            if(!rawName) return alert("‚ö†Ô∏è Please name your backup (e.g. 'Philosophy', 'Tech').");
            
            const safeName = sanitizeName(rawName);

            showLoading(`Checking '${safeName}'...`);
            
            try {
                const snapshot = await db.ref(`backups/${safeName}`).once('value');
                const exists = snapshot.exists();

                if (exists) {
                    hideLoading();
                    if(!confirm(`‚ö†Ô∏è WARNING: Backup '${safeName}' ALREADY EXISTS.\n\nDo you want to OVERWRITE it with current local data?`)) {
                        return;
                    }
                    showLoading(`Overwriting '${safeName}'...`);
                } else {
                    showLoading(`Saving new backup '${safeName}'...`);
                }

                const payload = {};
                let count = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    // PREFIX CHECK includes 'mdc_', so editor data IS included automatically.
                    if (PREFIXES.some(p => key.startsWith(p))) {
                        payload[key] = localStorage.getItem(key);
                        count++;
                    }
                }
                if(count === 0) { hideLoading(); return alert("No local data."); }

                const now = Date.now();
                const dateStr = new Date().toLocaleString();
                await db.ref(`backups/${safeName}`).set({
                    data: payload,
                    meta: { timestamp: now, date_str: dateStr, device: navigator.userAgent }
                });
                
                localStorage.setItem('mdc_last_sync_date', dateStr);
                localStorage.setItem('mdc_last_sync_ts', now);
                updateDateDisplay(); 
                hideLoading();
                alert(`‚úÖ Saved successfully to '${safeName}'.`);

            } catch (error) { hideLoading(); alert("‚ùå Error: " + error.message); }
        }

        async function loadFromCloud() {
            const backupName = document.getElementById('backup-select').value;
            if(!backupName) return alert("‚ö†Ô∏è Please select a backup from the list first.");

            if(!confirm(`‚ö†Ô∏è REPLACE will delete everything local and load '${backupName}'. Are you sure?`)) return;
            showLoading("Downloading " + backupName + "...");
            try {
                const snapshot = await db.ref(`backups/${backupName}`).once('value');
                const val = snapshot.val();
                if (!val || !val.data) throw new Error("Cloud empty.");
                const cloudData = val.data;
                const cloudMeta = val.meta || {};
                
                localStorage.clear(); 

                Object.keys(cloudData).forEach(key => {
                    localStorage.setItem(key, cloudData[key]);
                });
                localStorage.setItem('mdc_last_sync_date', cloudMeta.date_str || new Date().toLocaleString());
                localStorage.setItem('mdc_last_sync_ts', cloudMeta.timestamp || Date.now());
                hideLoading();
                alert("‚úÖ Data replaced.");
                window.location.reload();
            } catch (error) { hideLoading(); alert("‚ùå Error: " + error.message); }
        }

        function backupToFile() {
            const backup = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (PREFIXES.some(p => key.startsWith(p))) backup[key] = localStorage.getItem(key);
            }
            const blob = new Blob([JSON.stringify(backup)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url;
            a.download = `MDC_Backup_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
        }

        function restoreFromFile(input) {
            const file = input.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    Object.keys(data).forEach(key => {
                        if (PREFIXES.some(p => key.startsWith(p))) localStorage.setItem(key, data[key]);
                    });
                    alert("‚úÖ Loaded."); window.location.reload();
                } catch (err) { alert("Invalid file."); }
            };
            reader.readAsText(file);
        }

        function showLoading(msg) { document.getElementById('loading-msg').innerText = msg; document.getElementById('loading-overlay').style.display = 'flex'; }
        function hideLoading() { document.getElementById('loading-overlay').style.display = 'none'; }
        
        function refreshStats() {
            const getLen = (k) => { 
                const s=localStorage.getItem(k); 
                try { return s ? JSON.parse(s).length : 0; } catch(e){ return 0; }
            };
            
            const gameData = localStorage.getItem(KEYS.game);
            let gameText = "No data";
            let gameActive = false;
            if(gameData) {
                try {
                    const g = JSON.parse(gameData);
                    const silver = g.coins ? g.coins.silver : 0;
                    const gold = g.coins ? g.coins.gold : 0;
                    gameText = `üí∞ ${gold} Gold | ${silver} Silver`;
                    gameActive = true;
                } catch(e) {}
            }

            // CHECK EDITOR DATA
            const editorData = localStorage.getItem(KEYS.editor);
            let editorText = "No Lesson";
            let editorActive = false;
            if (editorData) {
                try {
                    const parsed = JSON.parse(editorData);
                    const title = parsed.title || "Untitled";
                    const blocks = parsed.blocks ? parsed.blocks.length : 0;
                    editorText = `"${title}" (${blocks} blocks)`;
                    editorActive = true;
                } catch(e) {}
            }

            let notesCount = 0;
            let fragCount = 0;
            for(let i=0; i<localStorage.length; i++){
                const key = localStorage.key(i);
                if(key.startsWith('mdc_notes_')) notesCount++;
                if(key.startsWith('mdc_fragments_')) fragCount++;
            }

            const studioVideos = getLen(KEYS.historyStudio);
            const liteVideos = getLen(KEYS.historyLite);
            const totalVideos = studioVideos + liteVideos;

            updateRow('stat-vocab', getLen(KEYS.vocab) + " items", getLen(KEYS.vocab)>0);
            updateRow('stat-player', totalVideos + " videos", totalVideos>0);
            updateRow('stat-ai', getLen(KEYS.ai) + " sets", getLen(KEYS.ai)>0);
            updateRow('stat-game', gameText, gameActive); 
            updateRow('stat-generator', getLen(KEYS.generator) + " decks", getLen(KEYS.generator)>0);
            updateRow('stat-prompt', getLen(KEYS.prompt) + " prompts", getLen(KEYS.prompt)>0);
            updateRow('stat-notes', notesCount + " notes", notesCount > 0);
            updateRow('stat-fragments', fragCount + " videos", fragCount > 0);
            
            // EDITOR ROW UPDATE
            updateRow('stat-editor', editorText, editorActive);
        }

        function updateRow(id, text, active) {
            const el = document.getElementById(id);
            if(el) {
                el.innerText = text;
                el.style.color = active ? 'var(--text-main)' : 'var(--text-sec)';
                if(active) el.style.fontWeight = '700';
            }
        }

        function wipeSystem() {
            if(confirm("‚ö†Ô∏è ERASE ABSOLUTELY EVERYTHING?\n\nIrreversible action.")) {
                localStorage.clear();
                if (window.top) window.top.location.reload();
                else window.location.reload();
            }
        }
   </script>
</body>
</html>
