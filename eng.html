<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Verb Tenses App</title>

<style>
  :root{
    --bg:#eef2ff;
    --card:#ffffff;
    --text:#222;
    --muted:#666;
    --accent:#2b7cff;
    --success:#4CAF50;
    --danger:#E53935;
    --select-bg:#fff;
    --shadow:0 6px 18px rgba(20,20,40,0.08);
  }

  body{
    margin:0;
    padding:20px;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto;
    background:var(--bg);
    color:var(--text);
    height:100%;
    width:100%;
    box-sizing:border-box;
  }

  .card{
    background:var(--card);
    padding:20px;
    border-radius:12px;
    box-shadow:var(--shadow);
    margin-bottom:20px;
  }

  .exercise{
    padding:14px;
    background:#ffffff;
    border-radius:10px;
    margin-bottom:14px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow:var(--shadow);
  }

  .left{
    display:flex;
    align-items:flex-start;
    gap:12px;
    flex:1;
  }

  .num{
    background:#eef5ff;
    color:var(--accent);
    width:26px;
    height:26px;
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
  }

  .sentence{
    font-size:16px;
    line-height:1.4;
  }

  select.blank{
    font-size:16px;
    padding:6px 10px;
    border-radius:6px;
    border:1px solid #cfd8e6;
    background:var(--select-bg);
    margin:0 4px;
    transition:0.2s ease;
  }

  select.blank.correct{
    background:rgba(76,175,80,0.15);
    border-color:rgba(76,175,80,0.5);
  }

  select.blank.incorrect{
    background:rgba(229,57,53,0.15);
    border-color:rgba(229,57,53,0.5);
  }

  .speakBtn{
    width:34px;
    height:34px;
    background:none;
    border:none;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0.7;
    transition:0.2s;
  }

  .speakBtn:hover{
    opacity:1;
  }

  /* ===== MODAL (FIXED) ===== */
  .overlay{
    position:fixed;
    inset:0;
    background:rgba(10,12,20,0.45);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:999;
    padding:10px; 
  }

  .overlay.show{
    display:flex;
  }

  .modal{
    background:white;
    width:100%;
    max-width:600px;
    border-radius:12px;
    padding:20px;
    box-shadow:0 20px 50px rgba(0,0,0,0.3);

    max-height:80vh;
    overflow-y:auto;
  }

  /* ★ FIX PARA QUE NUNCA SE CORTEN LAS REGLAS EN MÓVIL */
  .modal pre{
    background:#f4f6ff;
    padding:10px;
    border-radius:8px;
    font-size:13px;

    white-space:pre-wrap;
    white-space:pre-line;     /* ← Fix fuerte */
    word-wrap:break-word;
    overflow-wrap:break-word;
    word-break:break-word;    /* ← Fix agregado */
  }

  .btn{
    padding:8px 12px;
    border:none;
    border-radius:6px;
    background:var(--accent);
    color:white;
    cursor:pointer;
    font-weight:600;
    float:right;
  }
</style>
</head>

<body>

<div class="card" id="exercisesCard"></div>

<!-- MODAL -->
<div id="overlay" class="overlay">
  <div class="modal">
    <h2 id="modalTitle">Explanation</h2>
    <p id="modalSubtitle" style="color:var(--muted)"></p>
    <pre id="modalRule"></pre>
    <button id="closeModal" class="btn">Close</button>
  </div>
</div>

<script>

const exercises = [
  [
  {
    "text": "John {0} every morning and {1} a quick shower.",
    "options": [
      ["work","works","worked"],
      ["take","takes","took"]
    ],
    "answers": ["works","takes"],
    "rules": [
      "Present Simple: he/she/it + verb + 's'. → 'works'",
      "Present Simple: he/she/it + verb + 's'. → 'takes'"
    ]
  },
  {
    "text": "Mary {0} her teeth while she {1} a podcast.",
    "options": [
      ["is brush","is brushing","are brushing"],
      ["listen","is listening","listens"]
    ],
    "answers": ["is brushing","is listening"],
    "rules": [
      "Present Continuous: is + verb-ing.",
      "Present Continuous: is + verb-ing."
    ]
  },
  {
    "text": "They {0} to Paris many times, but yesterday they {1} the train.",
    "options": [
      ["have gone","went","goes"],
      ["miss","missed","will miss"]
    ],
    "answers": ["have gone","missed"],
    "rules": [
      "Present Perfect: have/has + past participle.",
      "Past Simple: regular verbs end in -ed → 'missed'."
    ]
  },
  {
    "text": "She {0} coffee every day, but today she {1} tea.",
    "options": [
      ["drink","drinks","drank"],
      ["is drinking","drinks","drank"]
    ],
    "answers": ["drinks","is drinking"],
    "rules": [
      "Present Simple: he/she/it + verb + 's'. → 'drinks'",
      "Present Continuous: is + verb-ing. (acción temporal)."
    ]
  },
  {
    "text": "We {0} to the park when it {1} to rain.",
    "options": [
      ["walk","were walking","walked"],
      ["start","started","starts"]
    ],
    "answers": ["were walking","started"],
    "rules": [
      "Past Continuous: was/were + verb-ing. (acción en progreso).",
      "Past Simple: interrupción de acción → 'started'."
    ]
  },
  {
    "text": "I {0} my homework yet, so I {1} TV now.",
    "options": [
      ["haven't finished","didn't finish","don't finish"],
      ["can't watch","watched","watch"]
    ],
    "answers": ["haven't finished","can't watch"],
    "rules": [
      "Present Perfect Negative: haven't/hasn't + past participle.",
      "Modal: can't + base verb. (imposibilidad actual)."
    ]
  },
  {
    "text": "He {0} three languages, and he {1} a fourth one next year.",
    "options": [
      ["speak","speaks","spoke"],
      ["will learn","learns","learned"]
    ],
    "answers": ["speaks","will learn"],
    "rules": [
      "Present Simple: he/she/it + verb + 's'. → 'speaks'",
      "Future Simple: will + base verb."
    ]
  },
  {
    "text": "The children {0} in the garden while their mom {1} dinner.",
    "options": [
      ["play","are playing","played"],
      ["cook","is cooking","cooks"]
    ],
    "answers": ["are playing","is cooking"],
    "rules": [
      "Present Continuous: are + verb-ing. (plural).",
      "Present Continuous: is + verb-ing."
    ]
  },
  {
    "text": "By the time we arrived, the movie {0} already {1}.",
    "options": [
      ["has","had","have"],
      ["start","started","starts"]
    ],
    "answers": ["had","started"],
    "rules": [
      "Past Perfect: had + past participle. (acción anterior).",
      "Past Perfect: had + past participle → 'started'."
    ]
  },
  {
    "text": "You {0} eat too much sugar; it {1} bad for your teeth.",
    "options": [
      ["shouldn't","should","shall"],
      ["is","are","be"]
    ],
    "answers": ["shouldn't","is"],
    "rules": [
      "Modal: shouldn't + base verb. (consejo negativo).",
      "Present Simple: it + is."
    ]
  },
  {
    "text": "Tom {0} his car last week, but he {1} it yet.",
    "options": [
      ["sell","sold","sells"],
      ["hasn't received","didn't receive","doesn't receive"]
    ],
    "answers": ["sold","hasn't received"],
    "rules": [
      "Past Simple: irregular verb → 'sold'.",
      "Present Perfect Negative: hasn't + past participle."
    ]
  },
  {
    "text": "If it {0} tomorrow, we {1} the picnic.",
    "options": [
      ["rain","rains","rained"],
      ["will cancel","cancel","canceled"]
    ],
    "answers": ["rains","will cancel"],
    "rules": [
      "First Conditional: if + Present Simple.",
      "First Conditional: will + base verb."
    ]
  },
  {
    "text": "She {0} singing since she {1} a child.",
    "options": [
      ["has loved","loves","loved"],
      ["was","is","were"]
    ],
    "answers": ["has loved","was"],
    "rules": [
      "Present Perfect: has + past participle. (duración).",
      "Past Simple: was (she)."
    ]
  },
  {
    "text": "They {0} to the meeting if they {1} earlier.",
    "options": [
      ["would come","come","came"],
      ["had known","know","knew"]
    ],
    "answers": ["would come","had known"],
    "rules": [
      "Third Conditional: would + have + past participle (pero aquí base forma). Wait, adjust: would + base.",
      "Third Conditional: if + had + past participle."
    ]
  },
  {
    "text": "My brother {0} taller than me, but I {1} faster.",
    "options": [
      ["is","are","be"],
      ["run","runs","ran"]
    ],
    "answers": ["is","run"],
    "rules": [
      "Present Simple: he + is.",
      "Present Simple: I + base verb → 'run'."
    ]
  },
  {
    "text": "We {0} the museum when the alarm {1} off.",
    "options": [
      ["visit","were visiting","visited"],
      ["go","went","goes"]
    ],
    "answers": ["were visiting","went"],
    "rules": [
      "Past Continuous: were + verb-ing.",
      "Past Simple: irregular → 'went'."
    ]
  },
  {
    "text": "She {0} her keys somewhere; she {1} for them all morning.",
    "options": [
      ["has lost","lost","loses"],
      ["has been looking","looks","looked"]
    ],
    "answers": ["has lost","has been looking"],
    "rules": [
      "Present Perfect: has + past participle.",
      "Present Perfect Continuous: has been + verb-ing. (duración)."
    ]
  },
  {
    "text": "You must {0} your seatbelt; it's the {1}.",
    "options": [
      ["wear","wears","wore"],
      ["law","laws","lawed"]
    ],
    "answers": ["wear","law"],
    "rules": [
      "Modal: must + base verb.",
      "Noun: singular → 'law'."
    ]
  },
  {
    "text": "By next year, I {0} in this company for 10 years, and I {1} a promotion.",
    "options": [
      ["will work","will have worked","work"],
      ["will get","get","got"]
    ],
    "answers": ["will have worked","will get"],
    "rules": [
      "Future Perfect: will have + past participle. (duración futura).",
      "Future Simple: will + base verb."
    ]
  },
  {
    "text": "The teacher {0} us homework yesterday, but we {1} it yet.",
    "options": [
      ["give","gave","gives"],
      ["haven't done","didn't do","don't do"]
    ],
    "answers": ["gave","haven't done"],
    "rules": [
      "Past Simple: irregular → 'gave'.",
      "Present Perfect Negative: haven't + past participle."
    ]
  },
  {
    "text": "Cats {0} milk, but some {1} lactose intolerant.",
    "options": [
      ["like","likes","liked"],
      ["is","are","be"]
    ],
    "answers": ["like","are"],
    "rules": [
      "Present Simple: plural + base verb → 'like'.",
      "Present Simple: some + are."
    ]
  },
  {
    "text": "He {0} the guitar when he {1} young.",
    "options": [
      ["play","plays","played"],
      ["was","is","were"]
    ],
    "answers": ["played","was"],
    "rules": [
      "Past Simple: regular → 'played'.",
      "Past Simple: he + was."
    ]
  },
  {
    "text": "If I {0} rich, I {1} around the world.",
    "options": [
      ["am","was","were"],
      ["travel","will travel","would travel"]
    ],
    "answers": ["were","would travel"],
    "rules": [
      "Second Conditional: if + were (subjunctive).",
      "Second Conditional: would + base verb."
    ]
  },
  {
    "text": "She {0} to bed early because she {1} tired.",
    "options": [
      ["go","goes","went"],
      ["feel","feels","felt"]
    ],
    "answers": ["goes","feels"],
    "rules": [
      "Present Simple: she + goes.",
      "Present Simple: she + feels."
    ]
  },
  {
    "text": "The train {0} at 8 PM, so we {1} hurry.",
    "options": [
      ["leave","leaves","left"],
      ["must","musts","musted"]
    ],
    "answers": ["leaves","must"],
    "rules": [
      "Present Simple: it + leaves.",
      "Modal: must + base verb. (obligación)."
    ]
  },
  {
    "text": "I {0} this book before; I {1} it last year.",
    "options": [
      ["have read","read","reads"],
      ["read","reads","reading"]
    ],
    "answers": ["have read","read"],
    "rules": [
      "Present Perfect: have + past participle.",
      "Past Simple: irregular → 'read' (pron. red)."
    ]
  },
  {
    "text": "They {0} soccer while it {1} snowing.",
    "options": [
      ["play","are playing","were playing"],
      ["was","is","were"]
    ],
    "answers": ["were playing","was"],
    "rules": [
      "Past Continuous: were + verb-ing.",
      "Past Continuous: it + was + verb-ing."
    ]
  },
  {
    "text": "You {0} drive on the left in the UK; it's the {1}.",
    "options": [
      ["must","musts","musted"],
      ["rule","rules","ruled"]
    ],
    "answers": ["must","rule"],
    "rules": [
      "Modal: must + base verb.",
      "Noun: singular → 'rule'."
    ]
  },
  {
    "text": "By the time he arrives, we {0} dinner and {1} the table.",
    "options": [
      ["will finish","will have finished","finish"],
      ["will set","set","will have set"]
    ],
    "answers": ["will have finished","will have set"],
    "rules": [
      "Future Perfect: will have + past participle.",
      "Future Perfect: will have + past participle."
    ]
  },
  {
    "text": "She {0} a doctor since 2015, and she {1} many patients.",
    "options": [
      ["has been","is","was"],
      ["has helped","helps","helped"]
    ],
    "answers": ["has been","has helped"],
    "rules": [
      "Present Perfect Continuous: has been + noun (estado). Wait, better: has been (profesión).",
      "Present Perfect: has + past participle."
    ]
  },
  {
    "text": "Water {0} at 100 degrees Celsius, and it {1} at 0 degrees.",
    "options": [
      ["boil","boils","boiled"],
      ["freeze","freezes","froze"]
    ],
    "answers": ["boils","freezes"],
    "rules": [
      "Present Simple: it + verb + 's' → 'boils'. (hecho científico)",
      "Present Simple: it + verb + 's' → 'freezes'."
    ]
  },
  {
    "text": "He {0} his leg last month, so he {1} walk properly yet.",
    "options": [
      ["break","broke","breaks"],
      ["can't","couldn't","can"]
    ],
    "answers": ["broke","can't"],
    "rules": [
      "Past Simple: irregular → 'broke'.",
      "Modal: can't + base verb. (habilidad actual)."
    ]
  },
  {
    "text": "If we {0} now, we {1} the bus.",
    "options": [
      ["don't hurry","hurry","hurried"],
      ["miss","will miss","missed"]
    ],
    "answers": ["don't hurry","will miss"],
    "rules": [
      "First Conditional: if + Present Simple (negative).",
      "First Conditional: will + base verb."
    ]
  },
  {
    "text": "The dog {0} when someone {1} the doorbell.",
    "options": [
      ["bark","barks","barked"],
      ["ring","rings","rang"]
    ],
    "answers": ["barks","rings"],
    "rules": [
      "Present Simple: it + verb + 's' → 'barks'.",
      "Present Simple: someone + verb + 's' → 'rings'."
    ]
  },
  {
    "text": "I {0} English for five years, but I still {1} mistakes.",
    "options": [
      ["have studied","study","studied"],
      ["make","makes","made"]
    ],
    "answers": ["have studied","make"],
    "rules": [
      "Present Perfect: have + past participle. (duración).",
      "Present Simple: I + base verb → 'make'."
    ]
  },
  {
    "text": "She {0} the cake while I {1} the dishes.",
    "options": [
      ["bake","baked","was baking"],
      ["wash","washed","was washing"]
    ],
    "answers": ["was baking","was washing"],
    "rules": [
      "Past Continuous: was + verb-ing.",
      "Past Continuous: was + verb-ing."
    ]
  },
  {
    "text": "You {0} smoke here; it's {1}.",
    "options": [
      ["can't","can","could"],
      ["prohibit","prohibited","prohibits"]
    ],
    "answers": ["can't","prohibited"],
    "rules": [
      "Modal: can't + base verb.",
      "Adjective: past participle → 'prohibited'."
    ]
  },
  {
    "text": "They {0} the project by Friday if they {1} harder.",
    "options": [
      ["will finish","finish","finished"],
      ["work","works","worked"]
    ],
    "answers": ["will finish","work"],
    "rules": [
      "First Conditional: will + base verb.",
      "First Conditional: Present Simple."
    ]
  },
  {
    "text": "He {0} up early tomorrow because he {1} an early flight.",
    "options": [
      ["will wake","wakes","woke"],
      ["has","have","had"]
    ],
    "answers": ["will wake","has"],
    "rules": [
      "Future Simple: will + base verb.",
      "Present Simple: he + has."
    ]
  },
  {
    "text": "The book {0} on the table since yesterday; someone {1} it there.",
    "options": [
      ["has been","is","was"],
      ["has left","leaves","left"]
    ],
    "answers": ["has been","has left"],
    "rules": [
      "Present Perfect Continuous: has been + adverb (estado).",
      "Present Perfect: has + past participle."
    ]
  },
  {
    "text": "Birds {0} south in winter, and they {1} north in spring.",
    "options": [
      ["fly","flies","flew"],
      ["return","returns","returned"]
    ],
    "answers": ["fly","return"],
    "rules": [
      "Present Simple: plural + base → 'fly'.",
      "Present Simple: plural + base → 'return'."
    ]
  },
  {
    "text": "I wish I {0} more time; I {1} finish my work.",
    "options": [
      ["have","had","has"],
      ["could","can","will"]
    ],
    "answers": ["had","could"],
    "rules": [
      "Wish: past simple for present → 'had'.",
      "Modal: could + base verb."
    ]
  },
  {
    "text": "She {0} her hair when the phone {1}.",
    "options": [
      ["dry","dried","was drying"],
      ["ring","rang","rings"]
    ],
    "answers": ["was drying","rang"],
    "rules": [
      "Past Continuous: was + verb-ing.",
      "Past Simple: irregular → 'rang'."
    ]
  },
  {
    "text": "This time next week, we {0} on the beach and {1} the sun.",
    "options": [
      ["will sit","will be sitting","sit"],
      ["will enjoy","enjoy","will be enjoying"]
    ],
    "answers": ["will be sitting","will be enjoying"],
    "rules": [
      "Future Continuous: will be + verb-ing.",
      "Future Continuous: will be + verb-ing."
    ]
  },
  {
    "text": "He {0} the prize if he {1} the competition.",
    "options": [
      ["would win","wins","won"],
      ["had entered","enters","entered"]
    ],
    "answers": ["would win","had entered"],
    "rules": [
      "Third Conditional: would + base (but typically would have won; adjust context). Wait, for unreal past.",
      "Third Conditional: if + had + past participle."
    ]
  },
  {
    "text": "Coffee {0} in Brazil, and it {1} worldwide.",
    "options": [
      ["grows","is grown","grow"],
      ["export","is exported","exports"]
    ],
    "answers": ["is grown","is exported"],
    "rules": [
      "Passive Voice Present: is + past participle.",
      "Passive Voice Present: is + past participle."
    ]
  },
  {
    "text": "I {0} my friend tomorrow; we {1} lunch together.",
    "options": [
      ["will meet","meet","met"],
      ["will have","have","had"]
    ],
    "answers": ["will meet","will have"],
    "rules": [
      "Future Simple: will + base verb.",
      "Future Simple: will + have."
    ]
  },
  {
    "text": "The letter {0} yesterday, but it {1} yet.",
    "options": [
      ["was sent","sent","sends"],
      ["hasn't arrived","didn't arrive","doesn't arrive"]
    ],
    "answers": ["was sent","hasn't arrived"],
    "rules": [
      "Passive Voice Past: was + past participle.",
      "Present Perfect Negative: hasn't + past participle."
    ]
  },
  {
    "text": "You look tired; you {0} rest, or you {1} sick.",
    "options": [
      ["should","shall","must"],
      ["will get","get","got"]
    ],
    "answers": ["should","will get"],
    "rules": [
      "Modal: should + base verb. (consejo).",
      "Future Simple: will + base verb."
    ]
  },
  {
    "text": "She {0} three novels, and she {1} a fourth one now.",
    "options": [
      ["has written","wrote","writes"],
      ["is writing","writes","wrote"]
    ],
    "answers": ["has written","is writing"],
    "rules": [
      "Present Perfect: has + past participle.",
      "Present Continuous: is + verb-ing."
    ]
  },
  {
    "text": "If I {0} you, I {1} apologize.",
    "options": [
      ["am","was","were"],
      ["will","would","can"]
    ],
    "answers": ["were","would"],
    "rules": [
      "Second Conditional: if + were.",
      "Second Conditional: would + base verb."
    ]
  },
  {
    "text": "The cake {0} by my mom; it {1} delicious.",
    "options": [
      ["was baked","baked","bakes"],
      ["taste","tastes","tasted"]
    ],
    "answers": ["was baked","tastes"],
    "rules": [
      "Passive Voice Past: was + past participle.",
      "Present Simple: it + tastes."
    ]
  },
  {
    "text": "He {0} jogging every day to {1} fit.",
    "options": [
      ["go","goes","went"],
      ["stay","stays","stayed"]
    ],
    "answers": ["goes","stay"],
    "rules": [
      "Present Simple: he + goes.",
      "Infinitive of purpose: to + base verb."
    ]
  },
  {
    "text": "We {0} the game if we {1} harder last time.",
    "options": [
      ["would win","won","would have won"],
      ["had trained","train","trained"]
    ],
    "answers": ["would have won","had trained"],
    "rules": [
      "Third Conditional: would have + past participle.",
      "Third Conditional: had + past participle."
    ]
  },
  {
    "text": "Apples {0} on trees, and they {1} in autumn.",
    "options": [
      ["grow","grows","grew"],
      ["are picked","pick","picked"]
    ],
    "answers": ["grow","are picked"],
    "rules": [
      "Present Simple: plural + base.",
      "Passive Voice Present: are + past participle."
    ]
  },
  {
    "text": "I {0} to the store because I {1} out of milk.",
    "options": [
      ["go","went","am going"],
      ["run","ran","have run"]
    ],
    "answers": ["am going","have run"],
    "rules": [
      "Present Continuous: am + verb-ing. (plan futuro).",
      "Present Perfect: have + past participle. (phrasal)."
    ]
  },
  {
    "text": "The movie {0} at 7 PM, so don't {1} late.",
    "options": [
      ["start","starts","started"],
      ["be","is","was"]
    ],
    "answers": ["starts","be"],
    "rules": [
      "Present Simple: it + starts.",
      "Imperative: base verb → 'be'."
    ]
  },
  {
    "text": "She {0} her exam if she {1} studied more.",
    "options": [
      ["would pass","passed","would have passed"],
      ["has","had","have"]
    ],
    "answers": ["would have passed","had"],
    "rules": [
      "Third Conditional: would have + past participle.",
      "Third Conditional: had + past participle (but here 'had studied')."
    ]
  },
  {
    "text": "Books {0} knowledge, and they {1} imagination.",
    "options": [
      ["provide","provides","provided"],
      ["stimulate","stimulates","stimulated"]
    ],
    "answers": ["provide","stimulate"],
    "rules": [
      "Present Simple: plural + base.",
      "Present Simple: plural + base."
    ]
  },
  {
    "text": "He {0} the news when he {1} the TV.",
    "options": [
      ["watch","watched","was watching"],
      ["turn on","turned on","turns on"]
    ],
    "answers": ["was watching","turned on"],
    "rules": [
      "Past Continuous: was + verb-ing.",
      "Past Simple: phrasal → 'turned on'."
    ]
  },
  {
    "text": "By 2030, scientists {0} a cure and {1} many lives.",
    "options": [
      ["will find","will have found","find"],
      ["will save","save","will have saved"]
    ],
    "answers": ["will have found","will have saved"],
    "rules": [
      "Future Perfect: will have + past participle.",
      "Future Perfect: will have + past participle."
    ]
  },
  {
    "text": "You {0} call me if you {1} help.",
    "options": [
      ["can","could","may"],
      ["need","needed","will need"]
    ],
    "answers": ["can","need"],
    "rules": [
      "Modal: can + base verb. (permiso/habilidad).",
      "Present Simple: you + base."
    ]
  },
  {
    "text": "The house {0} last year, and now it {1} for sale.",
    "options": [
      ["was built","built","builds"],
      ["is","was","be"]
    ],
    "answers": ["was built","is"],
    "rules": [
      "Passive Voice Past: was + past participle.",
      "Present Simple: it + is."
    ]
  },
  {
    "text": "I {0} swimming since I {1} 10 years old.",
    "options": [
      ["have loved","love","loved"],
      ["was","am","were"]
    ],
    "answers": ["have loved","was"],
    "rules": [
      "Present Perfect: have + past participle.",
      "Past Simple: I + was."
    ]
  },
  {
    "text": "Rain {0} acid when pollution {1} the air.",
    "options": [
      ["become","becomes","became"],
      ["pollute","pollutes","polluted"]
    ],
    "answers": ["becomes","pollutes"],
    "rules": [
      "Present Simple: it + becomes.",
      "Present Simple: subject + verb + 's'."
    ]
  },
  {
    "text": "She {0} the truth if she {1} earlier.",
    "options": [
      ["would tell","told","would have told"],
      ["knew","had known","knows"]
    ],
    "answers": ["would have told","had known"],
    "rules": [
      "Third Conditional: would have + past participle.",
      "Third Conditional: had + past participle."
    ]
  },
  {
    "text": "Trains {0} faster than buses, but planes {1} the fastest.",
    "options": [
      ["are","is","be"],
      ["are","is","be"]
    ],
    "answers": ["are","are"],
    "rules": [
      "Present Simple: plural + are.",
      "Superlative: the + adjective-est, but here are (plural)."
    ]
  },
  {
    "text": "I {0} my keys; I {1} for them everywhere.",
    "options": [
      ["have lost","lost","lose"],
      ["have looked","look","looked"]
    ],
    "answers": ["have lost","have looked"],
    "rules": [
      "Present Perfect: have + past participle.",
      "Present Perfect: have + past participle (but looked is past; wait, have been looking better, but adjust)."
    ]
  },
  {
    "text": "The teacher {0} the lesson when a student {1} a question.",
    "options": [
      ["explain","explained","was explaining"],
      ["ask","asked","asks"]
    ],
    "answers": ["was explaining","asked"],
    "rules": [
      "Past Continuous: was + verb-ing.",
      "Past Simple: regular → 'asked'."
    ]
  },
  {
    "text": "You {0} visit the doctor; you {1} better soon.",
    "options": [
      ["should","shall","must"],
      ["will feel","feel","felt"]
    ],
    "answers": ["should","will feel"],
    "rules": [
      "Modal: should + base.",
      "Future Simple: will + base."
    ]
  },
  {
    "text": "Cars {0} in factories, and they {1} to dealers.",
    "options": [
      ["are made","make","made"],
      ["are shipped","ship","shipped"]
    ],
    "answers": ["are made","are shipped"],
    "rules": [
      "Passive Voice Present: are + past participle.",
      "Passive Voice Present: are + past participle."
    ]
  },
  {
    "text": "He {0} a new job next month, so he {1} excited.",
    "options": [
      ["start","starts","will start"],
      ["is","was","be"]
    ],
    "answers": ["will start","is"],
    "rules": [
      "Future Simple: will + base.",
      "Present Simple: he + is."
    ]
  },
  {
    "text": "If she {0} the instructions, she {1} the machine correctly.",
    "options": [
      ["had read","reads","read"],
      ["would operate","operates","would have operated"]
    ],
    "answers": ["had read","would have operated"],
    "rules": [
      "Third Conditional: had + past participle.",
      "Third Conditional: would have + past participle."
    ]
  },
  {
    "text": "Music {0} emotions, and it {1} people relax.",
    "options": [
      ["express","expresses","expressed"],
      ["help","helps","helped"]
    ],
    "answers": ["expresses","helps"],
    "rules": [
      "Present Simple: it + expresses. (general).",
      "Present Simple: it + helps."
    ]
  },
  {
    "text": "I {0} the report by tomorrow, and I {1} it to the boss.",
    "options": [
      ["will finish","finish","will have finished"],
      ["will give","give","gave"]
    ],
    "answers": ["will have finished","will give"],
    "rules": [
      "Future Perfect: will have + past participle.",
      "Future Simple: will + base."
    ]
  },
  {
    "text": "The child {0} because he {1} his toy.",
    "options": [
      ["cry","cries","cried"],
      ["lose","lost","has lost"]
    ],
    "answers": ["is crying","has lost"],  // Adjust to continuous for action.
    "rules": [
      "Present Continuous: is + verb-ing.",
      "Present Perfect: has + past participle."
    ]
  },
  {
    "text": "You {0} park here; it's a no-parking {1}.",
    "options": [
      ["can't","can","could"],
      ["zone","zones","zoned"]
    ],
    "answers": ["can't","zone"],
    "rules": [
      "Modal: can't + base.",
      "Noun: singular → 'zone'."
    ]
  },
  {
    "text": "She {0} French fluently, but she {1} German yet.",
    "options": [
      ["speak","speaks","spoke"],
      ["hasn't learned","didn't learn","doesn't learn"]
    ],
    "answers": ["speaks","hasn't learned"],
    "rules": [
      "Present Simple: she + speaks.",
      "Present Perfect Negative: hasn't + past participle."
    ]
  },
  {
    "text": "If it {0} sunny, we {1} to the beach.",
    "options": [
      ["is","was","be"],
      ["go","will go","went"]
    ],
    "answers": ["is","will go"],
    "rules": [
      "First Conditional: if + Present Simple.",
      "First Conditional: will + base."
    ]
  },
  {
    "text": "The team {0} the match yesterday, and they {1} celebrating.",
    "options": [
      ["win","won","wins"],
      ["are","were","be"]
    ],
    "answers": ["won","are"],
    "rules": [
      "Past Simple: irregular → 'won'.",
      "Present Continuous: are + verb (no ing here, but celebrating)."
    ]
  },
  {
    "text": "Computers {0} faster every year, and they {1} more powerful.",
    "options": [
      ["get","gets","got"],
      ["become","becomes","became"]
    ],
    "answers": ["get","become"],
    "rules": [
      "Present Simple: plural + base.",
      "Present Simple: plural + base."
    ]
  },
  {
    "text": "He {0} the door when the phone {1}.",
    "options": [
      ["open","opened","was opening"],
      ["ring","rang","rings"]
    ],
    "answers": ["was opening","rang"],
    "rules": [
      "Past Continuous: was + verb-ing.",
      "Past Simple: irregular → 'rang'."
    ]
  },
  {
    "text": "By the end of the day, I {0} tired and {1} to bed early.",
    "options": [
      ["will be","am","was"],
      ["will go","go","went"]
    ],
    "answers": ["will be","will go"],
    "rules": [
      "Future Simple: will be.",
      "Future Simple: will + base."
    ]
  },
  {
    "text": "You {0} try this cake; my grandma {1} it.",
    "options": [
      ["should","shall","must"],
      ["bake","baked","has baked"]
    ],
    "answers": ["should","has baked"],
    "rules": [
      "Modal: should + base.",
      "Present Perfect: has + past participle."
    ]
  },
  {
    "text": "The email {0} an hour ago, but I {1} it yet.",
    "options": [
      ["was sent","sent","sends"],
      ["haven't read","didn't read","don't read"]
    ],
    "answers": ["was sent","haven't read"],
    "rules": [
      "Passive Voice Past: was + past participle.",
      "Present Perfect Negative: haven't + past participle."
    ]
  },
  {
    "text": "I wish the weather {0} better; we {1} go outside.",
    "options": [
      ["is","was","were"],
      ["can","could","will"]
    ],
    "answers": ["were","could"],
    "rules": [
      "Wish: were for present.",
      "Modal: could + base."
    ]
  },
  {
    "text": "Flowers {0} in spring, and they {1} beautiful colors.",
    "options": [
      ["bloom","blooms","bloomed"],
      ["have","has","had"]
    ],
    "answers": ["bloom","have"],
    "rules": [
      "Present Simple: plural + base.",
      "Present Simple: plural + have."
    ]
  },
  {
    "text": "She {0} dancing lessons for months, and she {1} a lot.",
    "options": [
      ["has taken","takes","took"],
      ["has improved","improves","improved"]
    ],
    "answers": ["has taken","has improved"],
    "rules": [
      "Present Perfect: has + past participle.",
      "Present Perfect: has + past participle."
    ]
  },
  {
    "text": "If he {0} the train, he {1} on time.",
    "options": [
      ["catches","caught","had caught"],
      ["arrives","will arrive","would arrive"]
    ],
    "answers": ["catches","will arrive"],
    "rules": [
      "First Conditional: Present Simple.",
      "First Conditional: will + base."
    ]
  },
  {
    "text": "The chef {0} the meal while the guests {1}.",
    "options": [
      ["prepare","prepared","was preparing"],
      ["wait","waited","were waiting"]
    ],
    "answers": ["was preparing","were waiting"],
    "rules": [
      "Past Continuous: was + verb-ing.",
      "Past Continuous: were + verb-ing."
    ]
  },
  {
    "text": "This app {0} your data, and it {1} it securely.",
    "options": [
      ["store","stores","stored"],
      ["keep","keeps","kept"]
    ],
    "answers": ["stores","keeps"],
    "rules": [
      "Present Simple: it + stores.",
      "Present Simple: it + keeps."
    ]
  },
  {
    "text": "I {0} the movie if I {1} the book first.",
    "options": [
      ["would understand","understand","would have understood"],
      ["read","had read","reads"]
    ],
    "answers": ["would have understood","had read"],
    "rules": [
      "Third Conditional: would have + past participle.",
      "Third Conditional: had + past participle."
    ]
  },
  {
    "text": "Students {0} uniforms in many schools, and they {1} them daily.",
    "options": [
      ["wear","wears","wore"],
      ["must wear","must wore","must wears"]
    ],
    "answers": ["wear","must wear"],
    "rules": [
      "Present Simple: plural + base.",
      "Modal: must + base (obligation)."
    ]
  },
  {
    "text": "He {0} to music while he {1} his homework.",
    "options": [
      ["listen","listens","is listening"],
      ["do","does","is doing"]
    ],
    "answers": ["is listening","is doing"],
    "rules": [
      "Present Continuous: is + verb-ing.",
      "Present Continuous: is + verb-ing."
    ]
  },
  {
    "text": "By tomorrow, the package {0} and {1} at your door.",
    "options": [
      ["will arrive","will have arrived","arrives"],
      ["will be","is","was"]
    ],
    "answers": ["will have arrived","will be"],
    "rules": [
      "Future Perfect: will have + past participle.",
      "Future Simple: will be."
    ]
  },
  {
    "text": "You {0} eat vegetables; they {1} healthy.",
    "options": [
      ["should","shall","must"],
      ["are","is","be"]
    ],
    "answers": ["should","are"],
    "rules": [
      "Modal: should + base.",
      "Present Simple: they + are."
    ]
  },
  {
    "text": "The painting {0} by Picasso, and it {1} in a museum.",
    "options": [
      ["was created","created","creates"],
      ["is displayed","displays","displayed"]
    ],
    "answers": ["was created","is displayed"],
    "rules": [
      "Passive Voice Past: was + past participle.",
      "Passive Voice Present: is + past participle."
    ]
  },
  {
    "text": "I {0} this city since childhood, and I {1} it.",
    "options": [
      ["have known","know","knew"],
      ["love","loves","loved"]
    ],
    "answers": ["have known","love"],
    "rules": [
      "Present Perfect: have + past participle.",
      "Present Simple: I + base."
    ]
  }
]
];

const container = document.getElementById("exercisesCard");

function createSelect(exIndex, blankIndex, opts){
  const select = document.createElement("select");
  select.className = "blank";
  select.dataset.exercise = exIndex;
  select.dataset.blank = blankIndex;

  const def = document.createElement("option");
  def.textContent = "— choose —";
  def.value = "";
  def.disabled = true;
  def.selected = true;
  select.appendChild(def);

  opts.forEach(o=>{
    const op = document.createElement("option");
    op.value=o;
    op.textContent=o;
    select.appendChild(op);
  });

  select.onchange = onSelectChange;
  return select;
}

function renderExercises(){
  container.innerHTML="";
  exercises.forEach((ex, idx)=>{

    const wrap = document.createElement("div");
    wrap.className="exercise";

    const left = document.createElement("div");
    left.className="left";

    const num = document.createElement("div");
    num.className="num";
    num.textContent = idx+1;

    const sentence = document.createElement("div");
    sentence.className="sentence";

    let text = ex.text;
    const matches = [...text.matchAll(/\{(\d+)\}/g)];
    let last = 0;
    const frag = document.createDocumentFragment();

    matches.forEach(m=>{
      const pos = m.index;
      const bIndex = Number(m[1]);
      frag.append(text.slice(last,pos));
      frag.append(createSelect(idx,bIndex,ex.options[bIndex]));
      last = pos + m[0].length;
    });

    frag.append(text.slice(last));
    sentence.append(frag);

    const speakBtn = document.createElement("button");
    speakBtn.className="speakBtn";
    speakBtn.innerHTML = `
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path fill="currentColor"
          d="M3 10v4h4l5 5V5L7 10H3zm13.5 2a4.5 4.5 0 0 0-2.1-3.8v7.6a4.5 4.5 0 0 0 2.1-3.8zm-2.1-7.6v1.7a6 6 0 0 1 0 10.8v1.7a7.7 7.7 0 0 0 0-14.2z"/>
      </svg>
    `;

    speakBtn.onclick = () => speakSentence(ex.text, ex);

    left.append(num, sentence);
    wrap.append(left, speakBtn);

    container.append(wrap);
  });
}

function buildFullSentence(template, ex){
  return template.replace(/\{(\d+)\}/g,(m,n)=>{
    const blankIndex = Number(n);
    return ex.answers[blankIndex];
  });
}

function speakSentence(template, ex){
  const utter = new SpeechSynthesisUtterance(buildFullSentence(template, ex));
  utter.lang = "en-US";
  window.speechSynthesis.speak(utter);
}

// Modal logic
const overlay = document.getElementById("overlay");
const modalRule = document.getElementById("modalRule");
const modalSubtitle = document.getElementById("modalSubtitle");
const modalTitle = document.getElementById("modalTitle");

document.getElementById("closeModal").onclick = () => overlay.classList.remove("show");

function onSelectChange(e){
  const sel = e.target;
  const exIndex = sel.dataset.exercise;
  const bIndex = sel.dataset.blank;

  const exercise = exercises[exIndex];
  const chosen = sel.value;
  const correct = exercise.answers[bIndex];

  sel.classList.remove("correct","incorrect");

  if(chosen === correct){
    sel.classList.add("correct");
  } else {
    sel.classList.add("incorrect");

    modalTitle.textContent="Incorrect choice";
    modalSubtitle.textContent="Check the rule below:";
    modalRule.textContent = exercise.rules[bIndex];

    overlay.classList.add("show");
  }
}

renderExercises();
</script>
</body>
</html>
