<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Minimal</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --header-bg: #222;
            --header-text: #fff;
            --accent: #007bff;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; flex-direction: column; height: 100vh; margin: 0; background: var(--bg-color); }

        /* --- TOP BAR --- */
        .top-bar {
            background: var(--header-bg); color: var(--header-text);
            padding: 10px 15px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100;
        }
        .bar-btn {
            background: #444; color: #fff; border: 1px solid #666;
            padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85rem;
        }
        .bar-btn:hover { background: #666; }

        /* --- MENU PANELS (Hidden by default) --- */
        .menu-panel {
            display: none; background: #fff; padding: 20px;
            border-bottom: 1px solid #ccc; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: absolute; top: 50px; left: 0; right: 0; z-index: 99;
        }
        
        .setting-group { margin-bottom: 15px; }
        .setting-group label { display: block; font-size: 0.8rem; color: #666; margin-bottom: 5px; font-weight: bold; }
        .setting-group input, .setting-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }

        /* --- CHAT AREA --- */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 8px; max-width: 85%; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word; }
        .role-user { background: var(--accent); color: white; align-self: flex-end; }
        .role-assistant { background: white; color: #333; align-self: flex-start; border: 1px solid #ddd; }
        .role-system { font-size: 0.75rem; color: #999; text-align: center; width: 100%; margin: 5px 0; }

        /* --- BOTTOM INPUT --- */
        .input-area { padding: 15px; background: white; border-top: 1px solid #ddd; display: flex; gap: 10px; }
        #user-input { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
        #send-btn { background: var(--accent); color: white; border: none; padding: 0 25px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        #send-btn:disabled { background: #ccc; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="bar-btn" onclick="toggleMenu('menu-config')">‚öôÔ∏è Config</button>
        <div style="font-weight:bold; font-size:0.9rem;">NEXUS</div>
        <button class="bar-btn" onclick="toggleMenu('menu-chat-config')">Chat Config ü§ñ</button>
    </div>

    <div id="menu-config" class="menu-panel">
        <div class="setting-group">
            <label>API URL (Ollama/Server)</label>
            <input type="text" id="cfg-url" value="https://ai.paradisonetworx.com">
        </div>
        <div class="setting-group">
            <label>AUTH TOKEN</label>
            <input type="password" id="cfg-token" placeholder="Bearer Token (Optional)">
        </div>
        <div style="display:flex; gap:10px;">
            <button class="bar-btn" style="background:#28a745; border:none; flex:1;" onclick="saveConfig()">Save Settings</button>
            <button class="bar-btn" style="background:#dc3545; border:none;" onclick="clearChat()">Clear Chat</button>
        </div>
    </div>

    <div id="menu-chat-config" class="menu-panel">
        <div class="setting-group">
            <label>AI MODEL</label>
            <select id="cfg-model">
                <option value="llama3.1:8b">Llama 3.1 (8B)</option>
                <option value="llama3.2:3b">Llama 3.2 (3B)</option>
                <option value="gemma3:12b">Gemma 3 (12B)</option>
                <option value="gemma3:27b">Gemma 3 (27B)</option>
            </select>
        </div>
        
        <div style="padding:10px; background:#f0f0f0; border-radius:4px; color:#666; font-size:0.8rem; text-align:center;">
            More options coming soon...
        </div>
        <br>
        <button class="bar-btn" style="background:#28a745; border:none; width:100%;" onclick="saveConfig()">Apply Changes</button>
    </div>

    <div id="chat-container"></div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off" onkeypress="if(event.key==='Enter') sendMsg()">
        <button id="send-btn" onclick="sendMsg()">Send</button>
    </div>

    <script>
        const chatBox = document.getElementById('chat-container');
        const input = document.getElementById('user-input');
        const btn = document.getElementById('send-btn');
        let history = [];

        // --- MENU MANAGEMENT ---
        function toggleMenu(menuId) {
            // Close others first
            document.querySelectorAll('.menu-panel').forEach(el => {
                if (el.id !== menuId) el.style.display = 'none';
            });
            // Toggle requested
            const menu = document.getElementById(menuId);
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }

        // --- LOAD/SAVE PERSISTENCE ---
        window.onload = () => {
            // Load credentials and settings
            if(localStorage.getItem('nx_url')) document.getElementById('cfg-url').value = localStorage.getItem('nx_url');
            if(localStorage.getItem('nx_token')) document.getElementById('cfg-token').value = localStorage.getItem('nx_token');
            if(localStorage.getItem('nx_model')) document.getElementById('cfg-model').value = localStorage.getItem('nx_model');

            // Load history
            const savedHist = localStorage.getItem('nx_history');
            if(savedHist) {
                history = JSON.parse(savedHist);
                history.forEach(msg => appendMessage(msg.content, msg.role, false));
            }
        };

        function saveConfig() {
            localStorage.setItem('nx_url', document.getElementById('cfg-url').value);
            localStorage.setItem('nx_token', document.getElementById('cfg-token').value);
            localStorage.setItem('nx_model', document.getElementById('cfg-model').value);
            
            // Hide menus on save
            document.querySelectorAll('.menu-panel').forEach(el => el.style.display = 'none');
            alert("Settings Saved");
        }

        function clearChat() {
            if(confirm("Clear entire chat history?")) {
                localStorage.removeItem('nx_history');
                history = [];
                chatBox.innerHTML = '';
                toggleMenu('menu-config'); // Close menu
            }
        }

        // --- CHAT LOGIC ---
        function appendMessage(text, role, save = true) {
            const div = document.createElement('div');
            div.className = `msg role-${role}`;
            div.textContent = text; 
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;

            if (save) {
                history.push({ role, content: text });
                localStorage.setItem('nx_history', JSON.stringify(history));
            }
        }

        async function sendMsg() {
            const text = input.value.trim();
            if (!text) return;

            // UI Updates
            input.value = '';
            appendMessage(text, 'user');
            btn.disabled = true;
            btn.innerText = "...";

            // Get Current Config
            const url = document.getElementById('cfg-url').value.replace(/\/$/, "");
            const token = document.getElementById('cfg-token').value;
            const model = document.getElementById('cfg-model').value;

            try {
                const response = await fetch(`${url}/api/chat/completions`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` 
                    },
                    body: JSON.stringify({ 
                        model: model, 
                        messages: history,
                        temperature: 0.7,
                        stream: false
                    })
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const data = await response.json();
                const reply = data.choices[0].message.content;
                appendMessage(reply, 'assistant');

            } catch (error) {
                appendMessage(`System Error: ${error.message}`, 'system');
            } finally {
                btn.disabled = false;
                btn.innerText = "Send";
                input.focus();
            }
        }
    </script>
</body>
</html>
