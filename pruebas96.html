<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LINGUA NEXUS | Enterprise Suite v3.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           1. CORE VARIABLES (High Contrast Dark Mode)
           ========================================================================== */
        :root {
            --bg-deep: #050505;
            --bg-panel: #12141a;
            --bg-input: #1a1d26;
            
            --primary: #3b82f6; 
            --primary-glow: rgba(59, 130, 246, 0.15);
            
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            
            --txt-main: #f1f5f9;
            --txt-sec: #94a3b8;
            --txt-dim: #475569;

            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
            
            --radius: 12px;
            --border: 1px solid rgba(255,255,255,0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            background: var(--bg-deep);
            color: var(--txt-main);
            font-family: var(--font-ui);
            margin: 0; height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* ==========================================================================
           2. LAYOUT
           ========================================================================== */
        .app-layout {
            display: flex;
            height: 100%;
            width: 100%;
        }

        /* SIDEBAR (Desktop) */
        aside {
            width: 280px;
            background: var(--bg-panel);
            border-right: var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            z-index: 20;
        }

        .logo-area {
            font-weight: 900; font-size: 20px; letter-spacing: -1px;
            color: var(--txt-main); margin-bottom: 30px; display: flex; align-items: center; gap: 10px;
        }
        .logo-dot { width: 12px; height: 12px; background: var(--primary); border-radius: 50%; box-shadow: 0 0 10px var(--primary); }

        .nav-menu { flex: 1; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; }
        
        .nav-item {
            padding: 14px; border-radius: var(--radius);
            font-size: 13px; font-weight: 600; color: var(--txt-sec);
            cursor: pointer; transition: 0.2s; display: flex; justify-content: space-between;
            border: 1px solid transparent;
        }
        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--txt-main); }
        .nav-item.active {
            background: var(--primary-glow); color: var(--primary);
            border-color: rgba(59,130,246,0.3);
        }
        
        .badge-err {
            background: var(--danger); color: #fff; font-size: 10px; padding: 2px 6px;
            border-radius: 4px; display: none; /* Shows only if errors exist */
        }

        /* WORKSPACE */
        main {
            flex: 1; position: relative; display: flex; flex-direction: column;
            background: radial-gradient(circle at 100% 0%, rgba(59,130,246,0.05), transparent 30%);
        }

        header {
            height: 60px; border-bottom: var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; background: rgba(5,5,5,0.8); backdrop-filter: blur(10px);
        }

        .top-stats { font-family: var(--font-code); font-size: 12px; color: var(--txt-sec); }
        .stat-val { color: var(--primary); font-weight: bold; }

        /* ==========================================================================
           3. TERMINAL UI (Game Screen)
           ========================================================================== */
        .view-screen {
            flex: 1; display: none; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px; overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }
        .view-screen.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.99); } to { opacity: 1; transform: scale(1); } }

        /* THE FIX: Fluid Typography for Word Display */
        .source-word-container {
            width: 100%;
            max-width: 800px;
            text-align: center;
            margin-bottom: 40px;
            padding: 0 10px;
        }

        .source-label {
            font-family: var(--font-code); font-size: 11px; letter-spacing: 2px;
            color: var(--primary); margin-bottom: 10px; text-transform: uppercase;
            display: block; opacity: 0.8;
        }

        .source-word {
            /* CLAMP: Min 28px, Preferred 6vw, Max 64px. This fixes the mobile cut-off */
            font-size: clamp(28px, 6vw, 64px); 
            font-weight: 800;
            line-height: 1.2;
            color: var(--txt-main);
            /* Wrap long words */
            word-break: break-word;
            hyphens: auto;
        }

        .translations-list {
            font-size: 14px; color: var(--txt-ter); margin-top: 10px;
            font-style: italic;
        }

        /* INPUTS */
        .input-stack {
            display: flex; gap: 20px; width: 100%; justify-content: center; flex-wrap: wrap;
            max-width: 900px;
        }

        .input-group {
            position: relative; flex: 1; min-width: 240px; max-width: 320px;
        }

        .input-control {
            width: 100%;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--txt-main);
            font-family: var(--font-code);
            font-size: 20px;
            padding: 20px;
            text-align: center;
            border-radius: var(--radius);
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .input-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-glow);
            background: #1e212b;
        }

        .input-label {
            position: absolute; top: -12px; left: 15px;
            background: var(--bg-deep); padding: 0 8px;
            font-size: 10px; font-weight: bold; color: var(--txt-sec);
            border-radius: 4px; border: 1px solid var(--border);
        }

        /* VALIDATION STATES */
        .input-group.error .input-control {
            border-color: var(--danger); color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }
        .input-group.success .input-control {
            border-color: var(--success); color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        /* PEDAGOGY: Diff / Correction Display */
        .diff-display {
            height: 20px; margin-top: 8px; font-size: 12px;
            font-family: var(--font-code); text-align: center;
            opacity: 0; transition: 0.3s;
        }
        .input-group.error .diff-display { opacity: 1; color: var(--danger); }
        
        .strike { text-decoration: line-through; opacity: 0.6; margin-right: 5px; }
        .fix { font-weight: bold; color: var(--txt-main); }

        /* PEDAGOGY: Hint Button */
        .hint-btn {
            margin-top: 30px;
            background: transparent; border: 1px solid var(--border);
            color: var(--txt-ter); font-size: 11px; padding: 8px 16px;
            border-radius: 20px; cursor: pointer; transition: 0.2s;
        }
        .hint-btn:hover { border-color: var(--primary); color: var(--primary); }

        /* DASHBOARD GRID */
        .dash-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px; width: 100%; max-width: 1000px;
        }
        .card {
            background: var(--bg-panel); border: var(--border);
            padding: 25px; border-radius: var(--radius); cursor: pointer;
            transition: 0.2s; position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-3px); border-color: var(--primary); }
        .card h3 { margin: 0 0 10px 0; font-size: 14px; color: var(--txt-sec); text-transform: uppercase; letter-spacing: 1px;}
        .card .big-num { font-size: 32px; font-weight: 800; color: var(--txt-main); font-family: var(--font-code); }
        .card .sub { font-size: 12px; color: var(--txt-dim); margin-top: 5px; }
        
        .card.priority { border-left: 3px solid var(--warning); }

        /* MOBILE NAV (Bottom Bar) */
        @media (max-width: 768px) {
            .app-layout { flex-direction: column; }
            aside {
                position: fixed; bottom: 0; left: 0; width: 100%; height: 65px;
                flex-direction: row; border-right: none; border-top: var(--border);
                padding: 0; z-index: 100;
            }
            .logo-area { display: none; }
            .nav-menu {
                flex-direction: row; padding: 5px; gap: 5px; width: 100%;
            }
            .nav-item {
                flex: 1; flex-direction: column; align-items: center; justify-content: center;
                padding: 5px; font-size: 10px; text-align: center; border: none;
            }
            main { padding-bottom: 70px; } /* Space for bottom nav */
            
            /* Mobile Input Stack */
            .input-stack { flex-direction: column; gap: 25px; }
            .input-group { max-width: 100%; }
            .input-control { font-size: 18px; padding: 15px; }
        }

        /* SRS ALERT */
        .srs-alert {
            background: rgba(245, 158, 11, 0.1); border: 1px solid var(--warning);
            color: var(--warning); padding: 15px; border-radius: var(--radius);
            margin-bottom: 20px; width: 100%; max-width: 1000px;
            display: flex; align-items: center; justify-content: space-between;
            font-size: 13px;
        }
    </style>
</head>
<body>

    <script src="https://paradisonetworx.com/database.js"></script>

    <div class="app-layout">
        <aside>
            <div class="logo-area">
                <div class="logo-dot"></div> LINGUA NEXUS
            </div>
            <div class="nav-menu">
                <div class="nav-item active" onclick="App.nav('dashboard')">
                    <span>DASHBOARD</span>
                </div>
                <div class="nav-item" onclick="App.start('nouns')">
                    <span>NOUNS</span>
                </div>
                <div class="nav-item" onclick="App.start('adjectives')">
                    <span>ADJECTIVES</span>
                </div>
                <div class="nav-item" onclick="App.start('verbs_reg')">
                    <span>REGULAR V.</span>
                </div>
                <div class="nav-item" onclick="App.start('verbs_irreg')">
                    <span>IRREGULAR V.</span>
                </div>
                <div class="nav-item" onclick="App.start('functionals')">
                    <span>CONNECTORS</span>
                </div>
            </div>
        </aside>

        <main>
            <header>
                <div class="top-stats">
                    SESSION: <span class="stat-val" id="sess-name">IDLE</span>
                </div>
                <div class="top-stats">
                    MASTERY: <span class="stat-val" id="global-mastery">0%</span>
                </div>
            </header>

            <div id="view-dash" class="view-screen active">
                <div id="srs-box" class="srs-alert" style="display:none;">
                    <span>⚠️ <strong>ATTENTION:</strong> <span id="srs-count">0</span> items require immediate review.</span>
                    <button onclick="App.startReview()" style="background:var(--warning); border:none; padding:8px 12px; border-radius:6px; font-weight:bold; cursor:pointer;">REVIEW NOW</button>
                </div>

                <div class="dash-grid">
                    <div class="card" onclick="App.start('nouns')">
                        <h3>General Lexicon</h3>
                        <div class="big-num" style="color:var(--primary);">NOUNS</div>
                        <div class="sub">Standard translation audit.</div>
                    </div>
                    <div class="card" onclick="App.start('verbs_irreg')">
                        <h3>Critical Matrix</h3>
                        <div class="big-num" style="color:var(--danger);">VERBS</div>
                        <div class="sub">Base / Past / Participle triad validation.</div>
                    </div>
                    <div class="card" onclick="App.start('functionals')">
                        <h3>Syntax Flow</h3>
                        <div class="big-num" style="color:var(--success);">FUNC</div>
                        <div class="sub">Prepositions and connectors.</div>
                    </div>
                </div>
            </div>

            <div id="view-game" class="view-screen">
                <div class="source-word-container">
                    <span class="source-label" id="lbl-context">CONTEXT LOADING...</span>
                    <div class="source-word" id="word-disp"></div>
                    <div class="translations-list" id="trans-disp"></div>
                </div>

                <div class="input-stack" id="input-area">
                    </div>

                <button class="hint-btn" onclick="App.requestHint()">REQUEST HINT (-10% SCORE)</button>
                
                <div style="margin-top:40px; width:100%; max-width:600px; height:4px; background:var(--bg-panel); border-radius:2px;">
                    <div id="progress-bar" style="height:100%; width:0%; background:var(--primary); transition: width 0.3s;"></div>
                </div>
            </div>
        </main>
    </div>

<script>
/**
 * LINGUA NEXUS v3.0 | Logic
 * Features: SRS Persistence, Smart Diffing, Fluid UI
 */

// 1. STORAGE MANAGER (The Brain)
const Storage = {
    key: 'lingua_nexus_data_v3',
    data: {
        errors: [], // List of words user failed {en: 'WORD', fails: 2}
        mastered: 0,
        totalActions: 0
    },
    
    init() {
        const saved = localStorage.getItem(this.key);
        if(saved) this.data = JSON.parse(saved);
        this.updateDash();
    },

    save() {
        localStorage.setItem(this.key, JSON.stringify(this.data));
        this.updateDash();
    },

    logError(word) {
        const existing = this.data.errors.find(e => e.en === word);
        if (existing) existing.fails++;
        else this.data.errors.push({ en: word, fails: 1 });
        this.save();
    },

    logSuccess(word) {
        // Remove from error list if exists (Spaced Repetition success)
        const idx = this.data.errors.findIndex(e => e.en === word);
        if (idx > -1) {
            this.data.errors[idx].fails--;
            if(this.data.errors[idx].fails <= 0) this.data.errors.splice(idx, 1);
        }
        this.data.mastered++;
        this.data.totalActions++;
        this.save();
    },

    updateDash() {
        const errCount = this.data.errors.length;
        const alertBox = document.getElementById('srs-box');
        if (errCount > 0) {
            alertBox.style.display = 'flex';
            document.getElementById('srs-count').innerText = errCount;
        } else {
            alertBox.style.display = 'none';
        }
        
        let ratio = 0;
        if(this.data.totalActions > 0) ratio = Math.round((this.data.mastered / this.data.totalActions)*100);
        document.getElementById('global-mastery').innerText = ratio + "%";
    }
};

// 2. DATA PROVIDER
const DB = {
    source: {},
    async load() {
        return new Promise(resolve => {
            const check = setInterval(() => {
                if (typeof INTERNAL_VOCAB !== 'undefined') {
                    this.source = INTERNAL_VOCAB;
                    clearInterval(check);
                    Storage.init();
                    resolve();
                }
            }, 100);
        });
    },
    
    getBatch(category, size = 5) {
        // If "Review Mode", pull from storage errors
        if(category === 'review') {
            const errs = Storage.data.errors.map(e => e.en);
            // We need to find full objects in DB for these words
            let reviewList = [];
            Object.values(this.source).forEach(list => {
                list.forEach(item => {
                    if(errs.includes(item.en)) reviewList.push({...item, isTriad: item.type === 'IRREGULAR' || item.type === 'REGULAR'});
                });
            });
            return reviewList.slice(0, size);
        }

        let key = '';
        if(category === 'nouns') key = 'NOUNS';
        if(category === 'adjectives') key = 'ADJECTIVES';
        if(category === 'verbs_reg') key = 'REGULAR_VERBS';
        if(category === 'verbs_irreg') key = 'IRREGULAR_VERBS';
        if(category === 'functionals') key = 'FUNCTION WORDS';

        const list = this.source[key] || [];
        const shuffled = [...list].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, size).map(item => ({
            ...item,
            isTriad: (key === 'REGULAR_VERBS' || key === 'IRREGULAR_VERBS')
        }));
    }
};

// 3. APP LOGIC
const App = {
    queue: [],
    idx: 0,
    
    async init() {
        await DB.load();
        this.nav('dashboard');
    },

    nav(screen) {
        document.querySelectorAll('.view-screen').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        
        if(screen === 'dashboard') {
            document.getElementById('view-dash').classList.add('active');
            document.querySelector('.nav-item').classList.add('active');
            document.getElementById('sess-name').innerText = "IDLE";
        } else {
            document.getElementById('view-game').classList.add('active');
        }
    },

    start(category) {
        this.queue = DB.getBatch(category);
        this.idx = 0;
        this.nav('game');
        document.getElementById('sess-name').innerText = category.toUpperCase();
        this.render();
    },

    startReview() {
        this.start('review');
    },

    render() {
        if(this.idx >= this.queue.length) {
            alert("SESSION COMPLETE. DATA SAVED.");
            this.nav('dashboard');
            return;
        }

        const item = this.queue[this.idx];
        const container = document.getElementById('input-area');
        container.innerHTML = '';

        // 1. Render Source Word (Spanish)
        // BUG FIX: Ensure we show a random translation if array, or join them
        const displayWord = Array.isArray(item.es) ? item.es.join(" / ") : item.es;
        document.getElementById('word-disp').innerText = displayWord;
        document.getElementById('lbl-context').innerText = item.isTriad ? "COMPLETE THE VERB MATRIX" : "TRANSLATE TERM";
        document.getElementById('trans-disp').innerText = ""; // Clear old help

        // 2. Render Inputs
        if(item.isTriad) {
            this.makeInput(container, 'BASE FORM', 0, item.en);
            this.makeInput(container, 'PAST SIMPLE', 1, item.past);
            this.makeInput(container, 'PARTICIPLE', 2, item.part);
        } else {
            this.makeInput(container, 'ENGLISH', 0, item.en);
        }

        // 3. Update Progress
        const pct = (this.idx / this.queue.length) * 100;
        document.getElementById('progress-bar').style.width = pct + "%";

        setTimeout(() => container.querySelector('input').focus(), 100);
    },

    makeInput(parent, label, index, correctAnswer) {
        const div = document.createElement('div');
        div.className = 'input-group';
        
        div.innerHTML = `
            <span class="input-label">${label}</span>
            <input type="text" class="input-control" data-idx="${index}" data-ans="${correctAnswer}" autocomplete="off" spellcheck="false">
            <div class="diff-display" id="diff-${index}"></div>
        `;
        
        const input = div.querySelector('input');
        
        // Input Logic
        input.addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const all = document.querySelectorAll('.input-control');
                if(index < all.length - 1) all[index+1].focus();
                else this.validate();
            }
        });

        parent.appendChild(div);
    },

    validate() {
        const item = this.queue[this.idx];
        const inputs = document.querySelectorAll('.input-control');
        let allValid = true;

        inputs.forEach(inp => {
            const val = inp.value.trim().toUpperCase();
            const correct = inp.dataset.ans.toUpperCase();
            const group = inp.parentElement;
            const diffBox = group.querySelector('.diff-display');

            // Reset states
            group.classList.remove('error', 'success');
            
            if(val === correct) {
                group.classList.add('success');
                inp.disabled = true;
            } else {
                allValid = false;
                group.classList.add('error');
                Storage.logError(item.en); // SRS Logic
                
                // PEDAGOGY: Visual Diff
                // Instead of just clearing, we show what they typed crossed out, and ask to retry
                diffBox.innerHTML = `<span class="strike">${val}</span> <span class="fix">REQ: ${correct}</span>`;
                
                // UX: Clear input after a delay to force re-typing
                setTimeout(() => {
                    inp.value = '';
                    inp.placeholder = 'RETYPE: ' + correct; // Force muscle memory
                    inp.focus();
                }, 1500);
            }
        });

        if(allValid) {
            Storage.logSuccess(item.en);
            setTimeout(() => {
                this.idx++;
                this.render();
            }, 800);
        }
    },

    requestHint() {
        // Reveals 1 letter of the currently focused input
        const active = document.activeElement;
        if(active && active.classList.contains('input-control')) {
            const correct = active.dataset.ans;
            const len = active.value.length;
            if(len < correct.length) {
                active.value = correct.substring(0, len + 1);
            }
        }
    }
};

window.onload = () => App.init();

</script>
</body>
</html>
