<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fusionador Pro v3: Subt√≠tulos a HTML</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #27ae60;
            --danger: #e74c3c;
            --bg: #f4f7f6;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); padding: 20px; color: #333; }
        
        /* Cabecera y Links */
        .header { text-align: center; margin-bottom: 20px; }
        h2 { color: var(--secondary); margin-bottom: 15px; }
        
        .resources {
            background: #fff;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-flex;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            align-items: center;
            font-size: 0.9rem;
        }
        .resource-link {
            text-decoration: none; color: #fff; background: var(--secondary);
            padding: 8px 16px; border-radius: 20px; font-weight: bold; transition: 0.3s;
            display: flex; align-items: center; gap: 5px;
        }
        .resource-link:hover { background: #34495e; transform: translateY(-2px); }
        .resource-link.blue { background: var(--primary); }

        /* Contenedor Principal */
        .container { display: flex; gap: 15px; height: 68vh; }
        .column { flex: 1; display: flex; flex-direction: column; background: #fff; border-radius: 8px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Barra de herramientas sobre cada caja */
        .toolbar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 8px;
        }
        .toolbar label { font-weight: bold; color: var(--secondary); font-size: 1em; }
        
        .mini-btn-group { display: flex; gap: 5px; }
        .mini-btn {
            padding: 4px 10px; border: 1px solid #ddd; background: #f9f9f9;
            border-radius: 4px; cursor: pointer; font-size: 11px; transition: 0.2s;
            display: flex; align-items: center; gap: 4px; font-weight: 600;
        }
        .mini-btn:hover { background: #e2e6ea; }
        
        /* Colores de botones mini */
        .mini-btn.copy { color: var(--primary); border-color: var(--primary); }
        .mini-btn.paste { color: var(--accent); border-color: var(--accent); }
        .mini-btn.clear { color: var(--danger); border-color: var(--danger); }
        .mini-btn.clear:hover { background: #fdedec; }

        textarea {
            flex: 1; padding: 10px; border: 1px solid #eee; border-radius: 5px;
            font-family: 'Consolas', monospace; font-size: 12px; resize: none;
            background: #fafafa; color: #444;
        }
        textarea:focus { border-color: var(--primary); outline: none; background: #fff; }

        /* Botones Principales de Abajo */
        .btn-container { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        
        .main-btn {
            padding: 15px 40px; border: none; border-radius: 30px; cursor: pointer;
            font-size: 16px; font-weight: bold; transition: 0.3s; display: flex; align-items: center; gap: 10px;
            color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .btn-generate { background: var(--accent); }
        .btn-generate:hover { background: #219150; transform: translateY(-2px); }
        
        .btn-clear-all { background: var(--danger); }
        .btn-clear-all:hover { background: #c0392b; transform: translateY(-2px); }

        #output { background: #2c3e50; color: #ecf0f1; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Fusionador de Subt√≠tulos a HTML Web</h2>
        <div class="resources">
            <span>Herramientas:</span>
            <a href="https://downsub.com/" target="_blank" class="resource-link">‚¨áÔ∏è DownSub</a>
            <a href="https://translatesubtitles.co" target="_blank" class="resource-link blue">üåê TranslateSubtitles</a>
        </div>
    </div>

    <div class="container">
        <div class="column">
            <div class="toolbar">
                <label>1. Ingl√©s (Original)</label>
                <div class="mini-btn-group">
                    <button class="mini-btn paste" onclick="pasteText('inputEng')" title="Pegar del portapapeles">üìã Pegar</button>
                    <button class="mini-btn copy" onclick="copyText('inputEng')" title="Copiar texto">üìë Copiar</button>
                    <button class="mini-btn clear" onclick="clearText('inputEng')" title="Borrar contenido">‚ùå</button>
                </div>
            </div>
            <textarea id="inputEng" placeholder="Pega aqu√≠ el SRT en INGL√âS..."></textarea>
        </div>

        <div class="column">
            <div class="toolbar">
                <label>2. Espa√±ol (Traducido)</label>
                <div class="mini-btn-group">
                    <button class="mini-btn paste" onclick="pasteText('inputEsp')" title="Pegar del portapapeles">üìã Pegar</button>
                    <button class="mini-btn copy" onclick="copyText('inputEsp')" title="Copiar texto">üìë Copiar</button>
                    <button class="mini-btn clear" onclick="clearText('inputEsp')" title="Borrar contenido">‚ùå</button>
                </div>
            </div>
            <textarea id="inputEsp" placeholder="Pega aqu√≠ el SRT en ESPA√ëOL..."></textarea>
        </div>

        <div class="column">
            <div class="toolbar">
                <label>3. Resultado HTML</label>
                <div class="mini-btn-group">
                    <button class="mini-btn copy" onclick="copyText('output')" title="Copiar c√≥digo final">üìë COPIAR C√ìDIGO</button>
                    <button class="mini-btn clear" onclick="clearText('output')" title="Borrar resultado">‚ùå</button>
                </div>
            </div>
            <textarea id="output" readonly placeholder="El c√≥digo final aparecer√° aqu√≠..."></textarea>
        </div>
    </div>

    <div class="btn-container">
        <button class="main-btn btn-clear-all" onclick="clearAll()">
            üóëÔ∏è BORRAR TODO
        </button>
        <button class="main-btn btn-generate" onclick="fusionar()">
            ‚ö° FUSIONAR Y GENERAR
        </button>
    </div>

    <script>
        // --- Funciones de Interfaz ---

        function clearText(elementId) {
            document.getElementById(elementId).value = "";
            // Peque√±o parpadeo rojo para indicar borrado
            const el = document.getElementById(elementId);
            const originalBg = el.style.backgroundColor;
            el.style.backgroundColor = "#fdedec";
            setTimeout(() => el.style.backgroundColor = "", 200);
        }

        function clearAll() {
            if (confirm("¬øEst√°s seguro de que quieres borrar todo el contenido?")) {
                clearText('inputEng');
                clearText('inputEsp');
                clearText('output');
            }
        }

        async function pasteText(elementId) {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById(elementId).value = text;
            } catch (err) {
                alert('‚ö†Ô∏è Por seguridad, tu navegador pide que uses Ctrl+V o clic derecho -> Pegar.');
            }
        }

        function copyText(elementId) {
            const textarea = document.getElementById(elementId);
            if (!textarea.value) return;
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(textarea.value).then(() => {
                alert("‚úÖ ¬°Texto copiado!");
            });
        }

        // --- L√≥gica de Fusi√≥n ---

        function timeToSeconds(timeString) {
            try {
                const parts = timeString.split(':');
                const hours = parseInt(parts[0]);
                const minutes = parseInt(parts[1]);
                const secondsPart = parts[2].split(','); 
                const seconds = parseInt(secondsPart[0]);
                return (hours * 3600) + (minutes * 60) + seconds;
            } catch (e) { return 0; }
        }

        function parseSRT(text) {
            text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n') + "\n\n";
            const regex = /(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3})\s-->\s(\d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n\n|\n\d+\s+\d{2}:\d{2}|$)/g;
            const bloques = [];
            let match;

            while ((match = regex.exec(text)) !== null) {
                bloques.push({
                    id: match[1],
                    start: match[2], 
                    text: match[4].replace(/\n/g, ' ').trim() 
                });
            }
            return bloques;
        }

        function fusionar() {
            const rawEng = document.getElementById('inputEng').value;
            const rawEsp = document.getElementById('inputEsp').value;
            
            if (!rawEng.trim()) {
                alert("‚ö†Ô∏è ¬°Falta el texto en Ingl√©s!");
                return;
            }

            const engBlocks = parseSRT(rawEng);
            const espBlocks = parseSRT(rawEsp);

            let htmlOutput = "";

            for (let i = 0; i < engBlocks.length; i++) {
                const engItem = engBlocks[i];
                const espText = espBlocks[i] ? espBlocks[i].text : "";
                const seconds = timeToSeconds(engItem.start);

                const htmlBlock = 
`<div class="line" data-time="${seconds}">
  <div class="line-content">
    <div class="text-block">
      <div class="english">${engItem.text}</div>
      <div class="spanish">${espText}</div>
    </div>
    <div class="controls">
      <button class="btn playBtn">Play</button>
      <button class="btn speakBtn">Speak</button>
    </div>
  </div>
</div>`;

                htmlOutput += htmlBlock + "\n\n";
            }

            document.getElementById('output').value = htmlOutput;
            
            if (engBlocks.length !== espBlocks.length && rawEsp.trim()) {
                alert(`‚ÑπÔ∏è Resultado generado, pero ojo: Ingl√©s tiene ${engBlocks.length} bloques y Espa√±ol ${espBlocks.length}.`);
            }
        }
    </script>

</body>
</html>
